/* PARTcloud - JS - v1.0.0 */
var CNSAPPKit=CNSAPPKit||{};!function(T){"use strict";var _,m,d,e,g,s,n,r,l,c;CNSAPPKit.CubeSketcher=(m={BRUSH:0,CIRCLE_FILL:1,CIRCLE_LINE:2,RECT_FILL:3,RECT_LINE:4,POLY_FILL:5,POLY_LINE:6,FILL:7},d={BLACK:0,WHITE:1},g=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},s=function(e,n,l){for(var t,o,i,a,d=_._ctx.canvas.width,r=_._ctx.canvas.height,s=_._ctx.getImageData(e.x,e.y,1,1).data,c={r:s[0],g:s[1],b:s[2],a:s[3]},u=_._ctx.getImageData(0,0,d,r),p=u.data,m=function(e){var t,o,i,a,r=(o=4*((t=e).y*d+t.x),[p[o],p[o+1],p[o+2],p[o+3]]);return r={r:r[0],g:r[1],b:r[2],a:r[3]},a=c,((i=r).r>=a.r-l||i.r<=a.r+l)&&(i.g>=a.g-l||i.g<=a.g+l)&&(i.b>=a.b-l||i.b<=a.b+l)&&(i.a>=a.a-l||i.a<=a.a+l)&&(r.r!==n.r||r.g!==n.g||r.b!==n.b||r.a!==n.a)},g=function(e,t,o){0<=t&&t<=d&&0<=o&&o<=r&&e.push({x:t,y:o})},h=[e];0<h.length;)m(t=h.pop())&&(o=t,i={r:n.r,g:n.g,b:n.b,a:255},void 0,a=4*(o.y*d+o.x),p[a]=i.r,p[a+1]=i.g,p[a+2]=i.b,p[a+3]=i.a,g(h,t.x,t.y+1),g(h,t.x+1,t.y),g(h,t.x,t.y-1),g(h,t.x-1,t.y));_._ctx.putImageData(u,0,0)},n=function(e){e.preventDefault();var t=T(e.currentTarget);switch(_._ctx=T(".CubeSketcher-"+_._currentType+"_canvas").get(0).getContext("2d"),_._tmpCtx=T(".CubeSketcher-tmp_canvas").get(0).getContext("2d"),_._ctx.lineCap="round",_._ctx.lineJoin="round",_._ctx.lineWidth=_._thickness,_._tmpCtx.lineWidth=_._thickness,_._currentColor){case d.BLACK:_._ctx.strokeStyle="#000000",_._ctx.fillStyle="#000000",_._tmpCtx.strokeStyle="#000000",_._tmpCtx.fillStyle="#000000";break;case d.WHITE:_._ctx.strokeStyle="#FFFFFF",_._ctx.fillStyle="#FFFFFF",_._tmpCtx.strokeStyle="#FFFFFF",_._tmpCtx.fillStyle="#FFFFFF"}_._lastPos.x=-1,_._lastPos.y=-1;var o=t.offset(),i=o.left,a=o.top,r={x:0,y:0};switch(r=g()?(e.touches||(e=e.originalEvent),{x:e.touches[0].pageX-i,y:e.touches[0].pageY-a}):{x:e.pageX-i,y:e.pageY-a},_._startDrawPos.x=r.x,_._startDrawPos.y=r.y,_._currentTool){case m.CIRCLE_LINE:case m.CIRCLE_FILL:case m.RECT_FILL:_._isDrawing=!0;break;case m.RECT_LINE:case m.POLY_FILL:case m.POLY_LINE:case m.BRUSH:_._isDrawing=!0;break;case m.FILL:var n;_._isDrawing=!0,n={r:0,g:0,b:0,a:255},n=_._currentColor===d.BLACK?{r:0,g:0,b:0,a:255}:{r:255,g:255,b:255,a:255};var l={x:parseInt(r.x,10),y:parseInt(r.y,10)};s(l,n,_._floodFillTolerance)}},r=function(){if(!1!==_._isDrawing&&(_._isDrawing=!1,_._lastPos.x=-1,_._lastPos.y=-1,_._startDrawPos.x=-1,_._startDrawPos.y=-1,void 0!==_._ctx&&void 0!==_._tmpCtx)){var e=T(".CubeSketcher-tmp_canvas").get(0);switch(_._currentTool){case m.CIRCLE_LINE:case m.CIRCLE_FILL:_._ctx.drawImage(e,0,0),_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y);break;case m.RECT_FILL:case m.RECT_LINE:_._ctx.drawImage(e,0,0),_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y);break;case m.POLY_FILL:break;case m.POLY_LINE:case m.FILL:break;case m.BRUSH:_._ctx.drawImage(e,0,0),_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y)}_._pts.length=0}},l=function(e){e.preventDefault();var t=T(e.currentTarget),o=t.offset(),i=o.left,a=o.top,r={x:0,y:0};if(r=g()?{x:event.touches[0].pageX-i,y:event.touches[0].pageY-a}:{x:e.pageX-i,y:e.pageY-a},"pinch"===e.type&&(_._currentTool===m.CIRCLE_FILL||_._currentTool===m.CIRCLE_LINE)&&g()){_._startDrawPos={x:e.gesture.center.pageX-i,y:e.gesture.center.pageY-a};var n=Math.abs(_._startDrawPos.x-(event.touches[0].pageX-i));r={x:_._startDrawPos.x+n,y:_._startDrawPos.y+n}}var l=t.outerWidth(),d=t.outerHeight();if(r.x>l&&(r.x=l),r.y>d&&(r.y=d),g()||(T(".CubeSketcher-image-x").css({top:r.y}),T(".CubeSketcher-image-y").css({left:r.x})),-1===_._lastPos.x&&(_._lastPos.x=r.x),-1===_._lastPos.y&&(_._lastPos.y=r.y),_._isDrawing){var s=Math.min(r.x,_._startDrawPos.x),c=Math.min(r.y,_._startDrawPos.y),u=Math.abs(r.x-_._startDrawPos.x),p=Math.abs(r.y-_._startDrawPos.y);switch(_._currentTool){case m.CIRCLE_LINE:_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y),_._tmpCtx.beginPath(),_._tmpCtx.arc(_._startDrawPos.x,_._startDrawPos.y,Math.max(u,p),0,2*Math.PI),_._tmpCtx.stroke();break;case m.CIRCLE_FILL:_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y),_._tmpCtx.beginPath(),_._tmpCtx.arc(_._startDrawPos.x,_._startDrawPos.y,Math.max(u,p),0,2*Math.PI),_._tmpCtx.fill();break;case m.RECT_FILL:_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y),_._tmpCtx.fillRect(s,c,u,p);break;case m.RECT_LINE:_._tmpCtx.clearRect(0,0,_._canvasSize.x,_._canvasSize.y),_._tmpCtx.strokeRect(s,c,u,p);break;case m.POLY_FILL:case m.POLY_LINE:case m.FILL:break;case m.BRUSH:_._pts.push(r),function(){if(_._pts.length<3&&0<_._pts.length){var e=_._pts[0];return _._tmpCtx.beginPath(),_._tmpCtx.arc(e.x,e.y,_._tmpCtx.lineWidth/2,0,2*Math.PI),_._tmpCtx.fill(),_._tmpCtx.closePath()}var t,o,i;for(_._tmpCtx.beginPath(),_._tmpCtx.moveTo(_._pts[0].x,_._pts[0].y),t=1;t<_._pts.length-2;t+=1)o=(_._pts[t].x+_._pts[t+1].x)/2,i=(_._pts[t].y+_._pts[t+1].y)/2,_._tmpCtx.quadraticCurveTo(_._pts[t].x,_._pts[t].y,o,i);_._tmpCtx.quadraticCurveTo(_._pts[t].x,_._pts[t].y,_._pts[t+1].x,_._pts[t+1].y),_._tmpCtx.stroke();var a=_._pts[t+1];_._tmpCtx.beginPath(),_._tmpCtx.arc(a.x,a.y,_._tmpCtx.lineWidth/2,0,2*Math.PI),_._tmpCtx.fill(),_._tmpCtx.closePath()}()}}},c=function(e,t){_.clearFace(e);var o=t.width/t.height,i=T(".CubeSketcher-"+e+"_canvas").get(0).getContext("2d");if(1<o){var a=_._canvasSize.y/o,r=Math.abs(a-_._canvasSize.y)/2;i.drawImage(t,0,r,_._canvasSize.x,a)}else{var n=_._canvasSize.x*o,l=Math.abs(n-_._canvasSize.x)/2;i.drawImage(t,l,0,n,_._canvasSize.y)}},(e=function(e,t){void 0!==e&&e instanceof jQuery&&((_=this)._ctx=null,this._tmpCtx=null,this._thickness=2,this._firstStart=!0,this._isDrawing=!1,this._lastPos={x:-1,y:-1},this._currentWidth=0,this._currentHeight=0,this._canvasSize={x:0,y:0},this._pts=[],this._cubeContainer=void 0,this._currentTool=m.BRUSH,this._currentColor=d.BLACK,this._currentType="front",this._scaleFactor=.25,this._startDrawPos={x:-1,y:-1},this._floodFillTolerance=10,this.buildHTML(e),this.init(t))}).prototype.changeTool=function(e){switch(e){case m.CIRCLE_LINE:this._currentTool=m.CIRCLE_LINE;break;case m.CIRCLE_FILL:this._currentTool=m.CIRCLE_FILL;break;case m.RECT_FILL:this._currentTool=m.RECT_FILL;break;case m.RECT_LINE:this._currentTool=m.RECT_LINE;break;case m.POLY_FILL:this._currentTool=m.POLY_FILL;break;case m.POLY_LINE:this._currentTool=m.POLY_LINE;break;case m.FILL:this._currentTool=m.FILL;break;case m.BRUSH:this._currentTool=m.BRUSH}},e.prototype.changeThickness=function(e){this._thickness=e},e.prototype.changeColor=function(e){switch(e){case d.WHITE:this._currentColor=d.WHITE;break;case d.BLACK:default:this._currentColor=d.BLACK}},e.prototype.setActiveView=function(e){if("string"==typeof e){var t,o,i=T(".CubeSketcher-cube"),a=i.attr("class").split(/\s+/),r="";for(t=0;t<a.length;++t)"CubeSketcher-front_current"===(o=a[t])?(r="front",i.removeClass(o)):"CubeSketcher-side_current"===o?(r="side",i.removeClass(o)):"CubeSketcher-top_current"===o&&(r="top",i.removeClass(o));g()?(T(".CubeSketcher-"+r+"Face").off("touchmove",l),T(".CubeSketcher-"+r+"Face").off("touchstart",n),T(".CubeSketcher-"+e+"Face").on("touchmove",l),T(".CubeSketcher-"+e+"Face").on("touchstart",n)):(T(".CubeSketcher-"+r+"Face").off("mousemove",l),T(".CubeSketcher-"+r+"Face").off("mousedown",n),T(".CubeSketcher-"+e+"Face").on("mousemove",l),T(".CubeSketcher-"+e+"Face").on("mousedown",n)),this._currentType=e,T(".CubeSketcher-tmp_canvas").appendTo(".CubeSketcher-"+e+"_div"),"front"===e?i.addClass("CubeSketcher-front_current"):"side"===e?i.addClass("CubeSketcher-side_current"):"top"===e&&i.addClass("CubeSketcher-top_current"),this.resizeSketchSearch()}},e.prototype.buildHTML=function(e){e.html('<div class="CubeSketcher-cube CubeSketcher-front_current"><div class="CubeSketcher-topFace"><div class="CubeSketcher-top_div"><div class="CubeSketcher-image-x"></div><div class="CubeSketcher-image-y"></div><canvas class="CubeSketcher-canvas CubeSketcher-top_canvas CubeSketcher-sketchsearchCanvas" width="500" height="500" data-type="top"></canvas><div class="CubeSketcher-grid"></div><span class="CubeSketcher-span CubeSketcher-top_caption">Top</span></div></div><div class="CubeSketcher-frontFace"><div class="CubeSketcher-front_div"><div class="CubeSketcher-image-x"></div><div class="CubeSketcher-image-y"></div><canvas class="CubeSketcher-canvas CubeSketcher-front_canvas CubeSketcher-sketchsearchCanvas" width="500" height="500" data-type="front"></canvas><canvas class="CubeSketcher-canvas CubeSketcher-tmp_canvas CubeSketcher-sketchsearchCanvas" width="500" height="500" data-type="tmp"></canvas><div class="CubeSketcher-grid"></div><span class="CubeSketcher-span CubeSketcher-front_caption">Front</span></div></div><div class="CubeSketcher-sideFace"><div class="CubeSketcher-side_div"><div class="CubeSketcher-image-x"></div><div class="CubeSketcher-image-y"></div><canvas class="CubeSketcher-canvas CubeSketcher-side_canvas CubeSketcher-sketchsearchCanvas" width="500" height="500" data-type="side"></canvas><div class="CubeSketcher-grid"></div><span class="CubeSketcher-span CubeSketcher-side_caption">Side</span></div></div></div>'),this._cubeContainer=e},e.prototype.getImageDataUrls=function(){return{front:T(".CubeSketcher-front_canvas").get(0).toDataURL(),top:T(".CubeSketcher-top_canvas").get(0).toDataURL(),side:T(".CubeSketcher-side_canvas").get(0).toDataURL()}},e.prototype.resizeSketchSearch=function(){if(void 0!==this._cubeContainer&&"none"!==this._cubeContainer.css("display")){!function(e,t){var o;if(0!==e&&0!==t){o=t<e?t:e;var i=1-_._scaleFactor,a=parseInt(o*i,10),r=parseInt(a*_._scaleFactor,10);if(_._canvasSize.x!==a){var n=T(".CubeSketcher-front_canvas").get(0),l=T(".CubeSketcher-side_canvas").get(0),d=T(".CubeSketcher-top_canvas").get(0),s=n.getContext("2d"),c=l.getContext("2d"),u=d.getContext("2d");_._canvasSize.x=a,_._canvasSize.y=a;var p=s.getImageData(0,0,_._canvasSize.x,_._canvasSize.y),m=c.getImageData(0,0,_._canvasSize.x,_._canvasSize.y),g=u.getImageData(0,0,_._canvasSize.x,_._canvasSize.y);T(".CubeSketcher-canvas").each(function(){var e=T(this);e.attr("width",a),e.attr("height",a)});var h=1;_._currentWidth===T(document).width()&&_._currentHeight===T(document).height()||(h=a/_._canvasSize.x,_._currentWidth=T(document).width(),_._currentHeight=T(document).height()),_._canvasSize.x=a,_._canvasSize.y=a;var f=T("<canvas>").attr("width",p.width).attr("height",p.height)[0],w=T("<canvas>").attr("width",m.width).attr("height",m.height)[0],v=T("<canvas>").attr("width",g.width).attr("height",g.height)[0];f.getContext("2d").putImageData(p,0,0),w.getContext("2d").putImageData(m,0,0),v.getContext("2d").putImageData(g,0,0),s.save(),c.save(),u.save(),s.scale(h,h),c.scale(h,h),u.scale(h,h),s.drawImage(f,0,0),c.drawImage(w,0,0),u.drawImage(v,0,0),s.restore(),c.restore(),u.restore()}var P=parseInt(T(".CubeSketcher-frontFace").css("borderBottomWidth"),10);T(".CubeSketcher-cube").css({top:r+20}),T(".CubeSketcher-sideFace, .CubeSketcher-frontFace, .CubeSketcher-topFace").css({width:a}),T(".CubeSketcher-sideFace, .CubeSketcher-frontFace, .CubeSketcher-topFace").css({height:a}),T(".CubeSketcher-grid").css({width:a-2*P}),T(".CubeSketcher-grid").css({height:a-2*P}),T(".CubeSketcher-topFace").css({left:0,top:0}),T(".CubeSketcher-sideFace").css({left:0,top:0}),T(".CubeSketcher-frontFace").css({left:0,top:0}),T(".CubeSketcher-front_current .CubeSketcher-sideFace").css({left:a}),T(".CubeSketcher-front_current .CubeSketcher-topFace").css({left:r}),T(".CubeSketcher-front_current .CubeSketcher-topFace").css({top:-r}),T(".CubeSketcher-side_current .CubeSketcher-sideFace").css({left:r}),T(".CubeSketcher-side_current .CubeSketcher-frontFace").css({top:-r}),T(".CubeSketcher-side_current .CubeSketcher-topFace").css({left:r}),T(".CubeSketcher-top_current .CubeSketcher-sideFace ").css({top:-r}),T(".CubeSketcher-top_current .CubeSketcher-frontFace").css({left:r}),T(".CubeSketcher-top_current .CubeSketcher-topFace").css({top:-r}),T(".CubeSketcher-sketchsearchCanvas").css({width:a-2*P}),T(".CubeSketcher-sketchsearchCanvas").css({height:a-2*P})}}(this._cubeContainer.innerWidth(),this._cubeContainer.innerHeight());var e=1.25*T(".CubeSketcher-sideFace").outerWidth(),t=(this._cubeContainer.width()-e)/2;T(".CubeSketcher-cube").css("left",t+"px");var o=1.25*T(".CubeSketcher-frontFace").outerHeight(!0),i=Math.abs(T(".CubeSketcher-topFace").position().top||T(".CubeSketcher-frontFace").position().top)+(this._cubeContainer.height()-o)/2;T(".CubeSketcher-cube").css("top",i+"px")}},e.prototype.init=function(e){var t=T(".CubeSketcher-front_canvas");if(this._canvasSize.x=t.width(),this._canvasSize.y=t.height(),!0===this._firstStart){this.resizeSketchSearch(),this._firstStart=!1;var o,i,a=T(".CubeSketcher-canvas").not(".CubeSketcher-tmp_canvas");for(o=0;o<a.length;o++)(i=a[o].getContext("2d")).fillStyle="#FFFFFF",i.fillRect(0,0,this._canvasSize.x,this._canvasSize.y)}g()?T(".CubeSketcher-frontFace").on("touchstart",n):T(".CubeSketcher-frontFace").on("mousedown",n),this._currentTool=m.BRUSH,this._currentColor=d.BLACK,this._currentType="front",void 0!==e&&(void 0!==e.tool&&(this._currentTool=e.tool),void 0!==e.color&&(this._currentColor=e.color),void 0!==e.type&&(this._currentType=e.type),void 0!==e.thickness&&(this._thickness=e.thickness)),g()?T(".CubeSketcher-frontFace").on("touchmove",l):T(".CubeSketcher-frontFace").on("mousemove",l),T(".CubeSketcher-frontFace").on("pinch",l),g()?T(document).on("touchend",r):T(document).on("mouseup",r),T(".CubeSketcher-frontFace, .CubeSketcher-sideFace, .CubeSketcher-topFace").on("click",function(){var e=T(this).find("canvas");_._currentType!==e.data("type")&&_.setActiveView(e.data("type")),g()&&(T(".CubeSketcher-image-x").hide(0),T(".CubeSketcher-image-y").hide(0)),_.setActiveView(this._currentType)})},e.prototype.destroy=function(){T(".CubeSketcher-"+_._currentType+"Face").off("touchmove",l),T(".CubeSketcher-"+_._currentType+"Face").off("touchstart",n),T(".CubeSketcher-"+_._currentType+"Face").off("mousemove",l),T(".CubeSketcher-"+_._currentType+"Face").off("mousedown",n),T(".CubeSketcher-"+_._currentType+"Face").off("pinch",l),T(document).off("touchend",r),T(document).off("mouseup",r),T(".CubeSketcher-frontFace, .CubeSketcher-sideFace, .CubeSketcher-topFace").off("click",_.setActiveView)},e.prototype.clearFace=function(e){e=e||this._currentType;var t=T(".CubeSketcher-"+e+"_canvas").get(0).getContext("2d");t.fillStyle="#FFFFFF",t.fillRect(0,0,this._canvasSize.x,this._canvasSize.y)},e.prototype.setCubeSketcherImages=function(e,t,o){if(void 0!==e){var i=new Image;i.onload=function(){c("front",i)},i.src=e}if(void 0!==t){var a=new Image;a.onload=function(){c("top",a)},a.src=t}if(void 0!==o){var r=new Image;r.onload=function(){c("side",r)},r.src=o}},e.prototype.clearCube=function(){var e=T(".CubeSketcher-top_canvas"),t=e.get(0),o=t.getContext("2d");o.fillStyle="#FFFFFF",o.fillRect(0,0,this._canvasSize.x,this._canvasSize.y),(o=(t=(e=T(".CubeSketcher-front_canvas")).get(0)).getContext("2d")).fillStyle="#FFFFFF",o.fillRect(0,0,this._canvasSize.x,this._canvasSize.y),(o=(t=(e=T(".CubeSketcher-side_canvas")).get(0)).getContext("2d")).fillStyle="#FFFFFF",o.fillRect(0,0,this._canvasSize.x,this._canvasSize.y)},e.prototype.getActiveView=function(){return this._currentType},e.prototype.setImageOnActiveView=function(e){if(void 0!==e){var t=new Image;t.onLoad=function(){c(_._currentType,t)},t.src=e}},e.prototype.setFloodFillTolerance=function(e){this._floodFillTolerance=e},{CubeSketcher:e,TOOLTYPE:m,COLORTYPE:d})}(jQuery),function(r){"use strict";function e(){this.isExporterActive=!1,this.activeExporter={},this.exporters={SKETCHUP:{name:"sketchup",handleExport:function(e){var i=function(e,t,o){var i="";0<t.length&&(i=document.location.protocol+"//"+document.location.host+PARTcloud.partcloudBasePath+t);var a={status:e,link:i,cluster_cookie_name:"PCL_CLUSTERNODE",cluster_cookie_value:o};window.location.href="skp:partcloud_export_action@"+JSON.stringify(a)},t={path:e.model_path+".prj",format:"COLLADA",options:"{}"};e.parametric&&0<PARTcloud.currentVarsettransfer.length&&r.extend(t,{varsettransfer:PARTcloud.currentVarsettransfer});var o=psol.exports.getExportFileUrlAsync(t);return o.done(function(e,t,o){i("success",e.url,o.getResponseHeader("X-Pcl-Clusternode"))}),o.fail(function(){i("error","")}),o}}}}e.prototype.activate=function(e){return!(!1!==this.isExporterActive||!this._checkIfExporterIsSupported(e))&&(this.isExporterActive=!0,this.activeExporter=this._getExporterReferenceByName(e),!0)},e.prototype.deactivate=function(){this.isExporterActive=!1,this.activeExporter={}},e.prototype.export=function(e){if(this.isExporterActive)return this.activeExporter.handleExport(e);var t=new r.Deferred;return t.reject(),t.promise()},e.prototype._checkIfExporterIsSupported=function(o){var i=!1;return r.each(this.exporters,function(e,t){if(t.name===o)return!(i=!0)}),i},e.prototype._getExporterReferenceByName=function(o){var i=this,a={};return r.each(this.exporters,function(e,t){if(t.name===o)return a=i.exporters[e],!1}),a},window.PARTcloudExporter=window.PARTcloudExporter||new e}(jQuery),function(r){"use strict";function e(){this.downloadOptions={}}e.prototype.download=function(e,t,o,i){var a=this.downloadOptions;psol.components.ProgressDialog.show({text:PARTcloudHelpers.translate("pcl_part_we_are_preparing_download")}),i?this._downloadPartserver(e,t,a):(r.extend(a,{options:o}),this._downloadPappserver(e,t,a))},e.prototype._downloadPartserver=function(e,t,o){var i=this;r.extend(o,{downloadflags:"ZIP"});var a="";e.parametric&&0<PARTcloud.currentVarsettransfer.length&&(a=PARTcloud.currentVarsettransfer),psol.order.orderData("",e.model_path+".prj",a,t,o,!1,1).done(function(e){"string"==typeof e.zipfile&&0<e.zipfile.length?i._downloadFile(e.zipfile):i._downloadError()}).fail(function(){i._downloadError()})},e.prototype._downloadPappserver=function(o,e,t){var i=this;r.extend(t,{path:o.model_path+".prj",format:e}),o.parametric&&0<PARTcloud.currentVarsettransfer.length&&r.extend(t,{varsettransfer:PARTcloud.currentVarsettransfer}),psol.exports.getExportFileUrlAsync(t).done(function(e){var t=document.location.protocol+"//"+document.location.host+PARTcloud.partcloudBasePath+e.url;i._downloadFile(t,o)}).fail(function(){i._downloadError()})},e.prototype._downloadFile=function(e,t){var o=r("<form></form>").attr("action",e).attr("method","GET").attr("target","_self");r("<input>").attr("type","hidden").attr("name","pcl_name").val(PARTcloudHelpers.encodeURIComponentNameForDownload(t.name)).appendTo(o),o.appendTo("body"),o.submit(),o.remove(),psol.components.ProgressDialog.hide({text:PARTcloudHelpers.translate("pcl_part_we_are_preparing_download")}),PARTcloudApi.increaseDownloadCount(t.model_id)},e.prototype._downloadError=function(){psol.components.ProgressDialog.hide({text:PARTcloudHelpers.translate("pcl_part_we_are_preparing_download")}),new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_part_error"),message:PARTcloudHelpers.translate("pcl_part_problem_generating")}).show()},window.PARTcloudDownloader=window.PARTcloudDownloader||new e}(jQuery),function(i){"use strict";function e(e){var o=this;return o.uploadData=[],e.forEach(function(e,t){o.uploadData[t]={file:e,valid:!1,license:{},name:"",category:"",description:"",additionalData:{},index:t}}),o.allValid=!1,o.uploadCounter=0,o.uploadPromise=i.Deferred(),o}e.prototype.upload=function(r){var n=[],t=this,o=t.uploadPromise;return t.uploadData.forEach(function(e,t){var o;if(window.PARTcloudCad)o=PARTcloudApi.uploadModelStandalone(e.name,e.description,e.category,e.license,e.additionalData,r),n.push(o);else{var i={files:[]};i.files.push(e.file);var a=e.additionalFileElement;e.additionalData.files=[],o=PARTcloudApi.uploadModel(e.name,e.description,e.category,e.license,e.additionalData,i,a,r),n.push(o)}}),window.setTimeout(function(){i.when.apply(t,n).done(function(e){o.resolve()}).fail(function(e){t.uploadPromise.reject(),t._uploadError(e)})},1e3),o.promise()},e.prototype._uploadError=function(e){var t=JSON.parse(e.responseText).message;new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_part_error"),message:PARTcloudHelpers.translate("pcl_part_upload_error")+": "+t}).show()},e.prototype.checkValidation=function(){var o=this;return o.allValid=!0,o.uploadData.forEach(function(e,t){!1===e.valid&&(o.allValid=!1)}),o.allValid},window.PARTcloudUploader=e}(jQuery),function(a){"use strict";function e(){this.defaultApiPortal="b2b",this.defaultLocale="en",this.config={},this.portals={b2b:{apiPortal:"b2b",portalName:"PARTcloud",getLocale:function(){return"undefined"!=typeof window&&void 0!==window.en4?window.en4.core.language.getLocale().split("_").shift():"en"},getEstimatedPrintingCosts:function(e){return(e.VOL.attributes.Volume.value/1e3*1.2).toFixed(2)}},partcloud:{apiPortal:"b2b",portalName:"PARTcloud",getLocale:function(){var t="en";return window.location.search.substr(1).split("&").forEach(function(e){"lang"===e.split("=").shift()&&(t=e.split("=").pop())}),t},getEstimatedPrintingCosts:function(e){return(e.VOL.attributes.Volume.value/1e3*1.2).toFixed(2)}},lynkoa:{apiPortal:"b2b",portalName:"Portfolio",getLocale:function(){var t="fr";return window.location.search.substr(1).split("&").forEach(function(e){"lang"===e.split("=").shift()&&(t=e.split("=").pop())}),t},getEstimatedPrintingCosts:function(e){return(e.VOL.attributes.Volume.value/1e3*1.2).toFixed(2)}}},this.portal=this.getPortal(),this.supportedLocales={}}e.prototype.init=function(){var t=this,e=new a.Deferred,o=PARTcloudApi.getConfigurations().done(function(e){t.config=e,t.config.features={additionalFiles:e.feature_additional_files,b2bIntegration:e.feature_b2b_integration,downloadLoggingCompany:e.feature_download_logging_company,downloadRequiresLogin:e.feature_download_requires_login,helpMenu:e.feature_help_menu,logout:e.feature_logout,maintenanceMode:e.feature_maintenance,manufacturingView:e.feature_manufacturing_view,qrCode:e.feature_qr_code,remotelogin:e.feature_remotelogin,scrollToMainNavigation:e.feature_scroll_to_main_navigation,supplierParts:e.feature_supplier_parts,uploadHint:e.feature_upload_hint,uploadMenu:e.feature_upload_menu,uploadMaintenanceMode:e.feature_upload_maintenance}}),i=PARTcloudApi.getLocales().done(function(e){t.supportedLocales=e});return a.when(o,i).then(function(){e.resolve()}),e.promise()},e.prototype.getPortal=function(){var e=window.PARTcloudPortalName?window.PARTcloudPortalName:this.defaultApiPortal;return void 0===this.portals[e]&&(e=this.defaultApiPortal),e},e.prototype.getApiPortal=function(){return this.portals[this.portal].apiPortal},e.prototype.getPortalName=function(){return this.portals[this.portal].portalName},e.prototype.getPageTitle=function(){return this.config.page_title},e.prototype.getPageDescription=function(){return this.config.page_description},e.prototype.getPageKeywords=function(){return this.config.page_keywords},e.prototype.getViewerColors=function(){return{top:this.config.viewer_color_top,bottom:this.config.viewer_color_bottom}},e.prototype.getModelsPerPage=function(){return this.config.models_per_page},e.prototype.getCommentsPerPage=function(){return this.config.comments_per_page},e.prototype.getTopUsersPerPage=function(){return this.config.top_users_per_page},e.prototype.getModelsPerSearchPage=function(){return this.config.models_per_search_page},e.prototype.getDefaultGeosearchQuality=function(){return this.config.default_geosearch_quality},e.prototype.getEstimatedPrintingCosts=function(e){return this.portals[this.portal].getEstimatedPrintingCosts(e)},e.prototype.getHelpIframeUrl=function(){return this.config.help_iframe_url},e.prototype.getNavigationBasePath=function(){return this.config.navigation_base_path},e.prototype.getAnalyticsConfig=function(){return{siteId:this.config.analytics_site_id,liveHostname:this.config.analytics_site_hostname}},e.prototype.getServerTypeForDownloadLogging=function(){return this.config.download_logging_server_type},e.prototype.getUploadMaxFileSize=function(){return this.config.upload_max_file_size},e.prototype.getAppUrl=function(e){switch(e){case"ios":return this.config.app_url_ios;case"android":return this.config.app_url_android;case"windows":return this.config.app_url_windows;default:return this.config.app_url}},e.prototype.getLocale=function(){if(void 0===this.locale){var e=this.portals[this.portal].getLocale();void 0!==this.supportedLocales[e]?this.locale=e:this.locale=this.defaultLocale}return this.locale},e.prototype.isFeatureEnabled=function(e){return this.config.features[e]||!1},e.prototype.getHotSpotsConfig=function(){return{serviceBaseUrl:this.config.hotspots_service_base_url}},window.PARTcloudConfig=window.PARTcloudConfig||new e}(jQuery),function(v){"use strict";function e(){this.communityBasePath="/community",this.apiUri="/community/partcloud/api.php",this.appServerUri="/community/partcloud/service",this.projectInfoCache={},this.portal=PARTcloudConfig.getPortal(),this.apiPortal=PARTcloudConfig.getApiPortal()}e.prototype.topologyStatus={ready:"ready",calculating:"calculating"},e.prototype.init=function(){this.locale=PARTcloudConfig.getLocale()},e.prototype.availableOrderTypes=["newest","most_viewed","most_liked","most_downloaded","relevance"],e.prototype.getLocales=function(){return v.getJSON(this.apiUri,{controller:"Configurations",action:"getLocales"})},e.prototype.getTranslations=function(){return v.getJSON(this.apiUri,{controller:"Configurations",action:"getTranslations",locale:this.locale})},e.prototype.getConfigurations=function(){return v.getJSON(this.apiUri,{controller:"Configurations",action:"get",portal:this.portal})},e.prototype.getEnvironments=function(e,t){return e=e||!1,t=t||!1,v.getJSON(this.apiUri,{controller:"Environments",action:"get",locale:this.locale,skyboxes:e,floors:t})},e.prototype.getModel=function(e,t){var o={controller:"Models",action:"getSingle",model_id:e,user:!0,likes:!1,tags:!0,comments:!1,images:!0,camera:!0,hotspots:!0,locale:this.locale};return"string"==typeof t&&0<t.length&&v.extend(o,{share_key:t}),v.getJSON(this.apiUri,o)},e.prototype.getModelSimple=function(e,t){var o={controller:"Models",action:"getSingle",model_id:e,user:!1,likes:!1,tags:!1,comments:!1,images:!1,camera:!1,locale:this.locale};return"string"==typeof t&&0<t.length&&v.extend(o,{share_key:t}),v.getJSON(this.apiUri,o)},e.prototype.getModelsAll=function(e,t,o,i,a,r,n){e=e||12,t=t||0,o=o||"newest",i=i||!1,n=n||!0;var l={controller:"Models",action:"get",portal:this.apiPortal,user:!0,limit:e,offset:t,order:o,printable:i,has_admin_tag:n,locale:this.locale};return a&&v.extend(l,{where_category:a}),r&&r.trim()&&v.extend(l,{search:r}),v.getJSON(this.apiUri,l)},e.prototype.getModelsByUserId=function(e,t,o,i,a,r,n,l,d,s){t=t||8,o=o||0,i=i||"newest",a=a||!1,d=d||!0;var c={controller:"Models",action:"get",portal:this.apiPortal,user:!0,where_tag:s,where_user:e,limit:t,offset:o,order:i,printable:a,pending:l,has_admin_tag:d,locale:this.locale};return r&&v.extend(c,{where_category:r}),n&&n.trim()&&v.extend(c,{search:n}),v.getJSON(this.apiUri,c)},e.prototype.getModelsLikedByUserId=function(e,t,o,i,a,r,n,l,d){t=t||12,o=o||0,i=i||"newest",a=a||!1,l=l||!0;var s={controller:"Models",action:"get",portal:this.apiPortal,user:!0,where_tag:d,where_liker:e,limit:t,offset:o,order:i,printable:a,has_admin_tag:l,locale:this.locale};return r&&v.extend(s,{where_category:r}),n&&n.trim()&&v.extend(s,{search:n}),v.getJSON(this.apiUri,s)},e.prototype.getModelsByTagId=function(e,t,o,i,a,r,n,l){t=t||12,o=o||0,i=i||"newest",a=a||!1,l=l||!0;var d={controller:"Models",action:"get",portal:this.apiPortal,user:!0,where_tag:e,limit:t,offset:o,order:i,printable:a,has_admin_tag:l,locale:this.locale};return r&&v.extend(d,{where_category:r}),n&&n.trim()&&v.extend(d,{search:n}),v.getJSON(this.apiUri,d)},e.prototype.getOriginalFile=function(e,t){var o={controller:"Models",action:"getOriginalFile",model_id:e,user:!0};return"string"==typeof t&&0<t.length&&v.extend(o,{share_key:t}),v.getJSON(this.apiUri,o)},e.prototype.setOriginalFileDownload=function(e,t){return v.getJSON(this.apiUri,{controller:"Models",action:"setOriginalFileDownload",model_id:e,enable_flag:t,user:!0})},e.prototype.searchModels=function(e,t,o,i,a,r){o=o||12,i=i||0,a=a||"relevance",r=r||!0;var n={controller:"Models",action:"get",portal:this.apiPortal,user:!0,where_tag:e,limit:o,offset:i,order:a,has_admin_tag:r,locale:this.locale};return t&&v.extend(n,{search:t}),v.getJSON(this.apiUri,n)},e.prototype.likeModel=function(e){return v.post(this.apiUri,{controller:"Likes",action:"like",model_id:e})},e.prototype.setCamera=function(e,t){return v.post(this.apiUri,{controller:"Models",action:"setCamera",model_id:e,camera:t})},e.prototype.addHotspot=function(e,t){return v.ajax({url:this.apiUri,cache:!1,method:"POST",data:{controller:"Models",action:"addHotspot",model_id:e,hotspot:t}})},e.prototype.editHotspot=function(e,t){return v.ajax({url:this.apiUri,cache:!1,method:"POST",data:{controller:"Models",action:"editHotspot",model_id:e,hotspot:t}})},e.prototype.deleteHotspot=function(e,t){return v.ajax({url:this.apiUri,cache:!1,method:"POST",data:{controller:"Models",action:"deleteHotspot",model_id:e,hotspot:t}})},e.prototype.setPrintability=function(e,t){return v.post(this.apiUri,{controller:"Models",action:"setPrintability",model_id:e,printability:t})},e.prototype.getComments=function(e,t,o){return t=t||10,o=o||0,v.getJSON(this.apiUri,{controller:"Comments",action:"get",model_id:e,limit:t,offset:o})},e.prototype.commentModelAdd=function(e,t){return v.ajax({url:this.apiUri,cache:!1,method:"POST",data:{controller:"Comments",action:"add",model_id:e,comment_text:t}})},e.prototype.commentModelEdit=function(e,t){return v.ajax({url:this.apiUri,cache:!1,method:"POST",data:{controller:"Comments",action:"edit",comment_id:e,comment_text:t}})},e.prototype.commentModelDelete=function(e){return v.ajax({url:this.apiUri,cache:!1,method:"POST",data:{controller:"Comments",action:"delete",comment_id:e}})},e.prototype.getFiles=function(e){return v.getJSON(this.apiUri,{controller:"Files",action:"get",model_id:e})},e.prototype.uploadFile=function(e,t,o,i,a,r){var n=i.files[0],l=new FormData;return l.append("controller","Files"),l.append("action","add"),l.append("model_id",e),l.append("type",t),0<o.length&&l.append("name",o),l.append("file",n),v.ajax({url:this.apiUri,method:"POST",data:l,processData:!1,contentType:!1,dataType:"json",xhr:function(){var e=v.ajaxSettings.xhr();return e.upload.onprogress=function(e){a(e)},e.upload.onload=function(){r()},e}})},e.prototype.deleteFile=function(e){return v.post(this.apiUri,{controller:"Files",action:"delete",file_id:e})},e.prototype.getFileTypes=function(){return v.getJSON(this.apiUri,{controller:"Files",action:"getFileTypes",portal:this.apiPortal})},e.prototype.getManufacturers=function(){return v.getJSON(this.apiUri,{controller:"Manufacturers",action:"get",portal:this.apiPortal})},e.prototype.getTopUsers=function(e,t,o){return v.getJSON(this.apiUri,{controller:"Users",action:"getTopUsers",portal:this.apiPortal,limit:e,offset:t,model_count:o,locale:this.locale})},e.prototype.getUserRank=function(e,t){return v.getJSON(this.apiUri,{controller:"Users",action:"getUserRank",user_id:e,portal:this.apiPortal,model_count:t,locale:this.locale})},e.prototype.exportModel=function(e,t,o){var i={controller:"Orders",action:"order",model_id:e,manufacturer:t};return"string"==typeof o&&0<o.length&&v.extend(i,{share_key:o}),v.getJSON(this.apiUri,i)},e.prototype.exportCollection=function(e,t,o){var i={controller:"Orders",action:"order",collection_id:e,manufacturer:t};return void 0!==o&&(i.format=o),v.getJSON(this.apiUri,i)},e.prototype.getOrderStatus=function(e){return v.getJSON(this.apiUri,{controller:"Orders",action:"getStatus",order_id:e})},e.prototype.claimOrder=function(e){return v.getJSON(this.apiUri,{controller:"Orders",action:"claim",order_id:e})},e.prototype.uploadImage=function(e,t,o,i,a){var r=o.files[0],n=new FormData;return n.append("controller","Images"),n.append("action","add"),n.append("model_id",e),0<t.length&&n.append("description",t),n.append("file",r),v.ajax({url:this.apiUri,method:"POST",data:n,processData:!1,contentType:!1,dataType:"json",xhr:function(){var e=v.ajaxSettings.xhr();return e.upload.onprogress=function(e){i(e)},e.upload.onload=function(){a()},e}})},e.prototype.uploadImageBase64=function(e,t,o){var i={controller:"Images",action:"add",model_id:e,image_base64:o};return 0<t.length&&i.append("description",t),v.ajax({url:this.apiUri,cache:!1,method:"POST",data:i})},e.prototype.setPreviewImage=function(e,t){return v.post(this.apiUri,{controller:"Images",action:"setPreview",model_id:e,image_id:t})},e.prototype.deleteImage=function(e){return v.post(this.apiUri,{controller:"Images",action:"delete",image_id:e})},e.prototype.uploadModel=function(e,t,o,i,a,r,n,l){var d=r.files[0],s=new FormData;return s.append("controller","Models"),s.append("action","add"),s.append("portal",this.apiPortal),s.append("name",e),s.append("description",t),s.append("category_id",o),s.append("license_id",i),v.each(a,function(e,t){s.append(e,t)}),s.append("file",d),n&&n.files instanceof Array&&n.files.forEach(function(e,t){s.append("additionalfile"+t,n.files[t])}),v.ajax({url:this.apiUri,method:"POST",data:s,processData:!1,contentType:!1,dataType:"json",xhr:function(){var e=v.ajaxSettings.xhr();return e.upload.onprogress=function(e){l(e)},e}})},e.prototype.uploadModelStandalone=function(e,t,o,i,a,r){var n={controller:"Models",action:"add",portal:this.apiPortal,name:e,description:t,category_id:o,license_id:i};return v.each(a,function(e,t){n[e]=t}),PARTcloudCad.uploadModel(this.apiUri,n,r)},e.prototype.editModelData=function(e){return v.extend(e,{controller:"Models",action:"edit"}),v.post(this.apiUri,e)},e.prototype.deleteModel=function(e){return v.post(this.apiUri,{controller:"Models",action:"delete",model_id:e})},e.prototype.increaseDownloadCount=function(e){return v.getJSON(this.apiUri,{controller:"Models",action:"increaseDownloadCount",model_id:e})},e.prototype.getLicenses=function(){return v.getJSON(this.apiUri,{controller:"Licenses",action:"get",locale:this.locale,portal:this.apiPortal})},e.prototype.getCategories=function(){return v.getJSON(this.apiUri,{controller:"Categories",action:"get",portal:this.apiPortal,children:!1,locale:this.locale})},e.prototype.getCategoriesAll=function(){return v.getJSON(this.apiUri,{controller:"Categories",action:"get",portal:this.apiPortal,children:!0,locale:this.locale})},e.prototype.getCategoriesChildren=function(e){return v.getJSON(this.apiUri,{controller:"Categories",action:"getChildren",category_id:e,locale:this.locale})},e.prototype.geosearchFile=function(e,t,o,i){t=t||12;var a=e.files[0],r=new FormData;return r.append("controller","Models"),r.append("action","get"),r.append("portal",this.apiPortal),r.append("where_geosearchfile",a),r.append("user","true"),r.append("limit",t),v.ajax({url:this.apiUri,method:"POST",data:r,processData:!1,contentType:!1,dataType:"json",xhr:function(){var e=v.ajaxSettings.xhr();return e.upload.onprogress=function(e){o(e)},e.upload.onload=function(){i()},e}})},e.prototype.geosearchSketch=function(e,t,o,i,a){return a=a||12,i=Math.round(i)||80,v.ajax({url:this.apiUri,method:"POST",cache:!1,data:{controller:"Models",action:"get",portal:this.apiPortal,where_sketchsearch:!0,sketchsearch_front:e,sketchsearch_top:t,sketchsearch_side:o,geosearch_quality:i,user:!0,limit:a,locale:this.locale}})},e.prototype.getSimilarParts=function(e,t,o,i){return i=i||!1,o=o||8,t=Math.round(t)||80,v.getJSON(this.apiUri,{controller:"Models",action:"get",portal:this.apiPortal,where_geosearch:e,geosearch_quality:t,size_dependent_search:i,user:!0,has_admin_tag:!0,limit:o,locale:this.locale})},e.prototype.shareGeosearchResult=function(e){return v.extend(e,{controller:"Models",action:"shareGeosearchResult"}),v.post(this.apiUri,e)},e.prototype.getSupplierParts=function(e,t,o){return o=o||8,t=Math.round(t)||80,v.getJSON(this.apiUri,{controller:"Models",action:"getSupplierParts",model_id:e,geosearch_quality:t,limit:o})},e.prototype.login=function(e,t,o){return o=o?"1":"",v.ajax({url:this.communityBasePath+"/login",method:"POST",cache:!1,data:{email_field:"cmFuZG9tZmllbGQ=",randomfield:e,password:t,remember:o}})},e.prototype.loginWithToken=function(e){return v.ajax({url:this.communityBasePath+"/login",method:"POST",cache:!1,data:{remotelogintoken:e}})},e.prototype.logout=function(){return v.ajax({url:this.communityBasePath+"/logout",method:"POST",cache:!1})},e.prototype.register=function(e,t,o,i,a,r,n,l,d,s,c,u,p,m,g,h,f){var w=new FormData;return w.append("controller","Users"),w.append("action","add"),w.append("email",e),w.append("password",t),w.append("password_confirm",o),w.append("first_name",i),w.append("last_name",a),w.append("company",r),w.append("street",n),w.append("zip",l),w.append("city",d),w.append("country",s),w.append("language",c),w.append("timezone",u),w.append("accepted_tos",m),w.append("cad_models_contact",g),w.append("newsletter",h),w.append("g-recaptcha-response",f),p.files[0]&&w.append("profile_picture",p.files[0]),v.ajax({url:this.apiUri,method:"POST",data:w,processData:!1,contentType:!1,dataType:"json"})},e.prototype.getLanguages=function(){return v.getJSON(this.apiUri,{controller:"Configurations",action:"getLanguages"})},e.prototype.getTimezones=function(){return v.getJSON(this.apiUri,{controller:"Configurations",action:"getTimezones"})},e.prototype.getCountries=function(){return v.getJSON(this.apiUri,{controller:"Configurations",action:"getCountries"})},e.prototype.getLoginStatus=function(){return v.ajax({url:this.apiUri,cache:!1,data:{controller:"Users",action:"loginstatus"}})},e.prototype.createCollection=function(e,t,o){var i={controller:"Collections",action:"add",name:e,model_id:o};return t&&v.extend(i,{description:t}),v.post(this.apiUri,i)},e.prototype.removeModelFromCollection=function(e){return v.post(this.apiUri,{controller:"Collections",action:"removeModel",model_id:e})},e.prototype.addModelToCollection=function(e,t){return v.post(this.apiUri,{controller:"Collections",action:"addModel",model_id:e,collection_id:t})},e.prototype.getUserCollections=function(e){return v.getJSON(this.apiUri,{controller:"Collections",action:"get",portal:this.apiPortal,limit:100,where_user:e})},e.prototype.getCollection=function(e){return v.getJSON(this.apiUri,{controller:"Collections",action:"getSingle",collection_id:e})},e.prototype.getCollectionModels=function(e,t,o,i){return t=t||10,o=o||0,v.getJSON(this.apiUri,{controller:"Models",action:"get",portal:this.apiPortal,user:!0,where_collection:e,limit:t,offset:o,has_admin_tag:i,locale:this.locale})},e.prototype.editCollectionName=function(e,t){return v.post(this.apiUri,{controller:"Collections",action:"edit",name:t,collection_id:e})},e.prototype.editCollectionDescription=function(e,t){return v.post(this.apiUri,{controller:"Collections",action:"edit",description:t,collection_id:e})},e.prototype.getTagsLike=function(e,t,o,i){var a={controller:"Tags",action:"get",like:e,adminTags:t,limit:i=i||30,locale:this.locale};return o&&v.extend(a,{increaseRelevance:o}),v.getJSON(this.apiUri,a)},e.prototype.getLocaleTagsLikeForModel=function(e,t,o,i){var a={controller:"Tags",action:"get",like:e,no_duplicates_for_model:t,limit:i=i||30,locale:this.locale};return o&&v.extend(a,{increaseRelevance:o}),v.getJSON(this.apiUri,a)},e.prototype.getTagsLikeForModel=function(e,t,o,i){var a={controller:"Tags",action:"get",like:e,limit:i=i||30,no_duplicates_for_model:t};return o&&v.extend(a,{increaseRelevance:o}),v.getJSON(this.apiUri,a)},e.prototype.addLocaleModelTag=function(e,t){return v.ajax({url:this.apiUri,method:"POST",cache:!1,data:{controller:"Tags",action:"add",model_id:e,name:t,locale:this.locale}})},e.prototype.addModelTag=function(e,t,o){var i={controller:"Tags",action:"add",model_id:e,name:t,locale:this.locale};return"string"==typeof o&&0<o.length&&v.extend(i,{share_key:o}),v.ajax({url:this.apiUri,method:"POST",cache:!1,data:i})},e.prototype.removeModelTag=function(e,t,o){var i={controller:"Tags",action:"remove",model_id:e,tag_id:t};return"string"==typeof o&&0<o.length&&v.extend(i,{share_key:o}),v.ajax({url:this.apiUri,method:"POST",cache:!1,data:i})},e.prototype.shareModel=function(e,t){return v.post(this.apiUri,{controller:"Shares",action:"share",model_id:e,user_id:t})},e.prototype.unshareModel=function(e,t){return v.post(this.apiUri,{controller:"Shares",action:"unshare",model_id:e,user_id:t})},e.prototype.getShares=function(e,t,o){return t=t||20,o=o||0,v.getJSON(this.apiUri,{controller:"Shares",action:"get",model_id:e,offset:o,limit:t})},e.prototype.shareModelWithGroup=function(e,t){return v.post(this.apiUri,{controller:"GroupShares",action:"share",model_id:e,group_id:t})},e.prototype.unshareModelWithGroup=function(e,t){return v.post(this.apiUri,{controller:"GroupShares",action:"unshare",model_id:e,group_id:t})},e.prototype.getSharesWithGroup=function(e,t,o){return t=t||99,o=o||0,v.getJSON(this.apiUri,{controller:"GroupShares",action:"get",model_id:e,offset:o,limit:t})},e.prototype.getUsersForSharingByName=function(e,t,o,i){return o=o||10,i=i||0,v.getJSON(this.apiUri,{controller:"Users",action:"get",like:e,no_duplicates_for_model:t,limit:o,offset:i})},e.prototype.getUsersForSharingByEmail=function(e,t){return v.getJSON(this.apiUri,{controller:"Users",action:"getUserByEmail",email:e,no_duplicates_for_model:t})},e.prototype.getGroupsForSharingByName=function(e,t,o,i,a){return i=i||10,a=a||0,o=o||!1,v.getJSON(this.apiUri,{controller:"Groups",action:"getGroupsByName",like:e,no_duplicates_for_model:t,limit:i,offset:a,include_member_count:o})},e.prototype.getGroupsForSharingByEmail=function(e,t,o,i,a){return i=i||10,a=a||0,o=o||!1,v.getJSON(this.apiUri,{controller:"Groups",action:"getGroupsByEmail",email:e,no_duplicates_for_model:t,limit:i,offset:a,include_member_count:o})},e.prototype.getDownloadFormats=function(e){return v.getJSON(this.apiUri,{controller:"Models",action:"getDownloadFormats",model_id:e})},e.prototype.getDefaultDownloadFormats=function(e){return v.getJSON(this.apiUri,{controller:"Configurations",action:"getDefaultDownloadFormats",model_id:e})},e.prototype.getProjectInfo=function(t){var o=this;return v.Deferred(function(){var i=this;o.projectInfoCache[t.model_id]&&void 0!==o.projectInfoCache[t.model_id].topology?i.resolve(o.projectInfoCache[t.model_id]):v.getJSON(o.appServerUri+"/partcloud/project/info",{path:t.model_path+".prj",withtopology:!0}).done(function(e){o.projectInfoCache[t.model_id]=e,i.resolve(e)}).fail(function(e,t,o){i.reject(e,t,o)})})},e.prototype.getTopology=function(e){var o=this;return v.Deferred(function(){var t=this;o.getProjectInfo(e).done(function(e){e.hasOwnProperty("topology")?(e.topology.topologyStatus=o.topologyStatus.ready,t.resolve(e.topology)):t.resolve({topologyStatus:o.topologyStatus.calculating})}).fail(function(){t.reject()})})},e.prototype.sortModelsByQualityDistance=function(e,o){if(void 0!==e)return o="boolean"==typeof o&&!0===o?-1:1,e.sort(function(e,t){return e.quality_distance>t.quality_distance?o:e.quality_distance<t.quality_distance?-1*o:0})},e.prototype.sortSupplierPartsByQualityDistance=function(e,o){if(void 0!==e)return o="boolean"==typeof o&&!0===o?-1:1,e.sort(function(e,t){return e.geometric.distance>t.geometric.distance?o:e.geometric.distance<t.geometric.distance?-1*o:0})},window.PARTcloudApi=window.PARTcloudApi||new e}(jQuery),function(e){"use strict";function t(){var e=PARTcloudConfig.getAnalyticsConfig();this.siteId=e.siteId,this.liveHostname=e.liveHostname,this.trackerHost=document.location.protocol+"//analytics.partcommunity.com",this.trackerScript=this.trackerHost+"/piwik.js",this.trackerService=this.trackerHost+"/piwik.php",window.location.hostname===this.liveHostname&&(window._paq=window._paq||[],window._paq.push(["setSiteId",this.siteId]),window._paq.push(["setTrackerUrl",this.trackerService]))}t.prototype.logRequest=function(e,t){window.location.hostname===this.liveHostname&&(window._paq.push(["setReferrerUrl",e]),window._paq.push(["setCustomUrl",t]),window._paq.push(["trackPageView"]))},t.prototype.logDownload=function(e,t){window.location.hostname===this.liveHostname&&(window._paq.push(["setCustomUrl",window.location.href]),window._paq.push(["trackEvent","PARTcloud","Download",t,e]))},window.PARTcloudAnalytics=window.PARTcloudAnalytics||new t}(jQuery),function(e){"use strict";function t(){this.translations={}}t.prototype.init=function(){var t=this,o=new e.Deferred;return PARTcloudApi.getTranslations().done(function(e){t.translations=e,o.resolve()}),o.promise()},t.prototype.defaultValue=function(e,t){return void 0!==e?e:t},t.prototype.translate=function(e){return this.translations[e]||e},t.prototype.round=function(e){return Math.round(e)},t.prototype.getQualityDistanceColor=function(e,t){var o,i,a,r={red:232,green:216,blue:76},n={red:255,green:7,blue:7};a=85<=e?(o={red:38,green:160,blue:19},i=r,100/15*(100-e)):60<=e?(o=r,i=n,4*(85-e)):(o=i=n,0);var l=i.red-o.red,d=i.green-o.green,s=i.blue-o.blue,c=this.round(l*a/100+o.red),u=this.round(d*a/100+o.green),p=this.round(s*a/100+o.blue);return"boolean"==typeof t&&!0===t?{red:c,green:u,blue:p}:"rgb("+c+","+u+","+p+")"},t.prototype.getQualityDistanceColorInverse=function(e,t){var o=this.getQualityDistanceColor(e,!0),i=255-o.red,a=255-o.green,r=255-o.blue;return"boolean"==typeof t&&!0===t?{red:i,green:a,blue:r}:"rgb("+i+","+a+","+r+")"},t.prototype.getLikedClass=function(){return"liked"},t.prototype.getNotLikedClass=function(){return""},t.prototype.encodeURIComponent=function(e){return encodeURIComponent(e)},t.prototype.encodeURIComponentName=function(e){return encodeURIComponent(e).replace(/%20/g,"+")},t.prototype.encodeURIComponentNameForDownload=function(e){return e.replace(/\W+/g,"_")},t.prototype.decodeURIComponent=function(e){return decodeURIComponent(e)},t.prototype.decodeURIComponentName=function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))},t.prototype.getTextFromHtml=function(e,t,o){var i=document.implementation.createHTMLDocument("").createElement("div");function a(e){return i.innerHTML=e,e=i.textContent,i.textContent="",e}var r,n=function(e){if(e&&"string"==typeof e){for(var t=a(e);e!==t;)t=a(e=t);return t}}(e);return t&&(r={"&":"&amp;",'"':"&quot;","'":"&#039;","<":"&lt;",">":"&gt;"},n=n.replace(/[&<>"']/g,function(e){return r[e]})),o&&(n=n.replace(/(?:\r\n|\r|\n)/g," ")),n},t.prototype.prependCommunityBaseUrl=function(e){var t="/"===e.charAt(0)?"":"/";return PARTcloud.communityBaseUrl+t+e},t.prototype.prependPartcloudBaseUrl=function(e){var t="/"===e.charAt(0)?"":"/";return PARTcloud.partcloudBaseUrl+t+e},t.prototype.prependPartcloudBaseDocument=function(e){return PARTcloud.partcloudBaseDocument+e},t.prototype.prependPcomBaseUrl=function(e){var t="/"===e.charAt(0)?"":"/";return PARTcloud.pcomBaseUrl+t+e},t.prototype.buildPcomPartPreviewUrl=function(e,t,o){return PARTcloud.pcomFileServiceUrl+"?previewPath="+encodeURIComponent(e)+"&width="+t+"&height="+o},t.prototype.buildPcomCatalogPreviewUrl=function(e,t,o){var i="/"===e.charAt(0)?"":"/";return e=e.split("/"),PARTcloud.pcomFileServiceUrl+i+e[0]+"?previewPath="+e[1]+"&width="+t+"&height="+o},t.prototype.setCookie=function(e,t,o){var i="";if(0!==o){var a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3),i="expires="+a.toUTCString()}document.cookie=e+"="+t+";"+i},t.prototype.getCookie=function(e){for(var t=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var a=o[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},t.prototype.getLocalStorageItem=function(e){if(void 0!==window.localStorage)return window.localStorage.getItem(e)},t.prototype.setLocalStorageItem=function(e,t){void 0!==window.localStorage&&window.localStorage.setItem(e,t)},t.prototype.removeLocalStorageItem=function(e){void 0!==window.localStorage&&window.localStorage.removeItem(e)},t.prototype.getSessionStorageItem=function(e){if(void 0!==window.sessionStorage)return window.sessionStorage.getItem(e)},t.prototype.setSessionStorageItem=function(e,t){void 0!==window.sessionStorage&&window.sessionStorage.setItem(e,t)},t.prototype.removeSessionStorageItem=function(e){void 0!==window.sessionStorage&&window.sessionStorage.removeItem(e)},t.prototype.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},t.prototype.validateEmail=function(e){return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)},t.prototype.getParameter=function(e,t){var o=window.location.href;return this.getParameterFromUrl(o,e,t)},t.prototype.getParameterFromUrl=function(e,t,o){var i=e.indexOf(t+"="),a="";if(-1!==i){var r=e.indexOf("#",i);-1===r&&(r=e.indexOf("&",i)),a=-1===r?e.substr(i+t.length+1):e.substr(i+t.length+1,r-(i+t.length+1))}return void 0!==a&&""!==a?(a=a.replace(/\+/g,"%20"),decodeURIComponent(a)):o},t.prototype.getRoute=function(e){var t,o=this.getParameterFromUrl(e,"route",!1);o?t=["route",o]:t=new RegExp("#!([a-z0-9-]+)","i").exec(e);return t},t.prototype.getFullLinkToPart=function(e,t){var o=document.location.protocol+"//"+document.location.host+PARTcloudConfig.getNavigationBasePath();return o+="?route=part&name="+this.encodeURIComponentName(t)+"&model_id="+e},t.prototype.groupByProperty=function(e,o){return e.reduce(function(e,t){return(e[t[o]]=e[t[o]]||[]).push(t),e},{})},window.PARTcloudHelpers=window.PARTcloudHelpers||new t}(jQuery),function(O){"use strict";function e(){var e=document.location.protocol+"//"+document.location.host;this.communityBasePath="/community",this.communityBaseUrl=e+this.communityBasePath,this.partcloudBasePath="/community/partcloud",this.partcloudBaseUrl=e+this.partcloudBasePath,this.partcloudBaseDocument=e+document.location.pathname,this.pcomBasePath="/3d-cad-models",this.pcomBaseUrl=e+this.pcomBasePath,this.pcomFileServicePath="/FileService/CatalogImage/",this.pcomFileServiceUrl=e+this.pcomFileServicePath,this.loginStatus={},this.allowedExtensionsForUpload=["ase","3ds","blend","cip","dae","fbx","glb","gltf","ifc","lwo","lws","obj","ply","step","stl","stp","zjv"],this.allowedExtensionForProfilePicture=["jpg","jpeg","png"],this.googleRecaptchaSiteKey="6Le7lQITAAAAAH-VxqVXamADPPyZiywAIDOGIwau",this.licenses={shareAlike:1,externalDownload:997,private:998,noDownload:999},this.isWebGLSupportedFlag=void 0,this.viewer={},this.stlViewer={},this.table={},this.isViewerInitialized=!1,this.isStlViewerInitialized=!1,this.currentVarsettransfer="",this.viewConfig={loadCss:!1,loadTmpl:!1},this.requests=[]}e.prototype.init=function(){this.pageTitleDefault=PARTcloudConfig.getPageTitle(),this.pageDescriptionDefault=PARTcloudConfig.getPageDescription(),this.pageKeywordsDefault=PARTcloudConfig.getPageKeywords(),this.pageImageDefault="",this.modelsPerPage=PARTcloudConfig.getModelsPerPage(),this.commentsPerPage=PARTcloudConfig.getCommentsPerPage(),this.topUsersPerPage=PARTcloudConfig.getTopUsersPerPage(),this.modelsPerSearchPage=PARTcloudConfig.getModelsPerSearchPage(),this.geosearchQuality=PARTcloudConfig.getDefaultGeosearchQuality(),this.navigationBasePath=PARTcloudConfig.getNavigationBasePath();var e=PARTcloudConfig.getViewerColors();this.viewerColorTop=e.top,this.viewerColorBottom=e.bottom;var t="index.html"===this.getDocumentName();this.viewConfig.loadCss=t,this.viewConfig.loadTmpl=t},e.prototype.main=function(){var t=this,o=document.location.href;psol.core.setServiceBaseUrl(document.location.protocol+"//"+document.location.host+t.partcloudBasePath);var e=psol.core.getLanguageByShortIso(PARTcloudConfig.getLocale()),i=e&&e.language||"english";psol.core.setLanguage(i),t.isHistoryApiSupported()&&history.replaceState({url:o},t.getPageTitle(),o),PARTcloudConfig.isFeatureEnabled("maintenanceMode")?brite.display("MaintenanceView","#PARTcloudApp"):t.getLoginStatus().done(function(){if(window.PARTcloudCad)t.showStandaloneUploadPartsPage();else{var e=PARTcloudHelpers.getRoute(o);e&&e[1]&&("embedded"===e[1]||"embedded-viewer"===e[1])?t.route(o):brite.display("MainView","#PARTcloudApp").done(function(){t.route(o)})}})},e.prototype.isHistoryApiSupported=function(){return!(!window.history||void 0===history.pushState)},e.prototype.isMatchMediaApiSupported=function(){return!!window.matchMedia},e.prototype.isWebGLSupportedCheck=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},e.prototype.isWebGLSupported=function(){return"boolean"!=typeof this.isWebGLSupportedFlag&&(this.isWebGLSupportedFlag=this.isWebGLSupportedCheck()),this.isWebGLSupportedFlag},e.prototype.matchMediaMinWidth=function(e){return this.isMatchMediaApiSupported()?window.matchMedia("(min-width:"+e+"px)").matches:O(document).width()>=e},e.prototype.getPageTitle=function(){var e=document.title;return e||(e=this.pageTitleDefault),e},e.prototype.setPageTitle=function(e){document.title=e?O.trim(e)+" - "+this.pageTitleDefault:this.pageTitleDefault},e.prototype.getPageDescription=function(){var e=O("meta[name=description]").attr("content");return e||(e=this.pageDescriptionDefault),e},e.prototype.setPageDescription=function(e){var t=O("meta[name=description]");if(void 0===t.get(0)&&(t=O("head").append("<meta name='description' content=''>")),e){var o=new RegExp("^(.{220,310})(?:[\\.\\b,:;\\(\\)\\/])","i");e=O.trim(PARTcloudHelpers.getTextFromHtml(e,!0,!0));var i=o.exec(e);i&&1<i.length&&(e=i[1]),t.attr("content",e)}else t.attr("content",this.pageDescriptionDefault)},e.prototype.getPageKeywords=function(){var e=O("meta[name=keywords]").attr("content");return e||(e=this.pageKeywordsDefault),e},e.prototype.setPageKeywords=function(e){var t=O("meta[name=keywords]");void 0===t.get(0)&&(t=O("head").append("<meta name='keywords' content=''>")),e?t.attr("content",O.trim(e)):t.attr("content",this.pageKeywordsDefault)},e.prototype.getPageOpenGraphTitle=function(){var e=O("meta[property='og:title']").attr("content");return e||(e=this.pageTitleDefault),e},e.prototype.setPageOpenGraphTitle=function(e){void 0===O("meta[property='og:type']").get(0)&&O("head").append("<meta property='og:type' content='website'>");var t=O("meta[property='og:title']");void 0===t.get(0)&&(t=O("head").append("<meta property='og:title' content=''>")),e?t.attr("content",O.trim(e)):t.attr("content",this.pageTitleDefault)},e.prototype.getPageOpenGraphDescription=function(){var e=O("meta[property='og:description']").attr("content");return e||(e=this.pageDescriptionDefault),e},e.prototype.setPageOpenGraphDescription=function(e){void 0===O("meta[property='og:type']").get(0)&&O("head").append("<meta property='og:type' content='website'>");var t=O("meta[property='og:description']");if(void 0===t.get(0)&&(t=O("head").append("<meta property='og:description' content=''>")),e){var o=new RegExp("^(.{220,310})(?:[\\.\\b,:;\\(\\)\\/])","i");e=O.trim(PARTcloudHelpers.getTextFromHtml(e,!0,!0));var i=o.exec(e);i&&1<i.length&&(e=i[1]),t.attr("content",e)}else t.attr("content",this.pageDescriptionDefault)},e.prototype.getPageOpenGraphImage=function(){var e=O("meta[property='og:image']").attr("content");return e||(e=this.pageImageDefault),e},e.prototype.setPageOpenGraphImage=function(e){void 0===O("meta[property='og:type']").get(0)&&O("head").append("<meta property='og:type' content='website'>");var t=O("meta[property='og:image']");void 0===t.get(0)&&(t=O("head").append("<meta property='og:image' content=''>")),e?t.attr("content",O.trim(e)):t.attr("content",this.pageImageDefault)},e.prototype.getCanonicalUrl=function(){var e=O("link[rel='canonical']").attr("href");return e||(e=window.location.href),e},e.prototype.setCanonicalUrl=function(e){var t=O("link[rel='canonical']");void 0===t.get(0)&&(t=O("head").append("<link rel='canonical'>")),e?t.attr("href",O.trim(e)):t.attr("href",window.location.href)},e.prototype.setMetaData=function(e,t,o,i,a){var r;this.setPageTitle(e),this.setPageDescription(t),this.setCanonicalUrl(a),Array.isArray(o)?r=o.map(function(e){return e.name}).join(","):"string"==typeof o&&(r=o),this.setPageKeywords(r),this.setPageOpenGraphDescription(t),this.setPageOpenGraphTitle(e),this.setPageOpenGraphImage(i)},e.prototype.getDocumentName=function(){return document.location.pathname.split("/").pop()},e.prototype.scrollToMainNavigation=function(){PARTcloudConfig.isFeatureEnabled("scrollToMainNavigation")&&O("html, body").scrollTop(O("#PARTcloudApp").offset().top)},e.prototype.handleRemoteLogin=function(){var e=O.Deferred();if(PARTcloudConfig.isFeatureEnabled("remotelogin")){var t=PARTcloudHelpers.getParameter("remotelogintoken",void 0),o=PARTcloudHelpers.getCookie("pcl_remotelogintoken");if(!t||t===o&&this.isUserLoggedIn())e.resolve();else{PARTcloudHelpers.setCookie("pcl_remotelogintoken",t,0);var i=O.Deferred();this.isUserLoggedIn()?i=PARTcloudApi.logout():i.resolve(),O.when(i).then(function(){PARTcloudApi.loginWithToken(t).always(function(){e.resolve()})})}}else e.resolve();return e},e.prototype.route=function(M){var N=this;O.each(N.requests,function(e,t){"object"==typeof t&&"function"==typeof t.abort&&(t.abort(),delete N.requests[e])}),N.scrollToMainNavigation();var e=O.Deferred(),t=N.handleRemoteLogin().always(function(){N.getLoginStatus().always(function(){e.resolve()})});O.when(t,e).always(function(){var e,t=window.location.href,o=2<=M.length&&"#"===M.charAt(0)&&"!"===M.charAt(1),i=1<=M.length&&"?"===M.charAt(0);e=o||i?(M=N.navigationBasePath+N.getDocumentName()+M,window.location.protocol+"//"+window.location.host+M):M,PARTcloudAnalytics.logRequest(t,e),N.pushState(M);var a=PARTcloudHelpers.getRoute(M),r=a&&a[1]||!1,n=parseInt(PARTcloudHelpers.getParameter("page","1"),10),l=PARTcloudHelpers.getParameter("order",void 0),d=PARTcloudHelpers.getParameter("printable",void 0),s=PARTcloudHelpers.getParameter("category",void 0),c=PARTcloudHelpers.getParameter("search",void 0),u=PARTcloudHelpers.getParameter("pending",void 0);switch(0<O("#MainView-Logout").length&&N.showLogoutView(O("#MainView-Logout")),r){case"my-liked-parts":var p={page:n,order:l,category:s,printable:d,search:c},m=PARTcloudHelpers.getParameter("tag_id",!1);if(!1!==m){var g=PARTcloudHelpers.getParameter("tag_name",!1);O.extend(p,{tag_id:m,tag_name:g})}N.showMyLikedPartsPage(p);break;case"my-parts":var h={page:n,order:l,category:s,printable:d,search:c,pending:u},f=PARTcloudHelpers.getParameter("tag_id",!1);if(!1!==f){var w=PARTcloudHelpers.getParameter("tag_name",!1);O.extend(h,{tag_id:f,tag_name:w})}N.showMyPartsPage(h);break;case"upload-parts":N.showUploadPartsPage();break;case"search":var v=PARTcloudHelpers.getParameter("tag_id",!1),P=null;if(!1!==v)P={tag_id:v,tag_name:PARTcloudHelpers.getParameter("tag_name",!1)};var T=PARTcloudHelpers.getParameter("query","");N.showSearchPage(T,n,P);break;case"help":N.showHelpPage();break;case"top-users":N.showTopUsersPage(n);break;case"collection":var _=PARTcloudHelpers.getParameter("collection_id",!1);N.showCollectionPage(_,n);break;case"signup":N.showSignupPage();break;case"embedded":var V=PARTcloudHelpers.getParameter("model_id",!1),C=PARTcloudHelpers.getParameter("share_key",!1);N.showEmbeddedPage(V,C);break;case"embedded-viewer":var b=PARTcloudHelpers.getParameter("model_id",!1),A=PARTcloudHelpers.getParameter("share_key",!1);N.showEmbeddedViewerPage(b,A);break;case"part":var y=PARTcloudHelpers.getParameter("model_id",!1),S=PARTcloudHelpers.getParameter("share_key",!1);window.PARTcloudCad?N.showPartPageStandalone(y,S):N.showPartPage(y,S);break;case"embed":var R=PARTcloudHelpers.getParameter("model_id",!1),k=PARTcloudHelpers.getParameter("table_configuration",!1),x=PARTcloudHelpers.getParameter("share_key",!1);N.showCreateEmbeddedPage(R,k,x);break;case"edit-part":var E=PARTcloudHelpers.getParameter("model_id",!1);N.showEditPage(E);break;default:var U=PARTcloudHelpers.getParameter("model_id",!1),I=PARTcloudHelpers.getParameter("tag_id",!1),F=PARTcloudHelpers.getParameter("user_id",!1),D=PARTcloudHelpers.getParameter("share_key",!1);if(-1===O.inArray(l,PARTcloudApi.availableOrderTypes)&&(l=void 0),!1!==U)window.PARTcloudCad?N.showPartPageStandalone(U,D):N.showPartPage(U,D);else{var L=N.modelsPerPage,$=(n-1)*L,H={page:n,order:l,category:s,printable:d,search:c,has_admin_tag:!0};if(!1!==I){var B=PARTcloudHelpers.getParameter("tag_name",!1);O.extend(H,{tag_id:I,tag_name:B}),N.showIndexPage(PARTcloudApi.getModelsByTagId(I,L,$,l,d,s,c,!0),H)}else!1!==F?(O.extend(H,{user_id:F}),N.showIndexPage(PARTcloudApi.getModelsByUserId(F,L,$,l,d,s,c,!0),H)):N.showIndexPage(PARTcloudApi.getModelsAll(L,$,l,d,s,c,!0),H)}}})},e.prototype.showIndexPage=function(e,t){var i=this,a=O("#index"),r=O("#MainView-Index");i.activateTab(a),i.setMetaData(),t=t||{},e.done(function(e){i.showSortView(O("#MainView-Index-Sort"),"index",t,e.tag),i.showTileView(r,{models:e.models,count:e.count,tags:e.tag,params:t,route:"index"}).done(function(){i.showTab(a)})}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})},e.prototype.showMyLikedPartsPage=function(t){var i=this,o="my-liked-parts",a=O("#my-liked-parts"),r=O("#MainView-MyLikedParts"),e=PARTcloudHelpers.translate("pcl_app_my_liked_parts");i.activateTab(a),i.setMetaData(e),i.isUserLoggedIn()?(t=t||{},PARTcloudApi.getModelsLikedByUserId(i.loginStatus.user_id,i.modelsPerPage,(t.page-1)*i.modelsPerPage,t.order,t.printable,t.category,t.search,t.has_admin_tag,t.tag_id).done(function(e){i.showSortView(O("#MainView-MyLikedParts-Sort"),o,t,e.tag),i.showTileView(r,{models:e.models,count:e.count,params:t,tags:e.tag,route:o}).done(function(){i.showTab(a)})}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})):i.showLoginView(r).done(function(){i.showTab(a)})},e.prototype.showMyPartsPage=function(t){var i=this,o="my-parts",a=O("#my-parts"),r=O("#MainView-MyParts"),e=PARTcloudHelpers.translate("pcl_app_my_parts");i.activateTab(a),i.setMetaData(e),i.isUserLoggedIn()?(t=t||{},PARTcloudApi.getModelsByUserId(i.loginStatus.user_id,i.modelsPerPage,(t.page-1)*i.modelsPerPage,t.order,t.printable,t.category,t.search,t.pending,t.has_admin_tag,t.tag_id).done(function(e){i.showSortView(O("#MainView-MyParts-Sort"),o,t,e.tag),i.showTileView(r,{models:e.models,count:e.count,params:t,tags:e.tag,route:o}).done(function(){i.showTab(a)})}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})):i.showLoginView(r).done(function(){i.showTab(a)})},e.prototype.showUploadPartsPage=function(){var e=this,t=O("#upload-parts"),o=O("#MainView-UploadParts"),i=PARTcloudHelpers.translate("pcl_app_upload_parts");e.activateTab(t),e.setMetaData(i),e.isUserLoggedIn()?e.showUploadPartsView("#MainView-UploadParts").done(function(){e.showTab(t)}):e.showLoginView(o).done(function(){e.showTab(t)})},e.prototype.showStandaloneUploadPartsPage=function(){var t=this;if(t.isUserLoggedIn()){O.when(O.Deferred(function(){var t=this;PARTcloudApi.getLicenses().done(function(e){t.resolve(e)}).fail(function(){t.reject()})})).done(function(e){t.showUploadPartsView("#PARTcloudApp",{licenses:e})})}else t.showLoginView(O("#PARTcloudApp"))},e.prototype.showSearchPage=function(e,t,o){var i=this,a=O("#search"),r=O("#StlViewerView-Viewer-Container");r.length&&i.isStlViewerInitialized&&(i.stlViewer.hide(),r.children().detach().appendTo("#MainView-StlWebGlContainer"));var n=PARTcloudHelpers.translate("pcl_app_search");i.activateTab(a),i.setMetaData(n);var l={params:{page:t,query:e}};null!=o&&O.extend(l.params,{tag_id:o.tag_id,tag_name:o.tag_name}),i.showSearchView("#MainView-Search",l).done(function(){i.showTab(a)})},e.prototype.showHelpPage=function(){var e=this,t=O("#help"),o=PARTcloudHelpers.translate("pcl_app_help");e.activateTab(t),e.setMetaData(o),e.showHelpView("#MainView-Help").done(function(){e.showTab(t)})},e.prototype.showTopUsersPage=function(o){var i=this,e=i.topUsersPerPage,t=(o-1)*e,a=O("#top-users"),r=O("#MainView-TopUsers");i.activateTab(a),PARTcloudApi.getTopUsers(e,t,3).done(function(e){if("string"==typeof e.status&&"error"===e.status)i.showErrorView(r,"").done(function(){i.showTab(a)});else{var t=PARTcloudHelpers.translate("pcl_app_top_users");i.setMetaData(t),i.showTopUsersView(r,{users:e.users,count:e.count,page:o,route:"top-users"}).done(function(){i.showTab(a)})}}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})},e.prototype.showPartPageStandalone=function(e,t){var i=this,o=O("#ViewerView-Viewer-Container");o.length&&i.isViewerInitialized&&(i.viewer.hide(),o.children().detach().appendTo("#MainView-WebGlContainer"));var a=O("#PARTcloudApp");PARTcloudApi.getModel(e,t).done(function(e){if("string"==typeof e.status&&"error"===e.status)i.showErrorView(a,PARTcloudHelpers.translate("pcl_app_model_could_not_be_found"),!1);else if("string"==typeof e.status&&"unauthorized"===e.status)i.showErrorView(a,PARTcloudHelpers.translate("pcl_app_model_is_private"),!1);else{var t="";void 0!==e.preview&&void 0!==e.preview.image_path&&(t=PARTcloudHelpers.prependPartcloudBaseUrl(e.preview.image_path)),i.setMetaData(e.name,e.description,e.tags,t),i.showPartView(a,{model:e})}}).fail(function(e,t,o){i.showErrorView(a,o)})},e.prototype.showPartPage=function(e,t){var i=this,a=O("#part"),o=O("#ViewerView-Viewer-Container");o.length&&i.isViewerInitialized&&(i.viewer.hide(),o.children().detach().appendTo("#MainView-WebGlContainer"));var r=O("#MainView-Part").bEmpty();i.activateTab(a),PARTcloudApi.getModel(e,t).done(function(e){if("string"==typeof e.status&&"error"===e.status)i.showErrorView(r,PARTcloudHelpers.translate("pcl_app_model_could_not_be_found"),!1).done(function(){i.showTab(a)});else if("string"==typeof e.status&&"unauthorized"===e.status)i.showErrorView(r,PARTcloudHelpers.translate("pcl_app_model_is_private"),!1).done(function(){i.showTab(a)});else{var t="";void 0!==e.preview&&void 0!==e.preview.image_path&&(t=PARTcloudHelpers.prependPartcloudBaseUrl(e.preview.image_path)),i.setMetaData(e.name,e.description,e.tags,t),i.showPartView(r,{model:e}).done(function(){i.showTab(a)})}}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})},e.prototype.showCollectionPage=function(e,o){var i=this,a=O("#collection"),r=O("#MainView-Collection");i.activateTab(a),PARTcloudApi.getCollection(e).done(function(e){var t="";void 0!==e.preview&&void 0!==e.preview.image_path&&(t=PARTcloudHelpers.prependPartcloudBaseUrl(e.preview.image_path)),i.setMetaData(e.name,e.description,e.tags,t),i.showCollectionView(r,{collection:e,page:o}).done(function(){i.showTab(a)})}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})},e.prototype.showSignupPage=function(){var e=this,t=O("#signup"),o=PARTcloudHelpers.translate("pcl_app_signup");e.activateTab(t),e.setMetaData(o),e.showLoginView("#MainView-Signup",{registerFirst:!0}).done(function(){e.showTab(t)})},e.prototype.showEmbeddedPage=function(e,t){var i=this,a=O("#PARTcloudApp");i.setMetaData(),PARTcloudApi.getModel(e,t).done(function(e){"string"==typeof e.status&&"error"===e.status?i.showErrorView(a,PARTcloudHelpers.translate("pcl_app_model_could_not_be_found"),!1):"string"==typeof e.status&&"unauthorized"===e.status?i.showErrorView(a,PARTcloudHelpers.translate("pcl_app_model_is_private"),!1):i.showEmbeddedView(a,{model:e})}).fail(function(e,t,o){i.showErrorView(a,o)})},e.prototype.showCreateEmbeddedPage=function(e,t,o){var i=this,a=O("#part"),r=O("#ViewerView-Viewer-Container");r.length&&i.isViewerInitialized&&(i.viewer.hide(),r.children().detach().appendTo("#MainView-WebGlContainer"));var n=O("#MainView-Part").bEmpty();i.activateTab(a),PARTcloudApi.getModel(e,o).done(function(e){"string"==typeof e.status&&"error"===e.status?i.showErrorView(n,PARTcloudHelpers.translate("pcl_app_model_could_not_be_found"),!1).done(function(){i.showTab(a)}):"string"==typeof e.status&&"unauthorized"===e.status?i.showErrorView(n,PARTcloudHelpers.translate("pcl_app_model_is_private"),!1).done(function(){i.showTab(a)}):i.showCreateEmbeddedView(n,{model:e,tableConfiguration:t}).done(function(){i.showTab(a)})}).fail(function(e,t,o){i.showErrorView(n,o).done(function(){i.showTab(a)})})},e.prototype.showEditPage=function(e){var i=this,a=O("#part"),t=O("#ViewerView-Viewer-Container");t.length&&i.isViewerInitialized&&(i.viewer.hide(),t.children().detach().appendTo("#MainView-WebGlContainer"));var r=O("#MainView-Part").bEmpty();i.activateTab(a),PARTcloudApi.getModel(e).done(function(e){"string"==typeof e.status&&"error"===e.status?i.showErrorView(r,PARTcloudHelpers.translate("pcl_app_model_could_not_be_found"),!1).done(function(){i.showTab(a)}):"string"==typeof e.status&&"unauthorized"===e.status?i.showErrorView(r,PARTcloudHelpers.translate("pcl_app_model_is_private"),!1).done(function(){i.showTab(a)}):i.showEditView(r,{model:e}).done(function(){i.showTab(a)})}).fail(function(e,t,o){i.showErrorView(r,o).done(function(){i.showTab(a)})})},e.prototype.showEmbeddedViewerPage=function(e,t){var i=this,a=O("#PARTcloudApp");i.setMetaData(),PARTcloudApi.getModel(e,t).done(function(e){"string"==typeof e.status&&"error"===e.status?i.showErrorView(a,PARTcloudHelpers.translate("pcl_app_model_could_not_be_found"),!1):"string"==typeof e.status&&"unauthorized"===e.status?i.showErrorView(a,PARTcloudHelpers.translate("pcl_app_model_is_private"),!1):i.showEmbeddedViewerView(a,{model:e})}).fail(function(e,t,o){i.showErrorView(a,o)})},e.prototype.showAdditionalFilesView=function(t,o,e){PARTcloudApi.getFiles(e).done(function(e){o.files=e,brite.display("AdditionalFilesView",t,o)})},e.prototype.showDownloadView=function(e,t){brite.display("DownloadView",e,t)},e.prototype.showCollectionView=function(e,t){return t=t||{},brite.display("CollectionView",e,t)},e.prototype.showCommentView=function(t,o,e,i,a){PARTcloudApi.getComments(o,e,(i-1)*e).done(function(e){brite.display("CommentView",t,{comments:e.comments,count:e.count,model_id:o,page:i,parent:a})})},e.prototype.showCreateCollectionView=function(e,t){return t=t||{},brite.display("CreateCollectionView",e,t)},e.prototype.showCreateEmbeddedView=function(e,t){return t=t||{},brite.display("CreateEmbeddedView",e,t)},e.prototype.showEmbeddedView=function(e,t){return t=t||{},brite.display("EmbeddedView",e,t)},e.prototype.showEditView=function(e,t){return t=t||{},brite.display("EditView",e,t)},e.prototype.showEmbeddedViewerView=function(e,t){return t=t||{},brite.display("EmbeddedViewerView",e,t)},e.prototype.showErrorView=function(e,t,o){return void 0===o&&(o=!0),brite.display("ErrorView",e,{message:t,showError:o})},e.prototype.showHelpView=function(e,t){return t=t||{},brite.display("HelpView",e,t)},e.prototype.showHotspotsView=function(e,t){return t=t||{},brite.display("HotspotsView",e,t)},e.prototype.showImageView=function(e,t){return t=t||{},brite.display("ImageView",e,t)},e.prototype.showLicenseView=function(e,t){return t=t||{},brite.display("LicenseView",e,t)},e.prototype.showLoginView=function(e,t){return t=t||{},brite.display("LoginView",e,t)},e.prototype.showLogoutView=function(e,t){return t=t||{},brite.display("LogoutView",e,t)},e.prototype.showManufacturingView=function(t,o){o=o||{},PARTcloudApi.getTopology(o.model).done(function(e){o.topology=e,brite.display("ManufacturingView",t,o)}).fail(function(e,t,o){})},e.prototype.showOrderView=function(e,t){return t=t||{},brite.display("OrderView",e,t)},e.prototype.showParametricTableView=function(e,t){return brite.display("ParametricTableView",e,t)},e.prototype.showPartView=function(e,t){return t=t||{},brite.display("PartView",e,t)},e.prototype.showPreviewView=function(e,t){return t=t||{},brite.display("PreviewView",e,t)},e.prototype.showPrivateShareView=function(e,t){return t=t||{},brite.display("PrivateShareView",e,t)},e.prototype.showSearchView=function(e,t){return t=t||{},brite.display("SearchView",e,t)},e.prototype.showSocialShareView=function(e,t){return t=t||{},brite.display("SocialShareView",e,t)},e.prototype.showSortView=function(e,t,o,i){return o=o||{},brite.display("SortView",e,{route:t,params:o,tags:i})},e.prototype.showStlViewerView=function(e,t){return t=t||{},brite.display("StlViewerView",e,t)},e.prototype.showSupplierTileView=function(e,t){return t=t||{},brite.display("SupplierTileView",e,t)},e.prototype.showTileView=function(e,t){return t=t||{},brite.display("TileView",e,t)},e.prototype.showTopUsersView=function(e,t){return t=t||{},brite.display("TopUsersView",e,t)},e.prototype.showUploadPartsView=function(e,t){return t=t||{},brite.display("UploadDropzoneView",e,t)},e.prototype.showUploadFormularView=function(e,t){return t=t||{},brite.display("UploadFormularView",e,t)},e.prototype.showViewerView=function(e,t){return t=t||{},brite.display("ViewerView",e,t)},e.prototype.activateTab=function(e){e.parent().addClass("current"),e.parent().siblings().removeClass("current")},e.prototype.showTab=function(e){var t=e.attr("href"),o=PARTcloudHelpers.getRoute(t),i=O("#MainView-Tab-"+o[1]);O(".MainView-Tab").not(i).hide(),O(i).show()},e.prototype.likeModel=function(e){var r=this;return PARTcloudApi.likeModel(e).fail(function(e,t,o){var i=O("#index"),a=O("#MainView-Index");r.activateTab(i),r.showErrorView(a,o).done(function(){r.showTab(i)})})},e.prototype.getLoginStatus=function(){var i=this;return PARTcloudApi.getLoginStatus().done(function(e){i.loginStatus=e}).fail(function(e,t,o){i.loginStatus={}})},e.prototype.getCurrentUserId=function(){var t=O.Deferred();return PARTcloudApi.getLoginStatus().done(function(e){!0===e.loggedin?t.resolve(e.user_id):t.resolve(!1)}),t},e.prototype.isUserLoggedIn=function(){return void 0!==this.loginStatus.loggedin&&!0===this.loginStatus.loggedin},e.prototype.setUserInfoForDownloadLogging=function(e){var t="partcloud",o=PARTcloudConfig.getApiPortal();"b2b"!==o&&(t+="_"+o);var i=O.extend({server_type:PARTcloudConfig.getServerTypeForDownloadLogging(),firm:t},e);void 0!==this.loginStatus.userdata&&O.each(this.loginStatus.userdata,function(e,t){i[e]=t}),psol.core.setUserInfo(i)},e.prototype.pushState=function(e){this.isHistoryApiSupported()&&(void 0===history.state||null===history.state||void 0!==history.state.url&&history.state.url===e||history.pushState({url:e},this.getPageTitle(),e))},e.prototype.replaceState=function(e){this.isHistoryApiSupported()&&(void 0===history.state||null===history.state||void 0!==history.state.url&&history.state.url===e||history.replaceState({url:e},this.getPageTitle(),e))},e.prototype.renderTemplate=function(e,t){Handlebars.templates=Handlebars.templates||{};var o=Handlebars.templates[e];if(!o){var i=O("#"+e).html();o=Handlebars.compile(i),Handlebars.templates[e]=o}return o(t)},window.PARTcloud=window.PARTcloud||new e}(jQuery),function(o){"use strict";function e(e,t){return this.reCaptchaId=void 0,this.reCaptcha={},this.siteKey=e,this.containerElement=o(t).get(0),this._readyPromise=new o.Deferred,this._globalName="__PARTcloudRecaptcha"+(new Date).getTime(),this}e.prototype.render=function(){var e=this;return window[e._globalName]=o.proxy(e._onReCaptchaLoadCallback,e),void 0===window.__PARTcloudRecaptchaScriptWasLoaded?o.getScript("https://www.google.com/recaptcha/api.js?onload="+e._globalName+"&render=explicit").fail(function(){e._readyPromise.reject()}).done(function(){window.__PARTcloudRecaptchaScriptWasLoaded=!0}):window[e._globalName](),e._readyPromise},e.prototype._onReCaptchaLoadCallback=function(){this.reCaptcha=grecaptcha,this.reCaptchaId=this.reCaptcha.render(this.containerElement,{sitekey:this.siteKey,theme:"light"}),this._readyPromise.resolve()},e.prototype.reset=function(){return"resolved"===this._readyPromise.state()&&(this.reCaptcha.reset(this.reCaptchaId),!0)},e.prototype.getResponse=function(){return"resolved"===this._readyPromise.state()?this.reCaptcha.getResponse(this.reCaptchaId):""},e.prototype.destroy=function(){delete window[this._globalName]},window.PARTcloudRecaptcha=e}(jQuery),function(m){"use strict";function e(e,t,o){var i=this;i.container=m(e),i.useGlobalCache=o||!0,i.categoriesCache=null;var a=m.Deferred();return i.readyPromise=a.promise(),i._initSelects(t).done(function(){a.resolve()}),i}e.prototype._initSelects=function(n){var l=this,d=!1,s=!1,c=m.Deferred();l.container.empty();var u=m("<select>",{name:"base"}).change(function(){l._rebuildChildrenSelectByBaseCategoryId(parseInt(m(this).val(),10)),l._changeCallback(l.getSelectedCategoryId())});u.append(m("<option>",{text:"---",value:"false"}));var p=m("<select>",{name:"children"}).change(function(){l._changeCallback(l.getSelectedCategoryId())});return p.append(m("<option>",{text:"---",value:"false"})),l._getCategoriesAll().done(function(e){var t,o;for(t=0;t<e.length;t++){var i=!1,a=m("<option>",{text:e[t].name,value:e[t].category_id});if(!d)for(o=0;o<e[t].children.length;o++)if(e[t].children[o].category_id===n){i=d=!0;break}if((n===e[t].category_id||i)&&(a.attr("selected","selected"),i=!0),u.append(a),i)for(o=0;o<e[t].children.length;o++){var r=m("<option>",{text:e[t].children[o].name,value:e[t].children[o].category_id});n===e[t].children[o].category_id&&r.attr("selected","selected"),p.append(r),s=!0}}l.container.append(u),s&&l.container.append(p),c.resolve()}),c.promise()},e.prototype._rebuildChildrenSelectByBaseCategoryId=function(e){var t=this;t.container.find("select[name=children]").remove();for(var o=0;o<t.categoriesCache.length;o++)if(t.categoriesCache[o].category_id===e){if(0<t.categoriesCache[o].children.length){var i=m("<select>",{name:"children"});i.append(m("<option>",{text:"---",value:"false"}));for(var a=0;a<t.categoriesCache[o].children.length;a++)i.append(m("<option>",{text:t.categoriesCache[o].children[a].name,value:t.categoriesCache[o].children[a].category_id}));i.insertAfter(t.container.find("select[name=base]").first())}break}},e.prototype._getCategoriesAll=function(){var t=this,o=m.Deferred();return t.categoriesCache?o.resolve(t.categoriesCache):!0===t.useGlobalCache&&void 0!==window.__PARTcloudCategoryGlobalCache?(t.categoriesCache=window.__PARTcloudCategoryGlobalCache,o.resolve(t.categoriesCache)):PARTcloudApi.getCategoriesAll().done(function(e){!0===t.useGlobalCache?(window.__PARTcloudCategoryGlobalCache=e,t.categoriesCache=window.__PARTcloudCategoryGlobalCache):t.categoriesCache=e,o.resolve(t.categoriesCache)}),o.promise()},e.prototype._changeCallback=function(){},e.prototype.getSelectedCategoryId=function(){var e=!1,t=this.container.find("select[name=children]").val(),o=this.container.find("select[name=base]").val();return t&&"false"!==t?e=parseInt(t,10):o&&"false"!==o&&(e=parseInt(o,10)),e},e.prototype.getSelectedCategoryName=function(){var e="---",t=this.container.find("select[name=children] option:selected").text(),o=this.container.find("select[name=base] option:selected").text();return t&&"---"!==t?e=t:o&&"---"!==o&&(e=o),e},e.prototype.setChangeHandler=function(e,t){return!!m.isFunction(e)&&(this._changeCallback=m.proxy(e,t),!0)},e.prototype.disable=function(){this.container.find("select[name=children]").prop("disabled",!0),this.container.find("select[name=base]").prop("disabled",!0)},e.prototype.enable=function(){this.container.find("select[name=children]").prop("disabled",!1),this.container.find("select[name=base]").prop("disabled",!1)},window.PARTcloudCategory=e}(jQuery),jQuery.noConflict(),function(o){"use strict";brite.viewDefaultConfig.loadTmpl=!1,brite.viewDefaultConfig.loadCss=!1,brite.config.tmplExt=".tpl",brite.config.tmplPath=PARTcloud.partcloudBasePath+"/mvc/tpl/",brite.config.jsPath=PARTcloud.partcloudBasePath+"/mvc/js/",brite.config.cssPath=PARTcloud.partcloudBasePath+"/mvc/css/",Handlebars.registerHelper("translate",function(e){return PARTcloudHelpers.translate(e)}),Handlebars.registerHelper("round",function(e){return PARTcloudHelpers.round(e)}),Handlebars.registerHelper("getQualityDistanceColor",function(e){return PARTcloudHelpers.getQualityDistanceColor(e)}),Handlebars.registerHelper("getQualityDistanceColorInverse",function(e){return PARTcloudHelpers.getQualityDistanceColorInverse(e)}),Handlebars.registerHelper("encodeURIComponent",function(e){return PARTcloudHelpers.encodeURIComponent(e)}),Handlebars.registerHelper("encodeURIComponentName",function(e){return PARTcloudHelpers.encodeURIComponentName(e)}),Handlebars.registerHelper("decodeURIComponent",function(e){return PARTcloudHelpers.decodeURIComponent(e)}),Handlebars.registerHelper("decodeURIComponentName",function(e){return PARTcloudHelpers.decodeURIComponentName(e)}),Handlebars.registerHelper("prependCommunityBaseUrl",function(e){return PARTcloudHelpers.prependCommunityBaseUrl(e)}),Handlebars.registerHelper("prependPartcloudBaseUrl",function(e){return PARTcloudHelpers.prependPartcloudBaseUrl(e)}),Handlebars.registerHelper("prependPartcloudBaseDocument",function(e){return PARTcloudHelpers.prependPartcloudBaseDocument(e)}),Handlebars.registerHelper("prependPcomBaseUrl",function(e){return PARTcloudHelpers.prependPcomBaseUrl(e)}),Handlebars.registerHelper("buildPcomPartPreviewUrl",function(e,t,o){return PARTcloudHelpers.buildPcomPartPreviewUrl(e,t,o)}),Handlebars.registerHelper("buildPcomCatalogPreviewUrl",function(e,t,o){return PARTcloudHelpers.buildPcomCatalogPreviewUrl(e,t,o)}),Handlebars.registerHelper("isPclExporterActive",function(e){var t=e.fn,o=e.inverse;return!0===PARTcloudExporter.isExporterActive?t():o()}),Handlebars.registerHelper("userOnTrophyRank",function(e,t){var o=t.fn,i=t.inverse;return 0<e&&e<4?o(this):i(this)}),Handlebars.registerHelper("printableIcon",function(e,t){var o={};if(PARTcloudConfig.isFeatureEnabled("manufacturingView"))switch(e){case 1:o.title=PARTcloudHelpers.translate("pcl_manufacturing_printable"),o.printable="yes",o.showIcon=!0;break;case 0:o.title=PARTcloudHelpers.translate("pcl_manufacturing_maybe_printable"),o.printable="maybe",o.showIcon=!1;break;default:o.title=PARTcloudHelpers.translate("pcl_manufacturing_not_printable"),o.printable="no",o.showIcon=!0}else o.showIcon=!1;return t.fn(o)}),Handlebars.registerHelper("loginStatus",function(){return PARTcloud.loginStatus}),Handlebars.registerHelper("stringify",function(e){return JSON.stringify(e)}),Handlebars.registerHelper("debug",function(e){console.log(e)}),o.fn.replaceClass=function(e,t){return o(this).each(function(){return o(this).removeClass(e).addClass(t)})},PARTcloud.isHistoryApiSupported()&&o(window).bind("popstate",function(e){null!==e.originalEvent.state&&(e.preventDefault(),PARTcloud.route(e.originalEvent.state.url))});var e=new o.Deferred,t=new o.Deferred,i=PARTcloudConfig.init().done(function(){PARTcloudApi.init(),PARTcloudHelpers.init().done(function(){e.resolve()}),PARTcloudApi.getEnvironments(!0,!0).done(function(e){PARTcloud.environments=e,t.resolve()})});o(document).ready(function(){o.when(i,e,t).then(function(){PARTcloud.init(),PARTcloud.main()})})}(jQuery),function(e){"use strict";brite.registerView("AdditionalFilesView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return e.showAnything=(e.viewerIsUploader||e.files)&&e.model.uploaded,this.dataForViews=e,PARTcloud.renderTemplate("tpl-AdditionalFilesView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){},events:{"click; .AdditionalFilesView-Download-Button":function(e){e.preventDefault();var t=this.$el.find(".AdditionalFilesView-Download-Selection").first().find("option:selected").val();PARTcloudDownloader._downloadFile(t,this.dataForViews.model)},"click; #AdditionalFilesView-Expand-Option":function(){this.$el.find("#AdditionalFilesView-Options-Container").slideToggle(200)}}})}(jQuery),function(s){"use strict";brite.registerView("CollectionView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;o.collection=e.collection,o.page=e.page;var i=PARTcloud.loginStatus,a=i&&!0===i.loggedin&&(!0===i.isadmin||i.user_id===o.collection.user_id),r=0<o.collection.description.length||a;return e={collection:o.collection,canEditCollection:a,hasDescription:r},PARTcloud.renderTemplate("tpl-CollectionView",e)},init:function(e,t){tinymce.editors.forEach(function(e){e.remove()})},postDisplay:function(e,t){var i=this,o=PARTcloud.modelsPerPage,a=PARTcloud.modelsPerPage*(i.page-1);PARTcloud.showOrderView(i.$el.find("#CollectionView-Collection-Orders"),{type:"collection",sourceId:i.collection.collection_id,manufacturer:[{manufacturer:"3dhubs",name:"3D Hubs",claimText:PARTcloudHelpers.translate("pcl_order_claim_text_3dhubs")}]}),PARTcloudApi.getCollectionModels(i.collection.collection_id,o,a,!0).done(function(o){s.each(o.models,function(e,t){o.models[e].collection_id=null}),PARTcloud.showTileView(i.$el.find("#CollectionView-Collection-Models"),{models:o.models,count:o.count,route:"collection",params:{name:i.collection.name,collection_id:i.collection.collection_id,page:i.page}})})},destroy:function(){tinymce.editors.forEach(function(e){e.remove()})},events:{"click; #CollectionView-Header-Name-Edit":function(e){var o=this,i=s(e.currentTarget).hide(),t=o.$el.find(".CollectionView-Header-Name"),a=o.$el.find("#CollectionView-Header-Name-Text"),r=a.text();a.hide();var n=s("<input id='CollectionView-Header-Name-New'>").val(r);t.append(n);var l=s("<button id='CollectionView-Header-Name-Edit-Save'>").text("✔");t.append(l);var d=s("<button id='CollectionView-Header-Name-Edit-Cancel'>").text("✘");t.append(d),l.on("click",function(e){var t=n.val();PARTcloudApi.editCollectionName(o.collection.collection_id,t).done(function(e){var t;t=void 0!==e.status&&"error"===e.status?r:e.name,a.text(t),n.bRemove(),l.bRemove(),d.bRemove(),a.show(),i.show()})}),d.on("click",function(e){n.bRemove(),l.bRemove(),d.bRemove(),a.show(),i.show()})},"click; #CollectionView-Description-Edit":function(e){var t=this;tinymce.init({selector:"#CollectionView-Description-Text",theme:"modern",statusbar:!1,menubar:!1,relative_urls:!1,remove_script_host:!0,toolbar:"undo redo | bold italic underline | bullist numlist | alignleft aligncenter alignright alignjustify | outdent indent | save cancel",plugins:["autolink","save"],save_enablewhendirty:!1,init_instance_callback:function(e){e.initialContent=e.getContent()},save_onsavecallback:t.saveDescription,save_oncancelcallback:function(e){e.setContent(e.initialContent),e.remove(),t.$el.find("#CollectionView-Description-Edit").show()}}),t.$el.find("#PartView-Description-Edit").hide()}},saveDescription:function(e){var t=s("#"+e.id).data("collection_id"),o=e.save();PARTcloudApi.editCollectionDescription(t,o).done(function(e){PARTcloud.route(document.location.pathname+document.location.search+document.location.hash)})}})}(jQuery),function(n){"use strict";brite.registerView("CommentView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(o,e){this.parent=o.parent,this.page=o.page,this.commentCount=o.count,this.model_id=o.model_id;var t=PARTcloud.loginStatus,i=t&&!0===t.loggedin&&!0===t.isadmin,a=!1;t&&!0===t.loggedin&&(a=t.user_id),n.each(o.comments,function(e,t){o.comments[e].canUserEditOrDeleteComment=!0===i||!1!==a&&a===t.user_id});var r=PARTcloudConfig.isFeatureEnabled("b2bIntegration");return o={comments:o.comments,firstPage:1===o.page,showPaginator:10<o.count,isB2BIntegrated:r},PARTcloud.renderTemplate("tpl-CommentView",o)},init:function(e,t){this.model_id=e.model_id,tinymce.editors.forEach(function(e){e.remove()}),this.tinymceOptions={selector:"#Overwrite-Me-Before-Init",theme:"modern",statusbar:!1,menubar:!1,relative_urls:!1,remove_script_host:!0,toolbar:"undo redo | bold italic underline | bullist numlist | emoticons pclimages | alignleft aligncenter alignright alignjustify | outdent indent | save cancel",plugins:["autolink","autoresize","emoticons","save"],autoresize_min_height:100,autoresize_bottom_margin:0,save_enablewhendirty:!1,init_instance_callback:function(e){e.initialContent=e.getContent()},save_oncancelcallback:function(e){e.setContent(e.initialContent),e.remove()}}},postDisplay:function(e,t){var o=this;if(1===e.page)if(PARTcloud.loginStatus&&!0===PARTcloud.loginStatus.loggedin){var i=n.extend({},o.tinymceOptions,{selector:"#CommentView-Comment-Add-Textarea",save_onsavecallback:o.addComment.bind(this),save_oncancelcallback:function(e){e.setContent("");var t=n("#CommentView-Comment-Part");n("#CommentView-Comment-Add-Container").hide(),t.show()},setup:function(e){e.addButton("pclimages",{tooltip:PARTcloudHelpers.translate("pcl_comment_upload_image"),icon:"image",onclick:function(){o.$el.find("#CommentView-Comment-Add-Image").click()}}),e.addMenuItem("pclimages",{text:PARTcloudHelpers.translate("pcl_comment_upload_image"),icon:"image",context:"insert",onclick:o.$el.find("#CommentView-Comment-Add-Image").onclick}),e.pcltype="comment"}});tinymce.init(i)}else PARTcloud.showLoginView(o.$el.find(".CommentView-Comment-Add"));o.$el.find(".CommentView-Paginator").pagination({items:e.count,itemsOnPage:PARTcloud.commentsPerPage,prevText:"« "+PARTcloudHelpers.translate("pcl_tile_pagination_previous"),nextText:PARTcloudHelpers.translate("pcl_tile_pagination_next")+" »",cssStyle:"pcl-theme",currentPage:e.page,onPageClick:function(e,t){t.preventDefault(),o.parent.showCommentView(e)}})},destroy:function(){this.$el.find(".CommentView-Paginator").pagination("destroy"),tinymce.editors.forEach(function(e){e.remove()})},events:{"change; #CommentView-Comment-Add-Image":function(e){var t=e.target.files[0];if(FileReader){var o=new FileReader;o.onload=function(){tinymce.activeEditor.execCommand("mceInsertContent",!1,'<img src="'+o.result+'">')},o.readAsDataURL(t)}},"click; .CommentView-Comment-Edit-Button":function(e){var t=this,o=n(e.currentTarget).data("comment_id"),i="#CommentView-Comment-"+o,a=n.extend({},t.tinymceOptions,{selector:i,save_onsavecallback:t.editComment.bind(this),save_oncancelcallback:function(e){n("#CommentView-Comment-Delete-Button-"+o).hide(),e.setContent(e.initialContent),e.remove()},setup:function(e){e.addButton("pclimages",{tooltip:PARTcloudHelpers.translate("pcl_comment_upload_image"),icon:"image",onclick:function(){t.$el.find("#CommentView-Comment-Add-Image").click()}}),e.addMenuItem("pclimages",{text:PARTcloudHelpers.translate("pcl_comment_upload_image"),icon:"image",context:"insert",onclick:t.$el.find("#CommentView-Comment-Add-Image").onclick}),e.pcltype="comment"}});tinymce.init(a),n("#CommentView-Comment-Delete-Button-"+o).show()},"click; .CommentView-Comment-Delete-Button":function(e){var t=n(e.currentTarget).data("comment_id");this.deleteComment(t)},"click; #CommentView-Comment-Part":function(e){var t=n(e.currentTarget);this.$el.find("#CommentView-Comment-Add-Container").show(),t.hide()}},addComment:function(e){var t=this,o=e.save();PARTcloudApi.commentModelAdd(t.model_id,o).done(function(e){t.parent.showCommentView(t.page,t.commentCount+1)})},editComment:function(e){var t=this,o=e.save(),i=t.$el.find("#"+e.id).data("comment_id");PARTcloudApi.commentModelEdit(i,o).done(function(e){t.parent.showCommentView(t.page,t.commentCount)})},deleteComment:function(e){var t=this;PARTcloudApi.commentModelDelete(e).done(function(e){t.parent.showCommentView(t.page,t.commentCount-1)})}})}(jQuery),function(t){"use strict";brite.registerView("CreateCollectionView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.parent=e.parent||!1,PARTcloud.renderTemplate("tpl-CreateCollectionView",e)},init:function(e,t){this.validStatus=!1,this.model=e.model,tinymce.editors.forEach(function(e){"CreateCollectionView-Description-Textarea"===e.id&&e.remove()})},postDisplay:function(e,t){tinymce.init({selector:"#CreateCollectionView-Description-Textarea",theme:"modern","max-width":675,statusbar:!1,menubar:!1,relative_urls:!1,remove_script_host:!0,toolbar:"undo redo | bold italic underline | bullist numlist | alignleft aligncenter alignright alignjustify | outdent indent",plugins:["autolink"]})},destroy:function(){tinymce.editors.forEach(function(e){"CreateCollectionView-Description-Textarea"===e.id&&e.remove()})},events:{"click; #CreateCollectionView-Submit-Button":function(e){var i=this;if(i.validStatus){i.$el.find("#CreateCollectionView-Submit-Button").attr("disabled","disabled"),i.$el.find("#CreateCollectionView-Submit-Button").hide();var t=i.$el.find("#CreateCollectionView-Name")[0].value,o=tinymce.get("CreateCollectionView-Description-Textarea").save();PARTcloudApi.createCollection(t,o,i.model.model_id).done(function(e){i.parent&&"function"==typeof i.parent.hide&&i.parent.hide(),PARTcloud.route(document.location.pathname+document.location.search+document.location.hash)}).fail(function(e,t,o){i.$el.find("#CreateCollectionView-Submit-Button").removeAttr("disabled"),i.$el.find("#CreateCollectionView-Submit-Button").show()})}else{i.validStatus||i.$el.find("#CreateCollectionView-Name").parent().prevAll("span").pulse({color:"#FF0000"},{duration:300,pulses:4})}},"paste cut change keydown keyup blur; #CreateCollectionView-Name":function(e){0!==t(e.currentTarget).val().length?(this.markValid(t(e.currentTarget).parent().prevAll(".CreateCollectionView-Step").first()),this.validStatus=!0):(this.markInvalid(t(e.currentTarget).parent().prevAll(".CreateCollectionView-Step").first()),this.validStatus=!1)}},markValid:function(e){e.css("background-color","#00be00")},markInvalid:function(e){e.css("background-color","#326283")}})}(jQuery),function(S){"use strict";brite.registerView("CreateEmbeddedView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;o.model=e.model,o.showLicenseView=-1===[PARTcloud.licenses.externalDownload,PARTcloud.licenses.private,PARTcloud.licenses.noDownload].indexOf(o.model.license_id),o.tableConfiguration=PARTcloudHelpers.decodeURIComponent(e.tableConfiguration),o.cameraParams=!1;var i=["name="+PARTcloudHelpers.encodeURIComponentName(o.model.name),"model_id="+o.model.model_id];return o.model.share_key&&i.push("share_key="+o.model.share_key),o.model_share_link=PARTcloudHelpers.prependPartcloudBaseUrl("index?route=part&")+i.join("&"),PARTcloud.renderTemplate("tpl-CreateEmbeddedView",o)},init:function(e,t){},postDisplay:function(e,t){this.initColorPickers(),this.createEmbedCode(!0)},destroy:function(){},events:{"change; input[type='checkbox']":function(e){this.createEmbedCode(!0)},"focus; #CreateEmbeddedView-Code-Result-Noiframe, #CreateEmbeddedView-Code-Result, #CreateEmbeddedView-Model-Link":function(e){e.preventDefault();var t=S(e.currentTarget);setTimeout(function(){t.select()},50)},"click; #CreateEmbeddedView-Clipboard-Button":function(e){this.createEmbedCode(!1);var t=this.$el.find("#CreateEmbeddedView-Code-Result");t.select();var o=!1;try{o=document.execCommand("copy")}catch(e){}var i=o?"successful":"failed";t.addClass(i),setTimeout(function(){t.removeClass(i)},1800)},"click; #CreateEmbeddedView-Clipboard-Button-Noiframe":function(e){this.createEmbedCode(!1);var t=this.$el.find("#CreateEmbeddedView-Code-Result-Noiframe");t.select();var o=!1;try{o=document.execCommand("copy")}catch(e){}var i=o?"successful":"failed";t.addClass(i),setTimeout(function(){t.removeClass(i)},1800)},"click; #CreateEmbeddedView-Clipboard-Model-Link":function(e){this.createEmbedCode(!1);var t=this.$el.find("#CreateEmbeddedView-Model-Link");t.select();var o=!1;try{o=document.execCommand("copy")}catch(e){}var i=o?"successful":"failed";t.addClass(i),setTimeout(function(){t.removeClass(i)},1800)},"click; #CreateEmbeddedView-BackButton":function(){var e=["model_id="+this.model.model_id];this.model.share_key&&e.push("share_key="+this.model.share_key),PARTcloud.route("?route=part&"+e.join("&"))},"click; #CreateEmbeddedView-Save-Camera":function(){this.getIframeCameraParams(),this.createEmbedCode(!0)}},initColorPickers:function(){var i=this,e=i.$el.find("#CreateEmbeddedView-Code-Color-Top");e.tinycolorpicker({}),e.data("plugin_tinycolorpicker").setColor(PARTcloud.viewerColorTop);var t=i.$el.find("#CreateEmbeddedView-Code-Color-Bottom");t.tinycolorpicker({}),t.data("plugin_tinycolorpicker").setColor(PARTcloud.viewerColorBottom),e.find(".track").on("resize",function(e){if("none"===S(e.currentTarget).css("display")){i.createEmbedCode(!1);var t=i.$el.find("#CreateEmbeddedView-Code-Color-Top").data("plugin_tinycolorpicker").colorHex,o=i.$el.find("#CreateEmbeddedView-Preview-Container").children("iframe").get(0);void 0!==o.contentWindow.PARTcloud&&void 0!==o.contentWindow.PARTcloud.viewer.setViewerSettings&&o.contentWindow.PARTcloud.viewer.setViewerSettings({ColorTL:t,ColorTR:t})}}),t.find(".track").on("resize",function(e){if("none"===S(e.currentTarget).css("display")){i.createEmbedCode(!1);var t=i.$el.find("#CreateEmbeddedView-Code-Color-Bottom").data("plugin_tinycolorpicker").colorHex,o=i.$el.find("#CreateEmbeddedView-Preview-Container").children("iframe").get(0);void 0!==o.contentWindow.PARTcloud&&void 0!==o.contentWindow.PARTcloud.viewer.setViewerSettings&&o.contentWindow.PARTcloud.viewer.setViewerSettings({ColorBL:t,ColorBR:t})}})},createEmbedCode:function(e){var t=this,o=t.$el.find("#CreateEmbeddedView-Code-Check-Viewer-Only").prop("checked")||!1,i=t.$el.find("#CreateEmbeddedView-Code-Check-Description"),a=t.$el.find("#CreateEmbeddedView-Code-Check-License"),r=t.$el.find("#CreateEmbeddedView-Code-Check-Download"),n=t.$el.find("#CreateEmbeddedView-Code-Check-Hotspots");o?(i.prop("checked",!1),i.prop("disabled",!0),a.prop("checked",!1),a.prop("disabled",!0),r.prop("checked",!1),r.prop("disabled",!0),n.prop("checked",!1),n.prop("disabled",!0)):(i.prop("disabled",!1),a.prop("disabled",!1),r.prop("disabled",!1),n.prop("disabled",!1));var l=i.prop("checked"),d=a.prop("checked")||!1,s=r.prop("checked")||!1;!0===s&&!0===t.model.downloadable&&t.model.license_id!==PARTcloud.licenses.externalDownload?(d=!0,a.prop("checked",!0),a.prop("disabled",!0)):o||a.prop("disabled",!1);var c="";(t.$el.find("#CreateEmbeddedView-Code-Check-Configuration").prop("checked")||!1)&&(c=t.tableConfiguration);var u=n.prop("checked")||!1,p=t.$el.find("#CreateEmbeddedView-Code-Check-Autoload").prop("checked")||!1,m=t.$el.find("#CreateEmbeddedView-Code-Check-Rotate").prop("checked")||!1,g=t.cameraParams,h=t.$el.find("#CreateEmbeddedView-Code-Check-Menu").prop("checked")||!1,f=t.$el.find("#CreateEmbeddedView-Code-Color-Top").data("plugin_tinycolorpicker").colorHex,w=t.$el.find("#CreateEmbeddedView-Code-Color-Bottom").data("plugin_tinycolorpicker").colorHex,v=520;if(d&&(v+=42),s&&(v+=46),l){var P=S("<div>");P.css("visibility","hidden"),P.css("width","490px"),P.css("padding","5px"),P.css("margin","4px"),P.css("border","1px"),P.html(t.model.description),v+=P.outerHeight(!0),P.remove()}u&&(v+=142);var T=t.$el.find("#CreateEmbeddedView-Code-Result"),_=t.$el.find("#CreateEmbeddedView-Code-Result-Noiframe"),V="",C="",b='" frameborder="0" id="EmbeddedView-Iframe-'+t.model.model_id+'" allowfullscreen></iframe>',A=[];A=o?(V='<iframe width="500" height="400" src="'+PARTcloudHelpers.prependPartcloudBaseUrl("embedded.html?route=embedded-viewer&").replace(/^http:/i,"https:"),C=PARTcloudHelpers.prependPartcloudBaseUrl("embedded.html?route=embedded-viewer&").replace(/^http:/i,"https:"),["name="+PARTcloudHelpers.encodeURIComponentName(t.model.name),"model_id="+t.model.model_id,"portal="+PARTcloudConfig.getPortal(),"noAutoload="+p.toString(),"autoRotate="+m.toString(),"hideMenu="+h.toString(),"topColor="+PARTcloudHelpers.encodeURIComponent(f),"bottomColor="+PARTcloudHelpers.encodeURIComponent(w),"cameraParams="+PARTcloudHelpers.encodeURIComponent(g),"varsettransfer="+PARTcloudHelpers.encodeURIComponent(c)]):(V='<iframe width="510" height="'+v+'" src="'+PARTcloudHelpers.prependPartcloudBaseUrl("embedded.html?route=embedded&").replace(/^http:/i,"https:"),C=PARTcloudHelpers.prependPartcloudBaseUrl("embedded.html?route=embedded&").replace(/^http:/i,"https:"),["name="+PARTcloudHelpers.encodeURIComponentName(t.model.name),"model_id="+t.model.model_id,"portal="+PARTcloudConfig.getPortal(),"showDescription="+l.toString(),"showLicense="+d.toString(),"showDownloadButton="+s.toString(),"showHotspots="+u.toString(),"noAutoload="+p.toString(),"autoRotate="+m.toString(),"hideMenu="+h.toString(),"topColor="+PARTcloudHelpers.encodeURIComponent(f),"bottomColor="+PARTcloudHelpers.encodeURIComponent(w),"cameraParams="+PARTcloudHelpers.encodeURIComponent(g),"varsettransfer="+PARTcloudHelpers.encodeURIComponent(c)]),t.model.share_key&&A.push("share_key="+t.model.share_key);var y=V+A.join("&")+b;_.val(C+A.join("&")),T.val(y),e&&t.showEmbeddedPreview(y)},showEmbeddedPreview:function(e){var t=this.$el.find("#CreateEmbeddedView-Preview-Container");t&&(t.empty(),t.append(e))},getIframeCameraParams:function(){var t=this;try{var e=t.$el.find("#CreateEmbeddedView-Preview-Container").children("iframe").first(),o=e[0].contentWindow.PARTcloud.viewer.getCameraParams(),i=e[0].contentWindow.PARTcloud.viewer.getMeshRotation();o.mesh_rotation={x:i.x,y:i.y,z:i.z,order:i.order},o.environment=e[0].contentWindow.PARTcloud.viewer.getEnvironmentOptions(),t.cameraParams=JSON.stringify(o)}catch(e){t.cameraParams=!1}}})}(jQuery),function(o){"use strict";brite.registerView("DownloadView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.dataForViews=e,this.dataForViews.showAnything=(e.viewerIsUploader||e.downloadFormats)&&e.showDownloadButton,this.dataForViews.downloadRequiresLoginEnabled=PARTcloudConfig.isFeatureEnabled("downloadRequiresLogin"),PARTcloud.renderTemplate("tpl-DownloadView",this.dataForViews)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){},events:{"click; #DownloadView-Expand-Option":function(){this.$el.find("#DownloadView-Options-Container").slideToggle(200)},"click; #DownloadView-Download-Start":function(e){if(e.preventDefault(),!this.dataForViews.downloadRequiresLoginEnabled||void 0!==PARTcloud.loginStatus.loggedin&&!1!==PARTcloud.loginStatus.loggedin){var t=this.$el.find(".DownloadView-Download-Selection").first(),o=t.find("option:selected"),i=t.val(),a=o.attr("data-options"),r=void 0!==o.data("partserver");PARTcloudDownloader.download(this.dataForViews.model,i,a,r)}else this.showLoginView()},"click; .DownloadView-Download-Original":function(e){var t=this.dataForViews.model;PARTcloudApi.getOriginalFile(t.model_id,this.dataForViews.share_key).done(function(e){e.file_path&&PARTcloudDownloader._downloadFile(PARTcloud.partcloudBaseUrl+"/"+e.file_path,t)})},"click; .DownloadView-ExternalDownload":function(e){e.preventDefault();var t=o(e.currentTarget).data("url");window.open(t,"_blank")}}})}(jQuery),function(d){"use strict";brite.registerView("EditView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;o.model=e.model;var i=PARTcloud.loginStatus,a=i&&!0===i.loggedin&&i.user_id===o.model.user.user_id,r=i&&!0===i.loggedin&&!0===i.isadmin,n=o.model.uploaded&&a,l=o.model.uploaded&&i&&!0===i.loggedin&&i.user_id===o.model.user.user_id&&o.model.license_id===PARTcloud.licenses.private;return o.additionalFilesEnabled=PARTcloudConfig.isFeatureEnabled("additionalFiles"),o.canEditPart=a||r,o.canCollect=n,o.canSharePart=l,o.maxSize=PARTcloudConfig.getUploadMaxFileSize()/1024/1024,o.backgroundColor={top:o.model.background_color_top||PARTcloud.viewerColorTop,bottom:o.model.background_color_bottom||PARTcloud.viewerColorBottom},PARTcloud.renderTemplate("tpl-EditView",o)},init:function(e,t){this.validStatus={nameValid:!0,descriptionValid:!0,categoryValid:!0}},postDisplay:function(e,t){var a=this;if(a.canEditPart){var o;a.model.original_path&&(a.model.original_downloadable?a.$el.find("#EditView-Edit-Disable-Download").show():a.$el.find("#EditView-Edit-Enable-Download").show()),tinymce.init({selector:"#EditView-Description-Textarea",theme:"modern","max-width":600,statusbar:!1,menubar:!1,relative_urls:!1,remove_script_host:!0,toolbar:"undo redo | bold italic underline | bullist numlist | emoticons | alignleft aligncenter alignright alignjustify | outdent indent",plugins:["autolink","autoresize","emoticons"],autoresize_min_height:200,autoresize_max_height:400,autoresize_bottom_margin:0,setup:function(t){t.on("keyup",function(e){a.validStatus.descriptionValid=0!==t.save().length,a.markValidation()})}}),a.canSharePart&&PARTcloud.showPrivateShareView(a.$el.find("#EditView-PrivateShare-Container"),a),a.initColorPickers(),a.model.background_image_path&&(a.$el.find("#EditView-Background-Image-Preview").attr("src",PARTcloudHelpers.prependPartcloudBaseUrl(a.model.background_image_path)),a.$el.find(".EditView-Background-Image-Add").hide(),a.$el.find(".EditView-Background-Image-Remove").show()),o=!1===isNaN(a.model.category_id)?a.model.category_id:null;var i=a.$el.find("#EditView-Category");a.pclCategoryHandler=new PARTcloudCategory(i,o,!0),a.pclCategoryHandler.readyPromise.done(function(e){a.categoryChange(a.pclCategoryHandler.getSelectedCategoryId())}),a.pclCategoryHandler.setChangeHandler(a.categoryChange,a),a.$el.find("#EditView-Tag-New").autocomplete({minLength:1,delay:200,source:function(e,t){e.term=1<e.term.length&&"#"===e.term.charAt(0)?e.term.substring(1):e.term,PARTcloudApi.getLocaleTagsLikeForModel(e.term,a.model.model_id).done(function(e){var o=[];d.each(e,function(e,t){t.label=t.name,o.push(t)}),t(o)})},create:function(){d(this).data("ui-autocomplete")._renderItem=function(e,t){var o=d("<li>"),i=d("<div>").addClass("ui-menu-item-wrapper").append(t.name);return 1===t.admin_tag&&i.addClass("ui-admin-menu-item"),o.append(i).appendTo(e),o}}}),a.manageImageOptions(),PARTcloudApi.getUserCollections(a.model.user_id).done(function(e,t,o){if(0<e.length){var i=a.$el.find(".EditView-Collection-Selection").first().empty();d.each(e,function(e,t){i.append(d("<option>").val(t.collection_id).html(t.name))})}}),a.model.collection_id?a.$el.find(".EditView-Button-Remove-Collection-Container").show():a.$el.find(".EditView-Button-Add-Collection-Container").show();var r=a.$el.find(".EditView-AdditionalFiles-Upload-Selection").first();PARTcloudApi.getFileTypes().done(function(e){d.each(e,function(e,t){r.append(d("<option>").val(e).data("extension",t.extension).html(t.name+" (."+t.extension+")"))});var t=a.$el.find(".EditView-AdditionalFiles-Upload-Selection").first().find("option:selected").data("extension");a.$el.find(".EditView-AdditionalFiles-Upload-File").attr("accept","."+t+",."+t.toUpperCase())}),PARTcloudApi.getFiles(a.model.model_id).done(function(e){var r=a.$el.find(".EditView-AdditionalFiles-Container");d.each(e,function(e,t){var o=d("<div class='EditView-AdditionalFiles-File'>"),i=d("<div>");i.text(t.name),i.prepend(d("<i class='icon pcl-icon-folder-open'>")),o.append(i);var a=d("<button class='EditView-AdditionalFiles-DeleteFile' data-id='"+t.file_id+"'>");a.text(PARTcloudHelpers.translate("pcl_additionalfiles_delete")),o.append(a),r.append(o)})})}else PARTcloud.showErrorView(a.$el.find("#EditView-Error"),PARTcloudHelpers.translate("pcl_no_edit_permission"),!1)},destroy:function(){tinymce.editors.forEach(function(e){e.remove()})},events:{"click; #EditView-Tag-Save":function(e){var a=this,r=a.$el.find("#EditView-Tag-New"),t=r.val();""!==(t="#"===t.charAt(0)?t.substring(1):t)&&PARTcloudApi.addModelTag(a.model.model_id,t).done(function(e){if(void 0===e.status||"error"!==e.status){var t="EditView-Tag";e.admin_tag&&(t+=" EditView-Tag-Admin");var o=d("<div />",{class:t,"data-tag_id":e.tag_id,"data-tag_name":PARTcloudHelpers.encodeURIComponentName(e.name)});o.append(d("<a/>",{class:"EditView-Tag-Text",href:PARTcloudHelpers.prependPartcloudBaseUrl("?route=index&tag_id="+e.tag_id+"&tag_name="+PARTcloudHelpers.encodeURIComponentName(e.name)),text:e.name})).append(" "),o.append(d("<i/>",{class:"EditView-Tag-Remove fa fa-times pclIconColorNormal",title:PARTcloudHelpers.translate("pcl_part_delete")}));var i=a.$el.find(".EditView-Tag").last();0!==i.length?o.insertAfter(i):o.prependTo(a.$el.find("#EditView-Tags-Container")),r.val("")}})},"paste cut change keydown keyup blur; #EditView-Name":function(){this.validateName()},"click; .EditView-Background-Image-Add":function(e){this.$el.find(".EditView-Background-Image-File").click()},"change; .EditView-Background-Image-File":function(e){var t=this,o=e.target.files[0],i=d(e.target).val();if(0!==i.length){var a=i.split(".").pop().toLowerCase();if(-1!==d.inArray(a,["jpeg","jpg","gif","png"])&&FileReader){var r=new FileReader;r.onload=function(){t.$el.find("#EditView-Background-Image-Preview").attr("src",r.result),t.markValidation()},r.readAsDataURL(o),t.$el.find(".EditView-Background-Image-Add").hide(),t.$el.find(".EditView-Background-Image-Remove").show()}}},"click; .EditView-Background-Image-Remove":function(e){var t=this;t.$el.find(".EditView-Background-Image-Remove").hide(),t.$el.find(".EditView-Background-Image-Add").show(),t.$el.find(".EditView-Background-Image-File").val(""),t.$el.find("#EditView-Background-Image-Preview").removeAttr("src"),t.markValidation()},"click; .EditView-Tag-Remove":function(e){var t=d(e.currentTarget).parent(),o=t.data("tag_id");PARTcloudApi.removeModelTag(this.model.model_id,o).done(function(e){void 0!==e.status&&"error"===e.status||t.bRemove()})},"click; .EditView-Edit-Images-Delete":function(e){var o=this,i=d(e.currentTarget).data("id");PARTcloudApi.deleteImage(i).done(function(e){var t=o.model.images;o.model.images=[],t.forEach(function(e,t){e.image_id!==i&&o.model.images.push(e)}),i===o.model.front_image_id&&(o.model.front_image_id=o.model.images[0].image_id),o.$el.find('.EditView-Edit-Images-Image-Container[data-id="'+i+'"]').remove(),o.manageImageOptions()})},"click; .EditView-Edit-Images-Add":function(e){this.$el.find("#EditView-UploadImage-File").click()},"change; #EditView-UploadImage-File":function(e){var n=this,t=d(e.target).val();if(0!==t.length){var o=t.split(".").pop().toLowerCase();if(-1!==d.inArray(o,["jpeg","jpg","gif","png"])){var i=e.target;n.$el.find(".EditView-Edit-Images-Add").hide(),PARTcloudApi.uploadImage(n.model.model_id,"",i,n.resizeImageProgressbar,n.pauseImageProgressbar).done(function(e){if(e.image_id){n.model.images.push(e);var t=d("<div class='EditView-Edit-Images-Image-Container' data-id='"+e.image_id+"'>"),o=d("<div class='EditView-Edit-Images-Image'>"),i=d("<img src='"+PARTcloudHelpers.prependPartcloudBaseUrl(e.image_path_preview)+"'>");o.append(i);var a=d("<button class='EditView-Edit-Images-Button EditView-Edit-Images-Set-Preview' data-id='"+e.image_id+"'>");a.append(d("<i class='fa fa-picture-o'>")),a.append(d("<span>").append(PARTcloudHelpers.translate("pcl_viewer_set_as_preview"))),o.append(a);var r=d("<button class='EditView-Edit-Images-Button EditView-Edit-Images-Delete' data-id='"+e.image_id+"'>");r.append(d("<i class='fa fa-trash-o'>")),r.append(d("<span>").append(PARTcloudHelpers.translate("pcl_viewer_delete_image"))),o.append(r),t.append(o),n.$el.find("#EditView-Edit-Images-Container").append(t),n.$el.find("#EditView-UploadImage-File").val(""),n.$el.find(".EditView-Edit-Images-Add").show(),n.$el.find("#EditView-Edit-Images-Progressbar").hide(),n.manageImageOptions()}}).fail(function(e,t,o){})}}},"click; .EditView-Edit-Images-Set-Preview":function(e){var t=this,o=d(e.currentTarget).data("id");PARTcloudApi.setPreviewImage(t.model.model_id,o).done(function(e){t.model.front_image_id=o,t.manageImageOptions()})},"click; #EditView-Submit-Button":function(e){var t=this;if(t.isAllValid()){var o=t.model.model_id,i=tinymce.get("EditView-Description-Textarea").save(),a=t.$el.find("#EditView-Name").val();if(0!==a.length){t.$el.find("#EditView-Name").css("border","1px solid #aaa");var r=t.pclCategoryHandler.getSelectedCategoryId();if(r){var n={model_id:o,name:a,description:i,category_id:r};t.colorChanged()&&(n.background_color_top=t.backgroundColor.top,n.background_color_bottom=t.backgroundColor.bottom),t.imageChanged()&&(n.background_image=t.$el.find("#EditView-Background-Image-Preview").attr("src")||"remove_old"),PARTcloudApi.editModelData(n).done(function(e){t.markValidation(!0),t.model.description=i,t.model.name=a,t.model.category_id=r,t.model.background_color_top=t.backgroundColor.top,t.model.background_color_bottom=t.backgroundColor.bottom,t.model.background_image_path=e.background_image_path,t.model.background_image_path&&t.$el.find("#EditView-Background-Image-Preview").attr("src",PARTcloudHelpers.prependPartcloudBaseUrl(e.background_image_path))})}else t.$el.find("#EditView-Category:first-child").css("border","1px solid red")}else t.$el.find("#EditView-Name").css("border","1px solid red")}else t.markValidation(!0)},"click; .EditView-Button-Remove-Collection":function(e){var i=this;PARTcloudApi.removeModelFromCollection(i.model.model_id).done(function(e,t,o){"success"===e.status&&(i.$el.find(".EditView-Button-Add-Collection-Container").show(),i.$el.find(".EditView-Button-Remove-Collection-Container").hide())})},"click; .EditView-Button-Add-To-Collection-Approve":function(e){var t=this,o=t.$el.find(".EditView-Collection-Selection option:selected").first(),i=o.val(),a=o.text();PARTcloudApi.addModelToCollection(t.model.model_id,i).done(function(e){"success"===e.status&&(t.$el.find("#EditView-Remove-Collection-Name").html(a),t.$el.find(".EditView-Button-Remove-Collection-Container").show(),t.$el.find(".EditView-Button-Add-Collection-Container").hide())})},"click; #EditView-Button-Create-Collection":function(e){var t=this,o=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_part_modal_create_collection"),message:"<div id='EditView-CreateCollection-Dialog-Container'>",buttons:[]});o.show().done(function(){PARTcloud.showCreateCollectionView(d("#EditView-CreateCollection-Dialog-Container"),{parent:o,model:t.model}).done(function(){o.resize()})})},"click; #EditView-Edit-Disable-Download":function(e){var t=this;PARTcloudApi.setOriginalFileDownload(t.model.model_id,!1).done(function(){t.$el.find("#EditView-Edit-Enable-Download").show(),t.$el.find("#EditView-Edit-Disable-Download").hide()})},"click; #EditView-Edit-Enable-Download":function(e){var t=this;PARTcloudApi.setOriginalFileDownload(t.model.model_id,!0).done(function(){t.$el.find("#EditView-Edit-Disable-Download").show(),t.$el.find("#EditView-Edit-Enable-Download").hide()})},"click; #EditView-Edit-Delete-Button":function(e){d(e.currentTarget).hide(),this.$el.find("#EditView-Edit-Delete-Confirm-Container").show()},"click; #EditView-Edit-Delete-Submit":function(e){PARTcloudApi.deleteModel(this.model.model_id).done(function(e,t,o){"success"===e.status&&PARTcloud.route("?route=index")})},"click; #EditView-Edit-Delete-Cancel":function(e){this.$el.find("#EditView-Edit-Delete-Button").show(),this.$el.find("#EditView-Edit-Delete-Confirm-Container").hide()},"click; .EditView-AdditionalFiles-DeleteFile":function(e){e.preventDefault();var t=d(e.currentTarget),o=t.data("id");PARTcloudApi.deleteFile(o).done(function(){t.parent().remove()})},"change; .EditView-AdditionalFiles-Upload-Selection":function(e){var t=this.$el.find(".EditView-AdditionalFiles-Upload-Selection").first().find("option:selected").data("extension");this.$el.find(".EditView-AdditionalFiles-Upload-File").val("").attr("accept","."+t+",."+t.toUpperCase())},"change; .EditView-AdditionalFiles-Upload-File":function(e){var t=this.$el.find("#EditView-AdditionalFiles-Upload-Name");if(0===t.val().length){var o=d(e.currentTarget).val();if(0!==o.length&&2<=o.split(".").length){var i=o.split(".");i.pop();var a=i.join(".").split(/[\\/]/).pop().replace(/[_]/g," ");t.val(a)}}},"click; .EditView-AdditionalFiles-Upload-Start":function(e){var l=this;l.$el.find(".EditView-AdditionalFiles-Upload-Error-Container").remove();var t=l.$el.find("#EditView-AdditionalFiles-Upload-File").val(),o=l.$el.find(".EditView-AdditionalFiles-Upload-Selection").first().find("option:selected");if(0!==t.length){var i=o.data("extension");if(t.split(".").pop().toLowerCase()===i){var a=l.$el.find("#EditView-AdditionalFiles-Upload-File")[0],r=l.$el.find("#EditView-AdditionalFiles-Upload-Name").val(),n=o.val();l.showUploadProgressbar(),l.$el.find(".EditView-AdditionalFiles-UploadForm-Container").hide(),PARTcloudApi.uploadFile(l.model.model_id,n,r,a,l.resizeUploadProgressbar,l.pauseUploadProgressbar).done(function(e){if(l.hideUploadProgressbar(),l.$el.find(".EditView-AdditionalFiles-UploadForm-Container").show(),l.$el.find("#EditView-AdditionalFiles-Upload-File").val(""),l.$el.find("#EditView-AdditionalFiles-Upload-Name").val(""),void 0!==e.status&&"error"===e.status){var t=d("<div>").addClass("EditView-AdditionalFiles-Upload-Error-Container"),o=d("<span>").addClass("EditView-AdditionalFiles-Upload-Error-Message").text(e.message);t.append(o),l.$el.find(".EditView-AdditionalFiles-UploadForm-Container").append(t)}else{var i=l.$el.find(".EditView-AdditionalFiles-Container"),a=d("<div class='EditView-AdditionalFiles-File'>"),r=d("<div>");r.text(e.name),r.prepend(d("<i class='icon pcl-icon-folder-open'>")),a.append(r);var n=d("<button class='EditView-AdditionalFiles-DeleteFile' data-id='"+e.file_id+"'>");n.text("Delete"),a.append(n),i.append(a)}}).fail(function(e,t,o){l.$el.find(".EditView-AdditionalFiles-Upload-Button").show()})}}},"click; #EditView-Header-BackButton":function(){PARTcloud.route("?route=part&model_id="+this.model.model_id)}},showUploadProgressbar:function(){this.$el.find("#EditView-AdditionalFiles-UploadProgressbar").show()},resizeUploadProgressbar:function(e){var t=parseInt(e.loaded,10)/parseInt(e.total,10)*100;d("#EditView-AdditionalFiles-UploadProgressbar").progressbar({value:t}),d("#EditView-AdditionalFiles-UploadProgressbar-Label").text(t+"%")},pauseUploadProgressbar:function(){d("#EditView-AdditionalFiles-UploadProgressbar").progressbar({value:!1}),d("#EditView-AdditionalFiles-UploadProgressbar-Label").text(PARTcloudHelpers.translate("pcl_part_please_wait"))},hideUploadProgressbar:function(){this.$el.find("#EditView-AdditionalFiles-UploadProgressbar").hide()},initColorPickers:function(){var a=this,e=a.$el.find(".EditView-Background-Color-Top");e.tinycolorpicker({});var r=e.data("plugin_tinycolorpicker");r.setColor(a.backgroundColor.top);var t=a.$el.find(".EditView-Background-Color-Bottom");t.tinycolorpicker({});var n=t.data("plugin_tinycolorpicker");n.setColor(a.backgroundColor.bottom);var o="linear-gradient("+r.colorHex+", "+n.colorHex+")";a.$el.find("#EditView-Background-Colors-Preview").css({background:o}),e.on("change",function(e,t,o){var i="linear-gradient("+t+", "+n.colorHex+")";a.$el.find("#EditView-Background-Colors-Preview").css({background:i}),a.backgroundColor.top=t.toLowerCase(),a.markValidation()}),t.on("change",function(e,t,o){var i="linear-gradient("+r.colorHex+", "+t+")";a.$el.find("#EditView-Background-Colors-Preview").css({background:i}),a.backgroundColor.bottom=t.toLowerCase(),a.markValidation()})},manageImageOptions:function(){var n=this;n.model.images.forEach(function(e,t){var o=e.image_id,i=o===n.model.front_image_id;n.canEditPart&&!i?n.$el.find('.EditView-Edit-Images-Set-Preview[data-id="'+o+'"]').css("display","block"):n.$el.find('.EditView-Edit-Images-Set-Preview[data-id="'+o+'"]').css("display","none");var a=!0===new RegExp("^preview","i").test(e.image_path),r=PARTcloud.loginStatus&&!0===PARTcloud.loginStatus.loggedin&&PARTcloud.loginStatus.user_id===e.user_id;!n.canEditPart&&!r||a?n.$el.find('.EditView-Edit-Images-Delete[data-id="'+o+'"]').css("display","none"):n.$el.find('.EditView-Edit-Images-Delete[data-id="'+o+'"]').css("display","block")})},markEditFields:function(e,o){d.each(e,function(e,t){t.css("color",o)})},isAllValid:function(){return this.validStatus.nameValid&&this.validStatus.descriptionValid&&this.validStatus.categoryValid},categoryChange:function(e){this.validStatus.categoryValid=!("boolean"==typeof e&&!1===e),this.markValidation()},colorChanged:function(){var e=this;return e.model.background_color_bottom&&e.model.background_color_top?e.model.background_color_top!==e.backgroundColor.top||e.model.background_color_bottom!==e.backgroundColor.bottom:e.backgroundColor.top!==PARTcloud.viewerColorTop||e.backgroundColor.bottom!==PARTcloud.viewerColorBottom},imageChanged:function(){var e=this.$el.find("#EditView-Background-Image-Preview").attr("src");return this.model.background_image_path?PARTcloudHelpers.prependPartcloudBaseUrl(this.model.background_image_path)!==e:void 0!==e},resizeImageProgressbar:function(e){var t=parseInt(e.loaded,10)/parseInt(e.total,10)*100;d("#EditView-Edit-Images-Progressbar").progressbar({value:t}),d("#EditView-Edit-Images-Progressbar-Label").text(t+"%")},pauseImageProgressbar:function(){d("#EditView-Edit-Images-Progressbar").progressbar({value:!1}),d("#EditView-Edit-Images-Progressbar-Label").text(PARTcloudHelpers.translate("pcl_part_please_wait"))},validateName:function(){var e=this.$el.find("#EditView-Name").val();this.validStatus.nameValid=0<e.length,this.markValidation()},markValidation:function(e){var t=this,o=e||!1,i=t.$el.find("#EditView-Submit-Button"),a=[];if(t.isAllValid()){var r=tinymce.get("EditView-Description-Textarea").save(),n=t.$el.find("#EditView-Name").val(),l=t.pclCategoryHandler.getSelectedCategoryId(),d=!(t.model.description===r&&t.model.name===n&&t.model.category_id===l),s=t.colorChanged(),c=t.imageChanged();d||s||c?o?(i.hasClass("Saved-Button")||i.addClass("Saved-Button"),i.hasClass("Unsaved-Button")&&i.removeClass("Unsaved-Button"),a=[t.$el.find("#EditView-Edit-Name").find("label"),t.$el.find("#EditView-Edit-Description").find("label"),t.$el.find("#EditView-Edit-Category").find("label")],t.markEditFields(a,"#00be00")):(i.hasClass("Saved-Button")&&i.removeClass("Saved-Button"),i.hasClass("Unsaved-Button")||i.addClass("Unsaved-Button"),a=[t.$el.find("#EditView-Edit-Name").find("label"),t.$el.find("#EditView-Edit-Description").find("label"),t.$el.find("#EditView-Edit-Category").find("label")],t.markEditFields(a,"#666666")):(i.hasClass("Unsaved-Button")&&i.removeClass("Unsaved-Button"),i.hasClass("Saved-Button")||i.addClass("Saved-Button"),a=[t.$el.find("#EditView-Edit-Name").find("label"),t.$el.find("#EditView-Edit-Description").find("label"),t.$el.find("#EditView-Edit-Category").find("label")],t.markEditFields(a,"#666666"))}else i.hasClass("Unsaved-Button")||i.addClass("Unsaved-Button"),i.hasClass("Saved-Button")&&i.removeClass("Saved-Button"),t.validStatus.nameValid||a.push(t.$el.find("#EditView-Edit-Name").find("label")),t.validStatus.descriptionValid||a.push(t.$el.find("#EditView-Edit-Description").find("label")),t.validStatus.categoryValid||a.push(t.$el.find("#EditView-Edit-Category").find("label")),t.markEditFields(a,"#FF0000")}})}(jQuery),function(s){"use strict";brite.registerView("EmbeddedView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;o.model=e.model,PARTcloud.viewerColorTop=PARTcloudHelpers.getParameter("topColor",PARTcloud.viewerColorTop),PARTcloud.viewerColorBottom=PARTcloudHelpers.getParameter("bottomColor",PARTcloud.viewerColorBottom);var i=PARTcloudHelpers.getParameter("cameraParams","false"),a=PARTcloudConfig.isFeatureEnabled("downloadLoggingCompany");o.embeddedConfig={showHotspots:"true"===PARTcloudHelpers.getParameter("showHotspots","true"),showDescription:"true"===PARTcloudHelpers.getParameter("showDescription","true"),showLicense:"true"===PARTcloudHelpers.getParameter("showLicense","true"),showDownloadButton:"true"===PARTcloudHelpers.getParameter("showDownloadButton",!1),noAutoload:"true"===PARTcloudHelpers.getParameter("noAutoload",!1),autoRotate:"true"===PARTcloudHelpers.getParameter("autoRotate",!1),hideMenu:"true"===PARTcloudHelpers.getParameter("hideMenu",!1),cameraParams:"false"!==i&&JSON.parse(i)},o.embeddedConfig.showDownloadButton&&o.model.license_id!==PARTcloud.licenses.externalDownload&&(o.embeddedConfig.showLicense=!0);var r=o.model.preview.image_id;s.each(o.model.images,function(e,t){return t.image_id!==r||(o.model.images.unshift(o.model.images[e]),o.model.images.splice(e+1,1),!1)});var n=1<o.model.images.length,l=PARTcloudHelpers.prependPartcloudBaseUrl("index?route=part&name="+PARTcloudHelpers.encodeURIComponentName(o.model.name)+"&model_id="+o.model.model_id);o.dataForViews={model:o.model,canEditPart:!1,canSetImageAsPreview:!1,thereAreMultipleImages:n,fullLinkToThisPart:l,embeddedConfig:o.embeddedConfig};var d={};return a&&s.extend(d,{logging_company:o.model.user.username}),PARTcloud.setUserInfoForDownloadLogging(d),PARTcloud.renderTemplate("tpl-EmbeddedView",o.dataForViews)},init:function(e,t){},postDisplay:function(e,t){var o=this;if(PARTcloud.showPreviewView(o.$el.find("#EmbeddedView-Viewer-Container"),o.dataForViews).done(function(e){e.viewerPromise.done(function(){o.embeddedConfig.autoRotate&&s(".ComponentCustomizeWebViewer3DFavoriteButtonsBarContainer [data-action='actAnimate']").click(),o.embeddedConfig.showHotspots&&PARTcloud.showHotspotsView(o.$el.find("#EmbeddedView-Hotspots-Container"),{hotspots:o.model.hotspots,previewView:e})})}),o.embeddedConfig.showLicense&&PARTcloud.showLicenseView(o.$el.find("#EmbeddedView-License-Container"),o.dataForViews),o.embeddedConfig.showDownloadButton&&o.model.downloadable){var i=o.$el.find(".EmbeddedView-Format-Selection").first();PARTcloudApi.getDownloadFormats(o.model.model_id).done(function(e){void 0!==e.status&&"error"===e.status?(o.$el.find(".EmbeddedView-Format-Selection").show(),o.$el.find(".EmbeddedView-Loading-Formats").hide()):(s.each(e,function(e,t){var o=s("<option>").val(t.format).data("options",JSON.stringify(t.options)).html(t.name);t.partserver&&o.data("partserver",t.format),i.append(o)}),o.$el.find(".EmbeddedView-Format-Selection").show(),o.$el.find(".EmbeddedView-Loading-Formats").hide(),o.$el.find(".EmbeddedView-Viewer-Button-Download").prop("disabled",!1))})}s("body").css("backgroundColor","transparent")},destroy:function(){},events:{"click; #EmbeddedView-Description-Text a":function(e){e.preventDefault();var t=e.currentTarget.href;window.open(t,"_blank")},"click; #EmbeddedView-Viewer-Button-Download":function(e){if(e.preventDefault(),!this.dataForViews.downloadRequiresLoginEnabled||void 0!==PARTcloud.loginStatus.loggedin&&!1!==PARTcloud.loginStatus.loggedin){var t=this.$el.find(".EmbeddedView-Format-Selection").first(),o=t.find("option:selected"),i=t.val(),a=o.data("options"),r=void 0!==o.data("partserver");PARTcloudDownloader.download(this.model,i,a,r)}else this.showLoginView()}}})}(jQuery),function(i){"use strict";brite.registerView("EmbeddedViewerView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;o.model=e.model,PARTcloud.viewerColorTop=PARTcloudHelpers.getParameter("topColor",PARTcloud.viewerColorTop),PARTcloud.viewerColorBottom=PARTcloudHelpers.getParameter("bottomColor",PARTcloud.viewerColorBottom);var i=PARTcloudHelpers.getParameter("cameraParams","false");o.embeddedConfig={noAutoload:"true"===PARTcloudHelpers.getParameter("noAutoload",!1),autoRotate:"true"===PARTcloudHelpers.getParameter("autoRotate",!1),hideMenu:"true"===PARTcloudHelpers.getParameter("hideMenu",!1),cameraParams:"false"!==i&&JSON.parse(i)};var a=PARTcloudHelpers.getFullLinkToPart(o.model.model_id,o.model.name);return o.dataForViews={model:o.model,fullLinkToThisPart:a,embeddedConfig:o.embeddedConfig},PARTcloud.renderTemplate("tpl-EmbeddedViewerView",o.dataForViews)},init:function(e,t){},postDisplay:function(e,t){var o=this;PARTcloud.showViewerView(o.$el.find("#EmbeddedViewerView-Viewer-Container"),o.dataForViews).done(function(e){o.viewerView=e,o.embeddedConfig.autoRotate&&e.viewerPromise.done(function(){i(".ComponentCustomizeWebViewer3DFavoriteButtonsBarContainer [data-action='actAnimate']").click()})})},destroy:function(){},events:{"click; .EmbeddedViewerView-Enabled3D button":function(e){PARTcloud.isViewerInitialized||(this.$el.find(".EmbeddedViewerView-Preview").hide(),this.viewerView.loadWebViewer3D())}}})}(jQuery),function(e){"use strict";brite.registerView("ErrorView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return PARTcloud.renderTemplate("tpl-ErrorView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){}})}(jQuery),function(e){"use strict";brite.registerView("HelpView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return e.helpIframeUrl=PARTcloudConfig.getHelpIframeUrl(),window.addEventListener("message",function(e){if("HelpIFrame:DOMContentLoaded"===e.data){var t=this.window.document.getElementById("help-iframe"),o=t.contentWindow.document.body.scrollHeight+"px";console.log("resizing iframe on load event to "+o),t.height=o}},!1),PARTcloud.renderTemplate("tpl-HelpView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){}})}(jQuery),function(o){"use strict";brite.registerView("HotspotsView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.previewView=e.previewView,PARTcloud.renderTemplate("tpl-HotspotsView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){},events:{"click; .HotspotsView-Hotspot":function(e){this.previewView.activate3DPreview();var t=o(e.currentTarget).data("id");PARTcloud.viewer.rotateToHotSpot(t,!0,!0)}}})}(jQuery),function(e){"use strict";brite.registerView("ImageView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.parent=e.parent||!1,this.images=e.images,this.currentIndex=e.currentIndex,PARTcloud.renderTemplate("tpl-ImageView",e)},init:function(e,t){},postDisplay:function(e,t){var o=this,i=o.$el.find("#ImageView-Image-Container"),a=[];o.images.forEach(function(e,t){a.push({imagePath:PARTcloudHelpers.prependPartcloudBaseUrl(e.image_path)})});var r=o.currentIndex;o.slider=new psol.components.ImageViewer({$container:i,images:a,carousel:!0,startsById:r}),o.slider.show()},destroy:function(e,t){}})}(jQuery),function(e){"use strict";brite.registerView("LicenseView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return e.isB2BIntegrated=PARTcloudConfig.isFeatureEnabled("b2bIntegration"),PARTcloud.renderTemplate("tpl-LicenseView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){},events:{}})}(jQuery),function(C){"use strict";brite.registerView("LoginView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;return o.registerFirst=e.registerFirst||!1,o.registerSelectsFilled=!1,o.formId=(new Date).getTime()+"_"+PARTcloudHelpers.getRandomInt(1,999999999),o.parent=e.parent||!1,PARTcloud.renderTemplate("tpl-LoginView",{form_id:o.formId})},init:function(e,t){this.registerFirst&&(this.$el.find("#LoginView-LoginContainer").hide(),this.$el.find("#LoginView-RegisterContainer").show())},postDisplay:function(e,t){},destroy:function(){void 0!==this.reCaptchaInstance&&this.reCaptchaInstance.destroy()},events:{"submit; form[name=LoginView-LoginForm]":function(e){e.preventDefault();var i=this;i.$el.find("#LoginView-LoginError").hide(),i.$el.find("#LoginView-RegisterSuccess").hide(),i.$el.find("#login").replaceWith(C("<img>",{id:"login",src:PARTcloudHelpers.prependPartcloudBaseUrl("/img/loading_24x24.gif")}));var t=i.$el.find("#login-email").val(),o=i.$el.find("#login-word").val(),a=i.$el.find("#login-remember").prop("checked");PARTcloudApi.login(t,o,a).done(function(e,t,o){PARTcloudApi.getLoginStatus().done(function(e,t,o){e.loggedin?window.location.reload(!0):(i.$el.find("#LoginView-LoginError").show(),i.$el.find("#login").replaceWith(C("<input>",{type:"submit",id:"login",name:"login",value:"Login"})))})})},"submit; form[name=LoginView-RegisterForm]":function(e){e.preventDefault();var t=this,o=!0,i={};t.$el.find(".LoginView-RegisterForm-Error").text("").hide();var a=t.$el.find("#register-email").val();0===a.length&&(o=!(i.email="Email is required"));var r=t.$el.find("#register-password").val();0===r.length&&(o=!(i.password="Password is required"));var n=t.$el.find("#register-password_confirm").val();0===r.length&&(o=!(i.password_confirm="Password (Confirm) is required")),r!==n&&(o=!(i.password_confirm="Passwords didn't match"));var l=t.$el.find("#register-first_name").val();0===l.length&&(o=!(i.first_name="First Name is required"));var d=t.$el.find("#register-last_name").val();0===d.length&&(o=!(i.last_name="Last Name is required"));var s=t.$el.find("#register-company").val();0===s.length&&(o=!(i.company="Company is required"));var c=t.$el.find("#register-street").val();0===c.length&&(o=!(i.street="Street is required"));var u=t.$el.find("#register-zip").val();0===u.length&&(o=!(i.zip="ZIP Code is required"));var p=t.$el.find("#register-city").val();0===p.length&&(o=!(i.city="City is required"));var m=t.$el.find("#register-country").val();"false"===m&&(o=!(i.country="Country is required"));var g=t.$el.find("#register-language").val();"false"===g&&(o=!(i.language="Language is required"));var h=t.$el.find("#register-timezone").val();"false"===h&&(o=!(i.timezone="Timezone is required"));var f=t.$el.find("#register-picture"),w=f.val(),v=w.split(".").pop().toLowerCase();w&&-1===C.inArray(v,PARTcloud.allowedExtensionForProfilePicture)&&(o=!(i.picture="No allowed extension"));var P=t.$el.find("#register-cadmodelscontact").prop("checked"),T=t.$el.find("#register-accepted_tos").prop("checked");!1===T&&(o=!(i.accepted_tos="You have to accept the Terms of Service"));var _=t.$el.find("#register-accepted_tos").prop("checked"),V=t.reCaptchaInstance.getResponse();0===V.length&&(o=!(i.g_recaptcha_response="You have to proof that you're not a robot")),!0===o?PARTcloudApi.register(a,r,n,l,d,s,c,u,p,m,g,h,f[0],T,P,_,V).done(function(e){"success"===e.status?(t.$el.find("#LoginView-RegisterSuccess").show(),t.$el.find("#LoginView-LoginContainer").show(),t.$el.find("#LoginView-RegisterContainer").hide()):"error"===e.status&&t.displayRegisterErrors(e.message)}):t.displayRegisterErrors(i)},"click; #LoginView-Register-Switch":function(e){var o=this;if(o.$el.closest(".TileView-Login-Modal").parent().unbind("mousedown"),!1===o.registerSelectsFilled){PARTcloudApi.getLanguages().done(function(e){var t=o.$el.find("#register-language");o.fillSelect(e,t)}),PARTcloudApi.getCountries().done(function(e){var t=o.$el.find("#register-country");o.fillSelect(e,t)}),PARTcloudApi.getTimezones().done(function(e){var t=o.$el.find("#register-timezone");o.fillSelect(e,t)});var t=o.$el.find('form[data-form_id="'+o.formId+'"]>.LoginView-RegisterForm-Recaptcha-Container');o.reCaptchaInstance=new PARTcloudRecaptcha(PARTcloud.googleRecaptchaSiteKey,t),o.reCaptchaInstance.render(),o.registerSelectsFilled=!0}o.$el.find("#LoginView-LoginContainer").hide(),o.$el.find("#LoginView-RegisterContainer").show(),o.parent&&"function"==typeof o.parent._resize&&o.parent.resize()},"click; #LoginView-Login-Switch":function(e){var t=this;t.$el.find("#LoginView-LoginContainer").show(),t.$el.find("#LoginView-RegisterContainer").hide(),t.parent&&"function"==typeof t.parent._resize&&t.parent.resize()}},fillSelect:function(o,i){C.each(o,function(e){var t=C("<option>",{text:o[e],value:e});i.append(t)})},displayRegisterErrors:function(o){var i=this;C.each(o,function(e){var t=o[e];i.$el.find("#LoginView-RegisterForm-Error-"+e).text(t).show()})}})}(jQuery),function(r){"use strict";brite.registerView("LogoutView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=PARTcloud.isUserLoggedIn(),i=PARTcloudConfig.isFeatureEnabled("logout"),a=o&&i;return e={showLogoutButton:a,showLoginButton:!o&&i},a&&r.extend(e,{name:PARTcloud.loginStatus.name}),PARTcloud.renderTemplate("tpl-LogoutView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){},events:{"click; #LogoutView-Logout":function(e){e.preventDefault(),this.$el.find("#LogoutView-Logout").replaceWith(r("<img>",{id:"login",src:PARTcloudHelpers.prependPartcloudBaseUrl("/img/loading_24x24.gif")})),PARTcloudApi.logout().done(function(e,t,o){PARTcloudApi.getLoginStatus().done(function(e,t,o){!1===e.loggedin&&window.location.reload(!0)}).fail(function(e,t,o){window.location.reload(!0)})}).fail(function(e,t,o){window.location.reload(!0)})},"click; #LogoutView-Login":function(e){var t=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_login_login"),message:"<div id='LogoutView-Login-Dialog-Container'>",buttons:[]});t.show().done(function(){PARTcloud.showLoginView(r("#LogoutView-Login-Dialog-Container"),{parent:t}).done(function(){t.resize()})})}}})}(jQuery),function(e){"use strict";brite.registerView("MaintenanceView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return PARTcloud.renderTemplate("tpl-MaintenanceView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){}})}(jQuery),function(a){"use strict";brite.registerView("MainView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=PARTcloudConfig.getPortalName(),i=PARTcloudConfig.isFeatureEnabled("helpMenu"),a=PARTcloudConfig.isFeatureEnabled("uploadMenu");return PARTcloud.renderTemplate("tpl-MainView",{portalName:o,showHelpMenu:i,showUploadMenu:a})},init:function(e,t){},postDisplay:function(e,t){var o=this,i=o.$el.find("#MainView-Navigation-Item-Container");i.on("click","a",function(e){e.preventDefault();var t=a(this).attr("href");o.$el.find("#MainView-Menu > i").removeClass("fa-times").addClass("fa-bars"),i.removeClass("visible"),PARTcloud.route(t)})},destroy:function(){},events:{"click; #MainView-Back":function(e){e.preventDefault(),history.back()},"click; #MainView-Menu":function(e){e.preventDefault();var t=this.$el.find(e.currentTarget).find("i");t.hasClass("fa-bars")?(t.removeClass("fa-bars").addClass("fa-times"),this.$el.find("#MainView-Navigation-Item-Container").addClass("visible")):(t.removeClass("fa-times").addClass("fa-bars"),this.$el.find("#MainView-Navigation-Item-Container").removeClass("visible"))}}})}(jQuery),function(e){"use strict";brite.registerView("ManufacturingView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this,i=PARTcloud.loginStatus.loggedin&&PARTcloud.loginStatus.user_id===e.model.user_id,a=PARTcloud.licenses.shareAlike===e.model.license_id;return o.dataForView={topologyStatus:!1,canEditPart:e.canEditPart,model:e.model,notPrintable:-1===e.model.printability,partlyPrintable:0===e.model.printability,fullPrintable:1===e.model.printability,showOrders:(i||a)&&e.model.printable},e.topology.topologyStatus===PARTcloudApi.topologyStatus.ready&&(o.dataForView.topologyStatus=!0,o.dataForView.topology={area:Math.round(e.topology.AREA.attributes.Area.value.toFixed(2)/100),volume:Math.round(e.topology.VOL.attributes.Volume.value/1e3),xdim:e.topology.SIZE.attributes.XDim.value,ydim:e.topology.SIZE.attributes.YDim.value,zdim:e.topology.SIZE.attributes.ZDim.value},o.dataForView.costs=PARTcloudConfig.getEstimatedPrintingCosts(e.topology)),PARTcloud.renderTemplate("tpl-ManufacturingView",o.dataForView)},init:function(e,t){},postDisplay:function(e,t){var o=this;if(o.dataForView.showOrders&&PARTcloud.showOrderView(o.$el.find("#ManufacturingView-Model-Orders"),{type:"model",sourceId:o.dataForView.model.model_id,manufacturer:[{manufacturer:"3yourmind",name:"3YOURMIND",claimText:PARTcloudHelpers.translate("pcl_order_claim_text_3yourmind")},{manufacturer:"3dhubs",name:"3D Hubs",claimText:PARTcloudHelpers.translate("pcl_order_claim_text_3dhubs")}]}),e.topology.topologyStatus===PARTcloudApi.topologyStatus.ready){var i=o.dataForView.topology.xdim,a=o.dataForView.topology.ydim,r=o.dataForView.topology.zdim,n=o.drawBoundingBoxCube(a,r,i,200,200);o.$el.find(".ManufacturingView-Inner").css("height",n+"px")}},destroy:function(){},drawBoundingBoxCube:function(e,t,o,i,a){var r=this.$el.find("#ManufacturingView-BoundingBox").get(0),n=o,l=e,d=t;if(r.getContext&&r.getContext("2d")){var s=1,c=Math.min(e,o,t);c<50&&(e*=s=50/c,t*=s,o*=s);var u=Math.max(e,o,t);130<u&&(e*=s=130/u,t*=s,o*=s);var p=o/2*Math.sin(45),m=p+5,g=r.getContext("2d");return g.lineWidth=2,g.strokeStyle="#000",g.moveTo(5,m),g.lineTo(5+e,m),g.lineTo(5+e,m+t),g.lineTo(5,m+t),g.lineTo(5,m),g.stroke(),g.moveTo(5,m),g.lineTo(5+p,m-p),g.lineTo(5+e+p,m-p),g.stroke(),g.moveTo(5+e,m),g.lineTo(5+e+p,m-p),g.lineTo(5+e+p,m-p+t),g.lineTo(5+e,m+t),g.stroke(),g.beginPath(),void 0!==g.setLineDash&&g.setLineDash([2,4]),g.moveTo(5,m+t),g.lineTo(5+p,m+t-p),g.lineTo(5+p+e,m+t-p),g.stroke(),g.moveTo(5+p,m+t-p),g.lineTo(5+p,m-p),g.closePath(),g.stroke(),g.font="12px Arial",g.fillStyle="#326283",m+t+15<=a-15?g.fillText(Math.round(l)+" mm",5+e/2,m+t+15):g.fillText(Math.round(l)+" mm",5+e/2,m+t-5),5+e+p+5<=i/2+50?g.fillText(Math.round(d)+" mm",5+e+p+2,m+t/2-p):g.fillText(Math.round(d)+" mm",7,m+t/2),5+e+p/2+5+3<=i/2+50?g.fillText(Math.round(n)+" mm",5+e+p/2+5+3,m+t-p/2+3):g.fillText(Math.round(n)+" mm",5+p/2+5+3,m-p/2+3),m+t+40}},events:{"change; .ManufacturingView-Printable-Switch input[name='printable-switch']:radio":function(e){var t=e.currentTarget.value;PARTcloudApi.setPrintability(this.dataForView.model.model_id,t)}}})}(jQuery),function(d){"use strict";brite.registerView("OrderView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.type=e.type,e.manufacturingViewEnabled=PARTcloudConfig.isFeatureEnabled("manufacturingView"),e.collectionDownload="collection"===e.type,this.collectionDownload=e.collectionDownload,PARTcloud.renderTemplate("tpl-OrderView",e)},init:function(e,t){},postDisplay:function(e,t){var o=this;if(o.claimLink=o.$el.find("#OrderView-Claim"),o.claimTextSpan=o.$el.find("#OrderView-Claim-Text"),o.failedButton=o.$el.find("#OrderView-Failed"),o.progressbarLabel=o.$el.find("#OrderView-Progressbar-Label"),o.progressbar=o.$el.find("#OrderView-Progressbar"),o.collectionDownload){var i=o.$el.find(".OrderView-FormatSelection").first();PARTcloudApi.getDefaultDownloadFormats().done(function(e){void 0!==e.status&&"error"===e.status||d.each(e,function(e,t){i.append(d("<option>").val(e).html(t.name))})})}},destroy:function(){},events:{"click; .OrderView-Button":function(e){var t=this,o=d(e.currentTarget),i=o.data("manufacturer"),a=o.data("source_id"),r=o.data("name"),n=o.data("claim_text");t.progressbar.progressbar({value:!1});var l=t.$el.find("#OrderView-Modal");t.dialog=l.dialog({modal:!0,title:r,create:function(){t.progressbar.show(),t.claimLink.hide(),t.failedButton.hide(),t.claimTextSpan.text(n),t.startExport(i,a)},close:function(){t.claimLink.val("href",""),t.claimTextSpan.empty(),t.progressbarLabel.empty(),t.progressbar.progressbar("destroy"),l.dialog("destroy")}})}},startExport:function(e,t){var o,i=this;"collection"===e&&(o=i.$el.find(".OrderView-FormatSelection").first().val()),"collection"===i.type?PARTcloudApi.exportCollection(t,e,o).done(function(e){void 0===e.order_id&&i.orderFailed(),i.getOrderStatus(e.order_id)}):"model"===i.type&&PARTcloudApi.exportModel(t,e,PARTcloudHelpers.getParameter("share_key",!1)).done(function(e){void 0===e.order_id&&i.orderFailed(),i.getOrderStatus(e.order_id)})},getOrderStatus:function(i){var a=this;PARTcloudApi.getOrderStatus(i).done(function(e){if(void 0!==e.status&&"running"===e.status){if(0<e.overall_exports){var t=e.finished_exports/e.overall_exports*100;a.progressbar.progressbar("value",t);var o=PARTcloudHelpers.translate("pcl_order_completed")+" "+e.finished_exports+"/"+e.overall_exports;a.progressbarLabel.text(o)}setTimeout(function(){a.getOrderStatus(i)},1e3)}else void 0!==e.status&&"success"===e.status?(a.progressbarLabel.text(PARTcloudHelpers.translate("pcl_order_complete")),a.orderClaimButton(i)):void 0!==e.message?a.orderFailed(e.message):a.orderFailed()})},orderClaimButton:function(e){var t=this;PARTcloudApi.claimOrder(e).done(function(e){t.claimLink.attr("href",e.url),t.claimLink.click(function(){t.dialog.dialog("close")}),t.claimLink.show(),t.progressbar.hide()})},orderFailed:function(e){this.progressbar.hide(),this.failedButton.text(e).show()}})}(jQuery),function(e){"use strict";brite.registerView("ParametricTableView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e){return PARTcloud.renderTemplate("tpl-ParametricTableView",e)},init:function(){PARTcloud.table=new psol.components.Table({$container:this.$el.find("#ParametricTableView-Table-Container"),wrapAllColumns:!0,viewMode:psol.components.Table.TABLE_MODE.TABLE})},postDisplay:function(o){PARTcloud.table.show().done(function(){var e={path:o.model.model_path+".prj"},t=/[&?]varset=([^&]*)/i.exec(window.location.href);t&&t[1]&&(e.mident=decodeURIComponent(t[1])),PARTcloud.currentVarsettransfer&&(e.varsettransfer=PARTcloud.currentVarsettransfer),PARTcloud.table.load(e)})},destroy:function(){PARTcloud.table={}},events:{}})}(jQuery),function(L){"use strict";brite.registerView("PartView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;o.model=e.model,o.previewView=void 0,o.similarParts=[],o.startVrMode=PARTcloudHelpers.getParameter("vr",!1),o.hasShareKey=!!o.model.share_key;var i=o.model.preview.image_id;L.each(o.model.images,function(e,t){return t.image_id!==i||(o.model.images.unshift(o.model.images[e]),o.model.images.splice(e+1,1),!1)});var a=PARTcloud.loginStatus,r=a&&!0===a.loggedin&&a.user_id===o.model.user.user_id,n=a&&!0===a.loggedin&&!0===a.isadmin,l=o.model.license_id===PARTcloud.licenses.private,d=r||n,s=d||l,c=n,u=o.model.uploaded&&r,p=o.model.uploaded&&a&&!0===a.loggedin,m=1<o.model.images.length,g=o.model.uploaded&&(r||n),h=o.model.tags&&o.model.tags.length,f=o.model.license_id===PARTcloud.licenses.externalDownload,w=o.model.uploaded&&o.model.downloadable||f,v=-1===[PARTcloud.licenses.externalDownload,PARTcloud.licenses.private,PARTcloud.licenses.noDownload].indexOf(o.model.license_id),P=d&&(o.model.uploaded||!1===o.model.uploaded&&""!==o.model.error_message),T=window.location.href,_=PARTcloudConfig.isFeatureEnabled("downloadLoggingCompany"),V=PARTcloudConfig.isFeatureEnabled("downloadRequiresLogin"),C=PARTcloudConfig.isFeatureEnabled("manufacturingView")&&!1===o.model.parametric,b=PARTcloudConfig.isFeatureEnabled("supplierParts"),A=PARTcloudConfig.isFeatureEnabled("qrCode"),y=o.canEmbedPart=o.model.uploaded,S=!0===a.loggedin,R=0<o.model.fileCount,k=S&&R&&PARTcloudConfig.isFeatureEnabled("additionalFiles"),x=0<o.model.hotspots.length,E=x||o.model.parametric,U=PARTcloudConfig.isFeatureEnabled("b2bIntegration"),I=h||s,F=o.model.uploaded&&a&&!0===a.loggedin&&a.user_id===o.model.user.user_id&&o.model.license_id===PARTcloud.licenses.private;o.dataForViews={model:o.model,viewerIsUploader:r,canEditPart:d,canEditTag:s,canCollect:u,canUploadImage:p,canSetImageAsPreview:g,thereAreTags:h,thereAreMultipleImages:m,showDownloadButton:w,showExternalDownloadButton:f,showLicenseView:v,canDeletePart:P,fullLinkToThisPart:T,downloadRequiresLoginEnabled:V,manufacturingViewEnabled:C,supplierPartsEnabled:b,qrCodeEnabled:A,canEmbedPart:y,canEditAdminTag:c,showAdditionalFiles:k,hasHotspots:x,hasAdditions:E,isB2BIntegrated:U,showTagInformation:I,canSharePart:F,isSharablePart:l};var D={};return _&&L.extend(D,{logging_company:o.model.user.username}),PARTcloud.setUserInfoForDownloadLogging(D),PARTcloud.renderTemplate("tpl-PartView",o.dataForViews)},init:function(e,t){tinymce.editors.forEach(function(e){e.remove()})},postDisplay:function(e,t){var o=this;PARTcloud.requests[2]=PARTcloudApi.getDownloadFormats(o.model.model_id).done(function(e){delete PARTcloud.requests[2],"error"!==e.status?(o.dataForViews.downloadFormats=e,o.dataForViews.share_key=o.model.share_key,PARTcloud.showDownloadView(o.$el.find("#PartView-Information-Download-Container"),o.dataForViews)):o.$el.find("#PartView-Information-Download-Container").empty()}),o.dataForViews.showAdditionalFiles&&PARTcloud.showAdditionalFilesView(o.$el.find("#PartView-Information-AdditionalFiles-Container"),o.dataForViews,o.model.model_id);var i=L.Deferred();PARTcloud.showPreviewView(o.$el.find("#PartView-Viewer-Container"),L.extend({viewerPromise:i},o.dataForViews)).done(function(e){o.previewView=e}),i.done(function(){if(o.model.parametric&&PARTcloud.showParametricTableView(o.$el.find("#PartView-ParametricTable-Container"),o.dataForViews).done(function(){o.parametricBridge=new psol.components.ViewerTableBridge(PARTcloud.viewer,PARTcloud.table),o.parametricBridge.onVarsetTransferChanged=function(e){PARTcloud.currentVarsettransfer=e,o.updateUrlVarset(e)},o.parametricBridge.setProjectPath(o.model.model_path+".prj"),o.parametricBridge.setVarsetTransfer(PARTcloud.currentVarsettransfer||"",!1,!1)}),o.dataForViews.hasHotspots&&PARTcloud.showHotspotsView(o.$el.find("#PartView-Hotspots-Container"),{hotspots:o.model.hotspots,previewView:o.previewView}),o.startVrMode){var e=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_part_start_vr_mode_title"),message:PARTcloudHelpers.translate("pcl_part_start_vr_mode_text"),buttons:[{label:PARTcloudHelpers.translate("pcl_part_start_vr_mode_yes"),callback:function(){PARTcloud.viewer.setVRMode(!0,!0),e.hide()}},{label:PARTcloudHelpers.translate("pcl_part_start_vr_mode_no"),callback:function(){e.hide()}}]});e.show()}}),o.showCommentView(1),o.dataForViews.showLicenseView&&PARTcloud.showLicenseView(o.$el.find("#PartView-License-Container"),o.dataForViews),o.dataForViews.manufacturingViewEnabled&&o.model.uploaded&&PARTcloud.showManufacturingView(o.$el.find("#PartView-Container-Manufacturing"),o.dataForViews),jQuery.ui.slider.prototype.widgetEventPrefix="slider";var a=o.$el.find("#PartView-SimilarParts-Quality-Slider"),r=o.$el.find("#PartView-SimilarParts-Quality-Value");a.slider({values:[1,PARTcloud.geosearchQuality],orientation:"horizontal",range:!0,min:1,max:100,animate:!0,slide:function(e,t){if(1<t.values[0]||t.values[1]<60)return!1;r.html(t.values[1]+"%")}}),r.html(a.slider("values")[1]+"%"),o.searchSimilarParts(),o.dataForViews.supplierPartsEnabled&&o.searchSupplierParts(),!1===o.model.uploaded&&""===o.model.error_message&&o.checkUploadStatus(o.model.model_id),o.dataForViews.model.liked_by_viewer?o.$el.find(".PartView-Information-Options-Dislike").show():o.$el.find(".PartView-Information-Options-Like").show(),o.$el.find("#PartView-Add-Tag-Input").autocomplete({minLength:1,delay:200,source:function(e,t){e.term=1<e.term.length&&"#"===e.term.charAt(0)?e.term.substring(1):e.term,PARTcloudApi.getLocaleTagsLikeForModel(e.term,o.model.model_id,!0).done(function(e){var o=[];L.each(e,function(e,t){t.label=t.name,o.push(t)}),t(o)})},create:function(){L(this).data("ui-autocomplete")._renderItem=function(e,t){var o=L("<li>"),i=L("<span>").addClass("icon pclIconFixedWidth pclIconFixedWidth"),a=L("<span>").addClass("icon pclIconFixedWidth pclIconFixedWidth"),r=L('<span class="PartView-Tags-NoWrap">').append(i).append("&nbsp;&nbsp;"+t.name),n=L("<div>").addClass("ui-menu-item-wrapper").append(r);return 1===t.admin_tag&&(n.addClass("ui-admin-menu-item"),a.addClass("pcl-icon-tags"),r.append("&nbsp;").append(a)),!0===t.has_description&&i.addClass("pcl-icon-information"),null!==t.background_color&&n.css("background-color",t.background_color),null!==t.color&&n.css("color",t.color),o.append(n).appendTo(e),o}}}),o.dataForViews.isSharablePart&&PARTcloud.showPrivateShareView(o.$el.find("#PartView-PrivateShare-Container"),o.dataForViews)},destroy:function(){tinymce.editors.forEach(function(e){e.remove()})},events:{"click; .PartView-Information-Options-Like":function(e){var o=this,i=L(e.currentTarget);if(void 0!==PARTcloud.loginStatus.loggedin&&!0===PARTcloud.loginStatus.loggedin){var a=o.$el.find(".PartView-Information-Like");PARTcloud.likeModel(o.model.model_id).done(function(e){var t;void 0!==e.liked&&!1!==e.liked&&(0<(t=+a.find("span").first().text()+1)&&a.find("span").first().text(t),a.addClass(PARTcloudHelpers.getLikedClass()),i.hide(),o.$el.find(".PartView-Information-Options-Dislike").show())})}else o.showLoginView()},"click; .PartView-Information-Options-Dislike":function(e){var o=this,i=L(e.currentTarget);if(void 0!==PARTcloud.loginStatus.loggedin&&!0===PARTcloud.loginStatus.loggedin){var a=o.$el.find(".PartView-Information-Like");PARTcloud.likeModel(o.model.model_id).done(function(e){var t;void 0!==e.liked&&!0===e.liked||(0<=(t=+a.find("span").first().text()-1)&&a.find("span").first().text(t),a.removeClass(PARTcloudHelpers.getLikedClass()),i.hide(),o.$el.find(".PartView-Information-Options-Like").show())})}else o.showLoginView()},"click; .PartView-Tag-Text":function(e){e.preventDefault();var t=L(e.currentTarget).parent();PARTcloud.route("?route=index&tag_id="+t.data("tag_id")+"&tag_name="+t.data("tag_name"))},"click; #PartView-Information-Category-Name":function(e){var t=L(e.currentTarget).data("category_id");PARTcloud.route("?route=index&category="+t)},"click; #PartView-Information-Collection-Name":function(e){var t=L(e.currentTarget),o=t.data("collection_id"),i=t.data("name");PARTcloud.route("?route=collection&name="+i+"&collection_id="+o)},"click; .PartView-Viewer-Button-Embed":function(e){var t=PARTcloud.currentVarsettransfer,o=["model_id="+this.model.model_id,"table_configuration="+PARTcloudHelpers.encodeURIComponent(JSON.stringify(t))];this.model.share_key&&o.push("share_key="+this.model.share_key),PARTcloud.route("?route=embed&"+o.join("&"))},"click; .PartView-Information-Options-Edit":function(e){PARTcloud.route("?route=edit-part&model_id="+this.model.model_id)},"click; #PartView-SimilarParts-SizeDependentSearch":function(e){var t=L(e.currentTarget);!0===t.data("selected")?(t.html("&nbsp;"),t.data("selected",!1)):(t.html("&check;"),t.data("selected",!0))},"click; #PartView-SimilarParts-Update-Button":function(e){var t=this,o=t.$el.find("#PartView-SimilarParts-SizeDependentSearch").data("selected"),i=parseInt(t.$el.find("#PartView-SimilarParts-SearchResultCount").text())||8;(i<=0||34<i)&&(i=8),t.$el.find(".PartView-SimilarParts-Notification").text(0).removeClass("Notification-Active"),t.$el.find("#PartView-SimilarParts-SearchResultCount").text(i);var a=t.$el.find("#PartView-SimilarParts-Quality-Slider").slider("values")[1];t.searchSimilarParts(a,o,i),t.dataForViews.supplierPartsEnabled&&t.searchSupplierParts(a,i)},"click; #PartView-SimilarParts-Post-Button":function(e){var t=this;if(t.$el.find("#PartView-SimilarParts-Post-Button").prop("disabled",!0),0<t.similarParts.length){var o={model_id:t.model.model_id},i=3,a=1;L.each(t.similarParts,function(e,t){if(i<=e)return!1;t.license_id!==PARTcloud.licenses.private?(o["result_id_"+a]=t.model_id,o["distance_"+a]=PARTcloudHelpers.round(t.quality_distance),a+=1):i+=1}),PARTcloudApi.shareGeosearchResult(o).done(function(e){void 0!==e.status&&"success"===e.status&&(t.$el.find("#PartView-SimilarParts-Post-Button").hide(),t.$el.find("#PartView-SimilarParts-Shared").show()),t.$el.find("#PartView-SimilarParts-Post-Button").prop("disabled",!1)})}},"click; .PartView-Header-QR":function(e){var t=L("<div>",{class:"PartView-QR-Dialog-Container"}),o=L("<div>",{class:"PartView-Header-QR-Description",text:PARTcloudHelpers.translate("pcl_part_modal_qr_description")});t.append(o),t.append(L("<img>",{src:PARTcloudApi.apiUri+"?controller=Images&action=qrCode&render_front_image=true&size=6&vr=true&model_id="+this.model.model_id+(this.hasShareKey?"&share_key="+this.model.share_key:""),width:"234px",height:"234px"}));var i=L("<div>").addClass("PartView-Header-QR-Apps"),a=L("<a>",{href:PARTcloudConfig.getAppUrl("ios"),target:"_blank"}).append(L("<img>",{src:PARTcloudHelpers.prependPartcloudBaseUrl("img/appstore_small.svg")})),r=L("<a>",{href:PARTcloudConfig.getAppUrl("android"),target:"_blank"}).append(L("<img>",{src:PARTcloudHelpers.prependPartcloudBaseUrl("img/playstore_small.svg")})),n=L("<a>",{href:PARTcloudConfig.getAppUrl("windows"),target:"_blank"}).append(L("<img>",{src:PARTcloudHelpers.prependPartcloudBaseUrl("img/windowsstore_small.svg")}));i.append(a).append(r).append(n),t.append(i),new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_part_modal_qr_code"),message:L("<div>").append(t).html(),buttons:[]}).show()},"click; .PartView-Information-User-Name, .PartView-Information-User-Image":function(){PARTcloud.route("?route=index&user_id="+this.model.user.user_id)},"click; #PartView-Add-Tag":function(e){L(e.currentTarget).hide(),this.$el.find("#PartView-Add-Tag-Form").show()},"click; #PartView-Add-Tag-Cancel":function(e){L(e.currentTarget).parent().hide(),this.$el.find("#PartView-Add-Tag").show()},"click; #PartView-Add-Tag-Add":function(e){var n=this,l=n.$el.find("#PartView-Add-Tag-Input"),t=l.val();""!==(t="#"===t.charAt(0)?t.substring(1):t)&&PARTcloudApi.addModelTag(n.model.model_id,t,n.model.share_key).done(function(e){if(void 0===e.status||"error"!==e.status){var t="PartView-Tag";e.admin_tag&&(t+=" PartView-Tag-Admin");var o="";null!==e.background_color&&(o="background-color:"+e.background_color+";");var i="";null!==e.color&&(i="color:"+e.color+";");var a=L("<div />",{class:t,"data-tag_id":e.tag_id,"data-tag_name":PARTcloudHelpers.encodeURIComponentName(e.name),style:o});a.append(L("<a/>",{class:"PartView-Tag-Text",href:PARTcloudHelpers.prependPartcloudBaseUrl("?route=index&tag_id="+e.tag_id+"&tag_name="+PARTcloudHelpers.encodeURIComponentName(e.name)),text:e.name,style:i})).append(" "),a.append(L("<i/>",{class:"PartView-Tag-Remove fa fa-times pclIconColorNormal",title:PARTcloudHelpers.translate("pcl_part_delete")}));var r=n.$el.find(".PartView-Tag").last();0!==r.length?a.insertAfter(r):a.prependTo(n.$el.find("#PartView-Tags")),l.val("")}})},"click; .PartView-Tag-Remove":function(e){var t=L(e.currentTarget).parent(),o=t.data("tag_id");PARTcloudApi.removeModelTag(this.model.model_id,o,this.model.share_key).done(function(e){void 0!==e.status&&"error"===e.status||t.bRemove()})},"click; #PartView-SimilarParts-Extend":function(e){var t=L(e.currentTarget).find("i").first();t.hasClass("fa-angle-up")?t.removeClass("fa-angle-up").addClass("fa-angle-down"):(t.removeClass("fa-angle-down").addClass("fa-angle-up"),this.$el.find(".PartView-SimilarParts-Notification").removeClass("Notification-Active")),this.$el.find("#PartView-SimilarParts").slideToggle(200)}},showLoginView:function(){var e=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_login_login"),message:"<div id='PartView-Login-Dialog-Container'>",buttons:[]});e.show().done(function(){PARTcloud.showLoginView(L("#PartView-Login-Dialog-Container"),{parent:e}).done(function(){e.resize()})})},searchSimilarParts:function(e,t,o){var i=this;t=t||!1,i.model.uploaded?(i.$el.find("#PartView-SimilarParts-Update-Button").attr("disabled",!0),i.$el.find("#PartView-SimilarParts-Post-Button").hide(),i.$el.find("#PartView-SimilarParts-Shared").hide(),(!e||e<60||100<e)&&(e=PARTcloud.geosearchQuality),PARTcloud.requests[1]=PARTcloudApi.getSimilarParts(i.model.model_id,e,o,t).done(function(o){delete PARTcloud.requests[1],void 0!==i.$el&&(o.models=PARTcloudApi.sortModelsByQualityDistance(o.models,!0),0<o.count&&void 0!==PARTcloud.loginStatus.loggedin&&!0===PARTcloud.loginStatus.loggedin?(i.similarParts=o.models,i.$el.find("#PartView-SimilarParts-Post-Button").show()):(i.similarParts=[],i.$el.find("#PartView-SimilarParts-Post-Button").hide()),PARTcloud.showTileView(i.$el.find("#PartView-SimilarParts-Result"),{models:o.models,count:o.count}).done(function(){if(o.models&&0<o.models.length){var e=parseInt(i.$el.find(".PartView-SimilarParts-Notification").text())||0,t=i.$el.find(".PartView-SimilarParts-Notification");t.text(e+o.models.length),t.hasClass("Notification-Active")||t.addClass("Notification-Active")}setTimeout(function(){void 0!==i.$el&&i.$el.find("#PartView-SimilarParts-Update-Button").attr("disabled",!1)},1500)}))})):(i.$el.find("#PartView-SimilarParts-Update-Button").attr("disabled",!0),PARTcloud.showTileView(i.$el.find("#PartView-SimilarParts-Result"),{models:{},count:0}))},searchSupplierParts:function(e,t){var i=this;i.model.uploaded?((!e||e<60||100<e)&&(e=PARTcloud.geosearchQuality),t=t||8,PARTcloud.requests[0]=PARTcloudApi.getSupplierParts(i.model.model_id,e,t).done(function(e){if(delete PARTcloud.requests[0],void 0!==i.$el)if(void 0!==e.status&&"success"===e.status&&void 0!==e.data&&!1!==e.data){if(e.data.index.nodes=PARTcloudApi.sortSupplierPartsByQualityDistance(e.data.index.nodes,!0),PARTcloud.showSupplierTileView(i.$el.find("#PartView-SupplierParts-Result"),{parts:e.data.index.nodes,imagebasepath:e.data.index.imgbasepath}),!0===e.data.index.nodes_valid&&0<e.data.index.nodes.length){var t=parseInt(i.$el.find(".PartView-SimilarParts-Notification").text())||0,o=i.$el.find(".PartView-SimilarParts-Notification");o.text(t+e.data.index.nodes.length),o.hasClass("Notification-Active")||o.addClass("Notification-Active")}}else PARTcloud.showSupplierTileView(i.$el.find("#PartView-SupplierParts-Result"),{parts:{},imagebasepath:""})})):i.$el.find("#PartView-SupplierParts-Result").empty()},checkUploadStatus:function(t){var o=this;PARTcloudApi.getModelSimple(t,o.model.share_key).done(function(e){!1===e.uploaded&&""===e.error_message?setTimeout(function(){o.checkUploadStatus(t)},1e3):!1===e.uploaded&&""!==e.error_message?PARTcloud.route(document.location.pathname+document.location.search+document.location.hash):e.uploaded&&PARTcloud.route(document.location.pathname+document.location.search+document.location.hash)})},showCommentView:function(e,t){if(e=e||1,void 0!==t){var o=PARTcloudHelpers.translate("pcl_part_comments")+" ("+t+")";this.$el.find(".PartView-Tabs [data-tab_id=PartView-Comments]").text(o)}PARTcloud.showCommentView(this.$el.find("#PartView-Comments"),this.model.model_id,10,e,this,t)},updateUrlVarset:function(e){var t=window.location.href,o=/[&?]varsettransfer=([^&]*)/i.exec(t);o?t=t.replace(o[0],"&varsettransfer="+encodeURIComponent(e)):t+="&varsettransfer="+encodeURIComponent(e),PARTcloud.replaceState(t)}})}(jQuery),function(_){"use strict";brite.registerView("PreviewView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;return o.dataForViews=e,o.model=e.model,o.canEditPart=e.canEditPart,o.embeddedConfig=e.embeddedConfig||void 0,o.viewerPromise=e.viewerPromise||_.Deferred(),o.viewerView=void 0,o.selectedCarouselImage=1,PARTcloud.renderTemplate("tpl-PreviewView",e)},init:function(e,t){},postDisplay:function(e,t){var o=this;if(o.model.uploaded){if(o.slider=o.$el.find("#PreviewView-Viewer-Image-Slider").slidesjs({width:800,height:450,start:1,zIndex:5,navigation:{active:!1,effect:"slide"},pagination:{active:!1,effect:"slide"},callback:{complete:function(e){o.activatePreviewImage(e);var t=o.$el.find(".PreviewView-Viewer-Image-Hover");t.empty(),t.append(_("<img>",{src:PARTcloudHelpers.prependCommunityBaseUrl(o.model.images[e-1].user.image)})),t.append(_("<span>",{text:PARTcloudHelpers.translate("pcl_preview_uploaded_by")+": "}).append(_("<span>",{class:"PreviewView-Viewer-Image-Hover-User",text:o.model.images[e-1].user.username,"data-user_id":o.model.images[e-1].user.user_id}).click(function(e){var t=_(e.currentTarget).data("user_id");PARTcloud.route("?route=index&user_id="+t)})))}}}).data("plugin_slidesjs"),o.activatePreviewImage(1),o.model.uploaded&&""===o.model.error_message){PARTcloud.showViewerView(o.$el.find("#PreviewView-Viewer"),_.extend({viewerPromise:o.viewerPromise},o.dataForViews)).done(function(e){o.viewerView=e}),void 0!==o.embeddedConfig&&o.embeddedConfig.noAutoload||o.viewerPromise.done(function(){o.activate3DPreview()});var i=document.location.protocol+"//"+document.location.host+PARTcloud.partcloudBasePath+"/23d-libs/"+o.model.model_path+"-160x90.gif";o.$el.find("#PreviewView-Button-Enable-3D").first().attr("src",i)}_(window).bind("resize.pclViewer",function(){return o.updateViewerScale()})}},destroy:function(e,t){_(window).unbind("resize.pclViewer")},events:{"click; #PreviewView-Button-Enable-3D, .PreviewView-Button-Enable-2D":function(e){var t=_(e.currentTarget);if("3D"===t.data("enable"))this.activate3DPreview();else{var o=parseInt(t.data("number"))+1;this.activatePreviewImage(o)}},"click; .PreviewView-Viewer-Image-Hover-User":function(e){var t=_(e.currentTarget).data("user_id");PARTcloud.route("?route=index&user_id="+t)},"click; .slidesjs-container":function(e){var t=this.slider.data.current,o=this.model.images,i=new psol.components.MessageDialog({title:this.model.name,message:"<div id='PartView-ImageView-Dialog-Container'>",buttons:[],customID:"ImageView-Dialog",sizeToContent:!1});i.show().done(function(){PARTcloud.showImageView(_("div#PartView-ImageView-Dialog-Container"),{parent:i,images:o,currentIndex:t}).done(function(){i.resize()})})},"click; #PreviewView-Image-SetAsPreview":function(e){var t=this,o=t.slider.data.current,i=t.model.images[o].image_id;PARTcloudApi.setPreviewImage(t.model.model_id,i).done(function(e){PARTcloud.route("?route=part&name="+PARTcloudHelpers.encodeURIComponentName(t.model.name)+"&model_id="+t.model.model_id)})}},addPreviewImage:function(e){this.model.images.push(e);var t=this.slider.add(_("<img>",{src:PARTcloudHelpers.prependPartcloudBaseUrl(e.image_path_normal),itemprop:"image"}));this.$el.find("#PreviewView-Viewer-ImagesContainer").append(_("<img>",{class:"PreviewView-Button-Enable-2D","data-enable":"2D","data-number":t,src:PARTcloudHelpers.prependPartcloudBaseUrl(e.image_path_small)}))},activate3DPreview:function(){var e=this;PARTcloud.isViewerInitialized||e.viewerView.loadWebViewer3D(),e.$el.find(".PreviewView-Button-Enable-2D").removeClass("activePreviewImage"),e.$el.find("#PreviewView-Button-Enable-3D").addClass("activePreviewImage"),e.$el.find(".PreviewView-Viewer-Image-Buttons").hide(),e.$el.find("#PreviewView-Viewer-Image").hide(),e.$el.find("#PreviewView-Viewer").show(),e.updateViewerScale()},activatePreviewImage:function(e){var t=this,o=t.$el.find("#PreviewView-Viewer-Image"),i=t.$el.find(".PreviewView-Viewer-Image-Buttons");if(t.$el.find("#PreviewView-Viewer").hide(),o.show({duration:0,complete:function(){i.show(),t.slider.goto(e)}}),t.$el.find("#PreviewView-Button-Enable-3D").removeClass("activePreviewImage"),t.$el.find(".PreviewView-Button-Enable-2D").removeClass("activePreviewImage").filter(function(){return _(this).data("number")===e-1}).addClass("activePreviewImage"),t.selectedCarouselImage!==e){t.selectedCarouselImage=e;var a=t.$el.find("#PreviewView-Viewer-ImagesContainer"),r=a.outerWidth(!0),n=a.find("img:not(.activePreviewImage)").first(),l=n.width(),d=n.outerWidth(!1),s=n.outerWidth(!0),c=(s-d)/2,u=r/2-(1.1*l/2+(d-l)/2),p=s*(t.slider.data.total-1),m=s*(e-1),g=0;p+s<=r?g=0:p-m<=u?g=-(p-r+d+4):0<u-m?g=0:u-m<0&&(g=-(m-u-c)),a.stop(!0,!1).animate({left:g},{duration:250,queue:!0})}var h=t.slider.data.current,f=PARTcloud.loginStatus,w=t.model.images[h].image_id,v=!0===new RegExp("^preview","i").test(t.model.images[h].image_path),P=f&&!0===f.loggedin&&f.user_id===t.model.images[h].user_id,T=w===t.model.front_image_id;t.canEditPart&&!T?t.$el.find("#PreviewView-Image-SetAsPreview").show():t.$el.find("#PreviewView-Image-SetAsPreview").hide(),!t.canEditPart&&!P||v?t.$el.find("#PreviewView-Image-Delete").hide():t.$el.find("#PreviewView-Image-Delete").show(),t.slider.rescale()},updateViewerScale:function(){var e=this.$el.find("#PreviewView-Viewer"),t=this.$el.width(),o=9*t/16;e.css({width:t,height:o})}})}(jQuery),function(p){"use strict";brite.registerView("PrivateShareView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.canSharePart=e.canSharePart,this.isB2BIntegrated=PARTcloudConfig.isFeatureEnabled("b2bIntegration"),this.model=e.model,PARTcloud.renderTemplate("tpl-PrivateShareView",e)},init:function(e,t){},postDisplay:function(e,t){var s=this;e.isSharablePart&&PARTcloudApi.getShares(s.model.model_id).done(function(t){PARTcloudApi.getSharesWithGroup(s.model.model_id).done(function(e){s.$el.find("#PrivateShareView-Loading").remove(),0!==t.length||0!==e.length?(0<t.length&&p.each(t,function(e,t){t.user.type="user",s.addSharedPerson(t.user)}),0<e.length&&p.each(e,function(e,t){t.group.type="group",s.addSharedPerson(t.group)})):s.checkIfSharedWithAnyone()})});var c=s.$el.find("#PrivateShareView-Search-Result-List"),u=s.$el.find("#PrivateShareView-Search");u.autocomplete({minLength:0,delay:200,autoFocus:!1,source:function(e,i){var a=p.trim(e.term);0===a.length?(i([{noone:!0}]),c.empty()):PARTcloudHelpers.validateEmail(a)?PARTcloudApi.getUsersForSharingByEmail(a,s.model.model_id).done(function(o){PARTcloudApi.getGroupsForSharingByEmail(a,s.model.model_id).done(function(e){var t=[];void 0===o.user_id||0!==e.length?(void 0!==o.user_id&&("object"==typeof o&&(o.type="user"),t.push(o)),e.forEach(function(e){"object"==typeof e&&(e.type="group")}),i(t.concat(e))):i([{noone:!0}])})}):PARTcloudApi.getUsersForSharingByName(a,s.model.model_id).done(function(t){PARTcloudApi.getGroupsForSharingByName(a,s.model.model_id).done(function(e){0!==t.length||0!==e.length?(t.forEach(function(e){"object"==typeof e&&(e.type="user")}),e.forEach(function(e){"object"==typeof e&&(e.type="group")}),i(t.concat(e))):i([{noone:!0}])})})},search:function(e,t){c.empty()}}),u.data("ui-autocomplete")._renderItem=function(e,t){var o=p("<li>");if(void 0===t.noone){if("group"===t.type){var i=p("<img>",{src:PARTcloudHelpers.prependCommunityBaseUrl("application/modules/User/externals/images/nophoto_user_thumb_icon.png")}),a=p("<a>",{text:t.displayname,target:"_blank"}),r=p("<i>",{class:"fa fa-share-alt-square pclIconColorNormal",title:PARTcloudHelpers.translate("pcl_privateshare_share")});r.on("click",function(){PARTcloudApi.shareModelWithGroup(s.model.model_id,t.group_id).done(function(e){s.addSharedPerson(t)}),u.focus()}),o.data("group_id",t.group_id),o.append(i).append(a).append(r)}else if("user"===t.type){var n,l=p("<img>",{src:PARTcloudHelpers.prependCommunityBaseUrl(t.image)});n=s.isB2BIntegrated?p("<a>",{href:PARTcloudHelpers.prependCommunityBaseUrl(t.profile_url),text:t.username,target:"_blank"}):p("<a>",{text:t.username,target:"_blank"});var d=p("<i>",{class:"fa fa-share-alt-square pclIconColorNormal",title:PARTcloudHelpers.translate("pcl_privateshare_share")});d.on("click",function(){PARTcloudApi.shareModel(s.model.model_id,t.user_id).done(function(e){s.addSharedPerson(t)}),u.focus()}),o.data("user_id",t.user_id),o.append(l).append(n).append(d)}}else o.text(PARTcloudHelpers.translate("pcl_privateshare_noone_found"));return o.appendTo(c)},u.data("ui-autocomplete")._renderMenu=function(o,e){var i=this;p.each(e,function(e,t){i._renderItemData(o,t)}),p(o).addClass("PrivateShareView-Search-Hide-Autocomplete")},u.focus(function(){p(this).val(""),c.empty()})},destroy:function(){},events:{},addSharedPerson:function(o){var i=this,e=i.$el.find("#PrivateShareView-SharedWithPersonsList");if("group"===o.type){var t=p("<li>",{data:{user_id:o.user_id}}),a=p("<img>",{src:PARTcloudHelpers.prependCommunityBaseUrl("application/modules/User/externals/images/nophoto_user_thumb_icon.png")}),r=p("<a>",{text:o.displayname,target:"_blank"});if(t.append(a).append(r),i.canSharePart){var n=p("<i>",{class:"fa fa-share-alt-square pclIconColorNormal",title:PARTcloudHelpers.translate("pcl_privateshare_revoke_share")});n.on("click",function(e){var t=p(e.currentTarget);PARTcloudApi.unshareModelWithGroup(i.model.model_id,o.group_id).done(function(e){t.parent().remove(),i.checkIfSharedWithAnyone()})}),t.append(n)}e.append(t)}else if("user"===o.type){var l,d=p("<li>",{data:{user_id:o.user_id}}),s=p("<img>",{src:PARTcloudHelpers.prependCommunityBaseUrl(o.image)});if(l=i.isB2BIntegrated?p("<a>",{href:PARTcloudHelpers.prependCommunityBaseUrl(o.profile_url),text:o.username,target:"_blank"}):p("<a>",{text:o.username,target:"_blank"}),d.append(s).append(l),i.canSharePart){var c=p("<i>",{class:"fa fa-share-alt-square pclIconColorNormal",title:PARTcloudHelpers.translate("pcl_privateshare_revoke_share")});c.on("click",function(e){var t=p(e.currentTarget);PARTcloudApi.unshareModel(i.model.model_id,o.user_id).done(function(e){t.parent().remove(),i.checkIfSharedWithAnyone()})}),d.append(c)}e.append(d)}i.checkIfSharedWithAnyone()},checkIfSharedWithAnyone:function(){var e=this.$el.find("#PrivateShareView-SharedWithPersonsList");0<e.find("li").not(".notSharedWithAnyOne").length?e.find(".notSharedWithAnyOne").remove():e.append(p("<li>",{class:"notSharedWithAnyOne",text:PARTcloudHelpers.translate("pcl_privateshare_noone")}))}})}(jQuery),function(s){"use strict";brite.registerView("SearchView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e){return this.stlViewerView={},this.viewerInitialized=!1,PARTcloud.renderTemplate("tpl-SearchView",{data:e})},init:function(e,t){},postDisplay:function(l,e){var d=this,t=(d.data=l).params.page,o=l.params.query;(o.length||l.params.tag_id)&&PARTcloudApi.searchModels(d.data.params.tag_id,o,PARTcloud.modelsPerSearchPage,(t-1)*PARTcloud.modelsPerSearchPage).done(function(e){if(d.data.maxTagsExceeded=void 0!==d.data.params.tag_id&&20<d.data.params.tag_id.split(",").length,void 0!==e.tag&&null!==e.tag&&void 0!==e.tag.reduce&&(d.data.tags=e.tag.reduce(function(e,t){return null!==t&&""!==t.tag_id&&null!==t.tag_id&&void 0!==t.tag_id&&""!==t.translation&&null!==t.translation&&void 0!==t.translation&&e.push(t),e},[])),void 0!==d.data.tags&&"function"==typeof d.data.tags.forEach){var a=d.$el.find("#SearchView-Tags-Container");a.find(".SearchView-Tag").remove(),d.data.tags.forEach(function(e){var t=s("<div>").addClass("SearchView-Tag"+(e.admin_tag?" SearchView-Tag-Admin":"")).attr("data-tag_id",e.tag_id).attr("data-tag_name",encodeURIComponent(e.translation)).attr("data-tag_name_raw",e.translation);"string"==typeof e.background_color&&t.css("background-color",e.background_color);var o=s("<a>").addClass("SearchView-Tag-Text"+(e.has_description?" pcl-icon-information":"")).attr("href",PARTcloudHelpers.prependPartcloudBaseDocument("?route=search&tag_id="+e.tag_id+"&tag_name="+encodeURIComponent(e.translation))).text(e.translation);"string"==typeof e.color&&o.css("color",e.color);var i=s("<i>").addClass("SearchView-Tag-Remove fa fa-times pclIconColorNormal").attr("title",PARTcloudHelpers.translate("pcl_remove_tag_filter"));t.append(o).append(i).insertBefore(a.find("#SearchView-Add-Tag"))})}PARTcloud.showTileView(d.$el.find("#SearchView-Results"),{models:e.models,count:e.count,params:{page:t,query:o},route:"search"})});d.cube=new CNSAPPKit.CubeSketcher.CubeSketcher(d.$el.find(".SearchView-Sketchsearch-Cube"),{thickness:10}),d.highlightTool(d.$el.find("#SearchView-Sketchsearch-Button-Brush")),setTimeout(function(){d.updateSketchSearchScale()},100),jQuery.ui.slider.prototype.widgetEventPrefix="slider";var i=d.$el.find("#SearchView-Sketchsearch-Quality-Slider"),a=d.$el.find("#SearchView-Sketchsearch-Quality-Value");i.slider({values:[1,PARTcloud.geosearchQuality],orientation:"horizontal",range:!0,min:1,max:100,animate:!0,slide:function(e,t){if(1<t.values[0]||t.values[1]<60)return!1;a.html(t.values[1]+"%")}}),a.html(i.slider("values")[1]+"%"),s(window).bind("resize.pclSketchSearch",function(){return d.updateSketchSearchScale()}),d.$el.find("#SearchView-Add-Tag-Input").autocomplete({minLength:1,delay:200,source:function(e,t){e.term=1<e.term.length&&"#"===e.term.charAt(0)?e.term.substring(1):e.term,PARTcloudApi.getTagsLike(e.term,!0,!0).done(function(e){var o=[];s.each(e,function(e,t){t.label=t.name,o.push(t)}),t(o)})},create:function(){s(this).data("ui-autocomplete")._renderItem=function(e,t){var o=s("<li>");o.on("click",function(e){if(void 0!==d.data.params.tag_id){if(!(d.data.params.tag_id.indexOf(t.tag_id.toString())<0&&!1===l.maxTagsExceeded))return d.$el.find("#SearchView-Add-Tag-Form").hide(),d.$el.find("#SearchView-AddTag-Button").show(),void e.preventDefault();d.data.params.tag_id+=","+t.tag_id}else d.data.params.tag_id=t.tag_id;void 0!==d.data.params.tag_name?d.data.params.tag_name+=","+t.name:d.data.params.tag_name=t.name,d.startSearch()});var i=s("<span>").addClass("icon pclIconFixedWidth pclIconFixedWidth"),a=s("<span>").addClass("icon pclIconFixedWidth pclIconFixedWidth"),r=s('<span class="SearchView-Tags-NoWrap">').append(i).append("&nbsp;&nbsp;"+t.name),n=s("<div>").addClass("ui-menu-item-wrapper").append(r);return 1===t.admin_tag&&(n.addClass("ui-admin-menu-item"),a.addClass("pcl-icon-tags"),r.append("&nbsp;").append(a)),!0===t.has_description&&i.addClass("pcl-icon-information"),null!==t.background_color&&n.css("background-color",t.background_color),null!==t.color&&n.css("color",t.color),o.append(n).appendTo(e),o}}})},destroy:function(){s(window).unbind("resize.pclSketchSearch")},events:{"click; #SearchView-Sketchsearch-Query-Button":function(e){var i=this;e.preventDefault(),i.$el.find("#SearchView-Sketchsearch-Query-Button").attr("disabled","disabled"),i.$el.find("#SearchView-Sketchsearch-Query-Button").hide();var t=i.$el.find("#SearchView-Sketchsearch-Quality-Slider").slider("values")[1];(!t||t<60||100<t)&&(t=PARTcloud.geosearchQuality);var o=i.cube.getImageDataUrls();i.$el.find(".SearchView-Sketchsearch-Front").css("background-image","url("+o.front+")"),i.$el.find(".SearchView-Sketchsearch-Top").css("background-image","url("+o.top+")"),i.$el.find(".SearchView-Sketchsearch-Side").css("background-image","url("+o.side+")");var a=o.front.replace("data:image/png;base64,",""),r=o.top.replace("data:image/png;base64,",""),n=o.side.replace("data:image/png;base64,","");i.$el.find("#SearchView-Results").bEmpty(),i.$el.find("#SearchView-Sketchsearch-Loading").show(),PARTcloudApi.geosearchSketch(a,r,n,t,PARTcloud.modelsPerSearchPage).done(function(e){e.models=PARTcloudApi.sortModelsByQualityDistance(e.models,!0),PARTcloud.showTileView(i.$el.find("#SearchView-Results"),{models:e.models,count:e.count}).always(function(){i.$el.find("#SearchView-Sketchsearch-Loading").hide()}),i.$el.find("#SearchView-Sketchsearch-Query-Button").removeAttr("disabled"),i.$el.find("#SearchView-Sketchsearch-Query-Button").show()}).fail(function(e,t,o){i.$el.find("#SearchView-Loading").hide(),i.$el.find("#SearchView-Sketchsearch-Query-Button").removeAttr("disabled"),i.$el.find("#SearchView-Sketchsearch-Query-Button").show()})},"click; #SearchView-Sketchsearch-Button-Color":function(e){e.preventDefault();var t=s(e.currentTarget);"black"===t.data("color")?(t.data("color","white"),this.cube.changeColor(CNSAPPKit.CubeSketcher.COLORTYPE.WHITE),t.children("img").attr("src",PARTcloudHelpers.prependPartcloudBaseUrl("/img/sketchsearch/color_white_24.png"))):(t.data("color","black"),this.cube.changeColor(CNSAPPKit.CubeSketcher.COLORTYPE.BLACK),t.children("img").attr("src",PARTcloudHelpers.prependPartcloudBaseUrl("/img/sketchsearch/color_black_24.png")))},"click; #SearchView-Sketchsearch-Button-Bucket":function(e){e.preventDefault(),this.highlightTool(s(e.currentTarget)),this.cube.changeTool(CNSAPPKit.CubeSketcher.TOOLTYPE.FILL)},"change; #SearchView-Sketchsearch-Select-Line-Thickness":function(e){var t=s(e.currentTarget);this.cube.changeThickness(t.val())},"click; #SearchView-Sketchsearch-Button-Brush":function(e){e.preventDefault(),this.highlightTool(s(e.currentTarget)),this.cube.changeTool(CNSAPPKit.CubeSketcher.TOOLTYPE.BRUSH)},"click; #SearchView-Sketchsearch-Button-Ellipse":function(e){e.preventDefault(),this.highlightTool(s(e.currentTarget)),this.cube.changeTool(CNSAPPKit.CubeSketcher.TOOLTYPE.CIRCLE_FILL)},"click; #SearchView-Sketchsearch-Button-Ellipse-Line":function(e){e.preventDefault(),this.highlightTool(s(e.currentTarget)),this.cube.changeTool(CNSAPPKit.CubeSketcher.TOOLTYPE.CIRCLE_LINE)},"click; #SearchView-Sketchsearch-Button-Rectangle":function(e){e.preventDefault(),this.highlightTool(s(e.currentTarget)),this.cube.changeTool(CNSAPPKit.CubeSketcher.TOOLTYPE.RECT_FILL)},"click; #SearchView-Sketchsearch-Button-Rectangle-Line":function(e){e.preventDefault(),this.highlightTool(s(e.currentTarget)),this.cube.changeTool(CNSAPPKit.CubeSketcher.TOOLTYPE.RECT_LINE)},"click; #SearchView-Sketchsearch-Button-Clear":function(e){e.preventDefault(),this.cube.clearFace()},"change; #SearchView-GeosearchFile":function(e){var t=this,o=e.currentTarget.files[0];o?(t.viewerInitialized?t.stlViewerView.loadPreview(o):(PARTcloud.showStlViewerView(t.$el.find("#SearchView-Geosearch-Viewer"),{file:o}).done(function(e){t.stlViewerView=e}),t.viewerInitialized=!0),t.$el.find("#SearchView-Geosearch-Viewer").show()):t.$el.find("#SearchView-Geosearch-Viewer").hide()},"click; #SearchView-Geosearch-Query-Button":function(e){var i=this;e.preventDefault();var t=i.$el.find("#SearchView-GeosearchFile")[0];0<t.files.length&&(i.$el.find("#SearchView-Geosearch-Query-Button").attr("disabled","disabled"),i.$el.find("#SearchView-Geosearch-Query-Button").hide(),i.showProgressbar(),i.$el.find("#SearchView-Results").bEmpty(),i.$el.find("#SearchView-Geosearch-Loading").show(),PARTcloudApi.geosearchFile(t,PARTcloud.modelsPerSearchPage,i.resizeProgressbar,i.hideProgressbar).done(function(e){e.models=PARTcloudApi.sortModelsByQualityDistance(e.models,!0),PARTcloud.showTileView(i.$el.find("#SearchView-Results"),{models:e.models,count:e.count}).always(function(){i.$el.find("#SearchView-Geosearch-Loading").hide()}),i.$el.find("#SearchView-Geosearch-Query-Button").removeAttr("disabled"),i.$el.find("#SearchView-Geosearch-Query-Button").show()}).fail(function(e,t,o){i.$el.find("#SearchView-Loading").hide(),i.$el.find("#SearchView-Geosearch-Query-Button").removeAttr("disabled"),i.$el.find("#SearchView-Geosearch-Query-Button").show()}))},"click; #SearchView-Search-Query-Button":function(e){e.preventDefault(),this.startSearch()},"keyup; #SearchView-Search-Query":function(e){e.preventDefault(),13===event.keyCode&&this.startSearch()},"click; #SearchView-AddTag-Button":function(e){s(e.currentTarget).hide(),this.$el.find("#SearchView-Add-Tag-Input").val(""),this.$el.find("#SearchView-Add-Tag-Form").show(),this.$el.find("#SearchView-Add-Tag-Input").focus()},"click; .SearchView-Tag-Remove":function(e){var t=this,o=s(e.currentTarget).parent(),i=o.data("tag_id"),a=o.data("tag_name_raw");if(void 0!==t.data.params.tag_id){var r=t.data.params.tag_id.split(",");r.forEach(function(e,t,o){0!==e.length&&null!=e&&e!==i&&e!==i.toString()||o.splice(t,1)}),t.data.params.tag_id=r.join(",")}if(void 0!==t.data.params.tag_name){var n=t.data.params.tag_name.split(",");n.forEach(function(e,t,o){0!==e.length&&null!=e&&e!==a||o.splice(t,1)}),t.data.params.tag_name=n.join(",")}t.startSearch()}},showProgressbar:function(){this.$el.find("#SearchView-Geosearch-Progressbar").show()},resizeProgressbar:function(e){s("#SearchView-Geosearch-Progressbar").progressbar({value:e.loaded/e.total*100})},hideProgressbar:function(){s("#SearchView-Geosearch-Progressbar").hide()},startSearch:function(){var e=this.$el.find("#SearchView-Search-Query").first().val(),t="?route=search&"+s.param(s.extend({},this.data.params,{query:e}));PARTcloud.route(t)},highlightTool:function(e){this.$el.find("#SearchView-Sketchsearch-Buttons > button").css("box-shadow","none"),e.css("box-shadow","0px 0px 2px 2px #326283")},updateSketchSearchScale:function(){var e=this.$el.find(".SearchView-Sketchsearch-Cube"),t=e.width();e.css({height:t}),this.cube.resizeSketchSearch()}})}(jQuery),function(l){"use strict";brite.registerView("SocialShareView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.model=e.model,PARTcloud.renderTemplate("tpl-SocialShareView",e)},init:function(e,t){},postDisplay:function(e,t){},destroy:function(){},events:{"click; .SocialShareView-List li":function(e){var t=l(e.currentTarget).data("share_to"),o=window.location.href,i=PARTcloudHelpers.prependPartcloudBaseUrl(this.model.preview.image_path_normal),a=PARTcloud.getPageTitle()+" - "+this.model.name,r=Handlebars.SafeString(this.model.description),n="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";switch(t){case"facebook":window.open("//www.facebook.com/sharer/sharer.php?p[url]="+encodeURIComponent(o)+"&p[images][0]="+encodeURIComponent(i)+"&p[title]="+encodeURIComponent(a)+"&p[summary]="+encodeURIComponent(r),"Facebook",n);break;case"twitter":window.open("https://twitter.com/intent/tweet?original_referer="+encodeURIComponent(o)+"&text="+encodeURIComponent(a)+"%20"+encodeURIComponent(o)+"%20"+encodeURIComponent("#PARTcloud"),"Twitter",n);break;case"pinterest":window.open("//pinterest.com/pin/create/button/?url="+encodeURIComponent(o)+"&media="+encodeURIComponent(i)+"&description="+encodeURIComponent(a),"Pinterest",n);break;case"googleplus":window.open("//plus.google.com/share?url="+encodeURIComponent(o),"GooglePlus",n);break;case"linkedin":window.open("//www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(o)+"&title="+encodeURIComponent(a)+"&source="+encodeURIComponent(o),"LinkedIn",n)}}}})}(jQuery),function(s){"use strict";brite.registerView("SortView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return e.manufacturingViewEnabled=PARTcloudConfig.isFeatureEnabled("manufacturingView"),e.maxTagsExceeded=void 0!==e.params.tag_id&&20<e.params.tag_id.split(",").length,void 0!==e.tags&&null!==e.tags&&void 0!==e.tags.reduce&&(e.tags=e.tags.reduce(function(e,t){return null!==t&&""!==t.tag_id&&null!==t.tag_id&&void 0!==t.tag_id&&""!==t.translation&&null!==t.translation&&void 0!==t.translation&&e.push(t),e},[])),PARTcloud.renderTemplate("tpl-SortView",e)},init:function(e,t){this.data=e;var o=PARTcloudHelpers.getParameter("order",void 0);o&&this.$el.find(".SortView-Select-Order option[value='"+o+"']").first().attr("selected","selected"),"true"===PARTcloudHelpers.getParameter("printable",void 0)&&this.$el.find(".SortView-Printable-Checkbox").attr("checked","checked");var i=PARTcloudHelpers.getParameter("search",void 0);i&&this.$el.find(".SortView-Search-Input").val(i)},postDisplay:function(l,e){var d=this,t=parseInt(PARTcloudHelpers.getParameter("category",void 0),10),o=d.$el.find(".SortView-Category-Container");new PARTcloudCategory(o,t).setChangeHandler(d.categoryChange,d),d.$el.find("#SortView-Add-Tag-Input").autocomplete({minLength:1,delay:200,source:function(e,t){e.term=1<e.term.length&&"#"===e.term.charAt(0)?e.term.substring(1):e.term,PARTcloudApi.getTagsLike(e.term,!0,!0).done(function(e){var o=[];s.each(e,function(e,t){t.label=t.name,o.push(t)}),t(o)})},create:function(){s(this).data("ui-autocomplete")._renderItem=function(e,i){var t=s("<li>");t.on("click",function(e){if(void 0!==d.data.params.tag_id){if(!(d.data.params.tag_id.indexOf(i.tag_id.toString())<0&&!1===l.maxTagsExceeded))return d.$el.find("#SortView-Add-Tag-Form").hide(),d.$el.find("#SortView-AddTag-Button").show(),void e.preventDefault();d.data.params.tag_id+=","+i.tag_id}else d.data.params.tag_id=i.tag_id;void 0!==d.data.params.tag_name?d.data.params.tag_name+=","+i.name:d.data.params.tag_name=i.name;var t=d.$el.find(".SortView-Select-Order").val(),o=d.$el.find(".SortView-Search-Input").val();d.search(o,t)});var o=s("<span>").addClass("icon pclIconFixedWidth pclIconFixedWidth"),a=s("<span>").addClass("icon pclIconFixedWidth pclIconFixedWidth"),r=s('<span class="SortView-Tags-NoWrap">').append(o).append("&nbsp;&nbsp;"+i.name),n=s("<div>").addClass("ui-menu-item-wrapper").append(r);return 1===i.admin_tag&&(n.addClass("ui-admin-menu-item"),a.addClass("pcl-icon-tags"),r.append("&nbsp;").append(a)),!0===i.has_description&&o.addClass("pcl-icon-information"),null!==i.background_color&&n.css("background-color",i.background_color),null!==i.color&&n.css("color",i.color),t.append(n).appendTo(e),t}}})},destroy:function(){},events:{"keypress; .SortView-Search-Input":function(e){if(13===e.keyCode){var t=s(e.currentTarget).val(),o=this.$el.find(".SortView-Select-Order").val();this.search(t,o)}},"click; .SortView-Search-Button":function(e){var t=s(e.currentTarget).closest(".SortView-Search-Container").find(".SortView-Search-Input").val(),o=this.$el.find(".SortView-Select-Order").val();this.search(t,o)},"change; .SortView-Select-Order":function(e){var t=this.$el.find(".SortView-Search-Input").val(),o=s(e.currentTarget).val();this.search(t,o)},"change; .SortView-Printable-Checkbox":function(e){var t=s(e.currentTarget).prop("checked"),o="?route="+this.data.route+"&"+s.param(s.extend({},this.data.params,{printable:t,page:1}));PARTcloud.route(o)},"click; #SortView-AddTag-Button":function(e){s(e.currentTarget).hide(),this.$el.find("#SortView-Add-Tag-Input").val(""),this.$el.find("#SortView-Add-Tag-Form").show(),this.$el.find("#SortView-Add-Tag-Input").focus()},"click; .SortView-Tag-Remove":function(e){var t=this,o=s(e.currentTarget).parent(),i=o.data("tag_id"),a=o.data("tag_name_raw");if(void 0!==t.data.params.tag_id){var r=t.data.params.tag_id.split(",");r.forEach(function(e,t,o){0!==e.length&&null!=e&&e!==i&&e!==i.toString()||o.splice(t,1)}),t.data.params.tag_id=r.join(",")}if(void 0!==t.data.params.tag_name){var n=t.data.params.tag_name.split(",");n.forEach(function(e,t,o){0!==e.length&&null!=e&&e!==a||o.splice(t,1)}),t.data.params.tag_name=n.join(",")}var l=t.$el.find(".SortView-Select-Order").val(),d=t.$el.find(".SortView-Search-Input").val();t.search(d,l)}},categoryChange:function(e){var t=this;t.data.params.page=1,"boolean"==typeof e&&!1===e?void 0!==t.data.params.category&&delete t.data.params.category:t.data.params.category=e;var o="?route="+t.data.route+"&"+s.param(t.data.params);PARTcloud.route(o)},search:function(e,t){var o="?route="+this.data.route+"&"+s.param(s.extend({},this.data.params,{search:e,page:1,order:t}));PARTcloud.route(o)}})}(jQuery),function(a){"use strict";brite.registerView("StlViewerView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.viewerPromise=e.viewerPromise||a.Deferred(),this.favoriteActions=[],this.radialMenuActions=[],PARTcloud.renderTemplate("tpl-StlViewerView",e)},init:function(e,t){},postDisplay:function(e,t){this.loadPartWebViewer(e.file)},destroy:function(e,t){},events:{},loadPartWebViewer:function(e){var t=this,o=t.viewerPromise;if(PARTcloud.isWebGLSupported()){if(PARTcloud.isStlViewerInitialized)a("#StlViewerView-Viewer-Container").empty(),a("#MainView-StlWebGlContainer").children().detach().appendTo("#StlViewerView-Viewer-Container");else{var i={$container:a("#StlViewerView-Viewer-Container"),viewerBackendType:psol.components.WebViewer3D.ViewerBackends.WebGL,devicePixelRatio:window.devicePixelRatio,radialMenuActions:t.radialMenuActions,favoriteActions:t.favoriteActions,webglViewerSettings:{ColorTL:PARTcloud.viewerColorTop,ColorTR:PARTcloud.viewerColorTop,ColorBL:PARTcloud.viewerColorBottom,ColorBR:PARTcloud.viewerColorBottom,enableSilhuette:!0,material:{preset:"pcloud"}}};PARTcloud.stlViewer=new psol.components.WebViewer3D(i)}PARTcloud.stlViewer.onProgressBegin=function(e){t.$el.find(".StlViewerView-Loading").show()},PARTcloud.stlViewer.onProgressEnd=function(e){t.$el.find(".StlViewerView-Loading").hide()},PARTcloud.stlViewer.show().done(function(){t.loadPreview(e).done(function(){o.resolve()}),PARTcloud.isStlViewerInitialized=!0})}else o.reject();return o.promise()},loadPreview:function(e){var t=a.Deferred();return PARTcloud.stlViewer.loadByGeomFile(e,{clearBeforeLoad:!0,defaultView:!0}).done(function(){t.resolve()}),t.promise()}})}(jQuery),function(o){"use strict";brite.registerView("SupplierTileView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e){return PARTcloud.renderTemplate("tpl-SupplierTileView",e)},init:function(e,t){},postDisplay:function(e,t){this.$el.find(".SupplierTileView-Part-Name, .SupplierTileView-Part-Body").click(function(e){var t=o(this).closest(".SupplierTileView-Part").find(".SupplierTileView-Part-Name").attr("href");return window.open(t,"_blank"),e.preventDefault()})},destroy:function(){},events:{}})}(jQuery),function(c){"use strict";brite.registerView("TileView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var i=this;return e.models&&0<e.models.length&&e.models.forEach(function(t){if(t.view_count=i.abbreviateNumber(t.view_count),t.comment_count=i.abbreviateNumber(t.comment_count),t.download_count=i.abbreviateNumber(t.download_count),t.like_count=i.abbreviateNumber(t.like_count),void 0!==t.admin_tags){t.admin_tags=PARTcloudHelpers.groupByProperty(t.admin_tags,"background_color");var o=[];Object.keys(t.admin_tags).forEach(function(e){o.push({background_color:e,names:Object.keys(PARTcloudHelpers.groupByProperty(t.admin_tags[e],"name"))})}),t.admin_tags=o,8<t.admin_tags.length&&(t.admin_tags=t.admin_tags.slice(0,8))}}),void 0!==e.tags&&null!==e.tags&&void 0!==e.tags.reduce&&(e.tags=e.tags.reduce(function(e,t){return null!==t&&""!==t.description&&null!==t.description&&void 0!==t.description&&e.length<3&&e.push(t),e},[])),PARTcloud.renderTemplate("tpl-TileView",e)},init:function(e,t){},postDisplay:function(o,e){var t=this;if(o.hasOwnProperty("tag")&&(t.tag=o.tag),o.route){var i="?route="+o.route+"&",a=c.extend({},o.params);a.page&&delete a.page;var r,n=0;for(r in a)a.hasOwnProperty(r)&&n++;var l="?route="+o.route+"&"+c.param(a);l+=0<n?"&":"",l+="page=";var d=t.$el.find(".TileView-Models-Container").outerWidth(!1),s={items:o.count,itemsOnPage:PARTcloud.modelsPerPage,prevText:"« "+PARTcloudHelpers.translate("pcl_tile_pagination_previous"),nextText:PARTcloudHelpers.translate("pcl_tile_pagination_next")+" »",cssStyle:"pcl-theme",hrefTextPrefix:l,currentPage:o.params.page||1,onPageClick:function(e,t){t.preventDefault(),PARTcloud.route(i+c.param(c.extend({},o.params,{page:e})))}};d<576&&(s.displayedPages=3),t.$el.find(".TileView-Paginator").pagination(s),o.models.forEach(function(e){!1===e.uploaded&&""===e.error_message&&t.checkUploadStatus(e.model_id)})}},destroy:function(){this.$el.find(".TileView-Paginator").pagination("destroy")},events:{"click; .TileView-Part-Creator-Name":function(e){var t=c(e.currentTarget).data("user_id");PARTcloud.route("?route=index&user_id="+t)},"click; .Model-Link .TileView-Part-Name, .Model-Link .TileView-Part-Body":function(e){var t=c(e.currentTarget).closest(".TileView-Part"),o=t.data("model_id"),i=t.data("name");return PARTcloud.route("?route=part&name="+i+"&model_id="+o),e.preventDefault()},"click; .Collection-Link .TileView-Part-Name, .Collection-Link .TileView-Part-Body":function(e){var t=c(e.currentTarget).closest(".TileView-Part"),o=t.data("collection_id"),i=t.data("collection_name");return PARTcloud.route("?route=collection&name="+i+"&collection_id="+o),e.preventDefault()},"click; .TileView-Part-Body-Quality, .TileView-Part-Body-Quality span":function(e){var t=c(e.currentTarget).closest(".TileView-Part").data("model_path"),o=this.$el.bView("PartView");o.previewView.viewerView.compare(o.model.model_path,t),e.stopPropagation()},"click; .TileView-Part-Footer-Like":function(e){if(void 0!==PARTcloud.loginStatus.loggedin&&!0===PARTcloud.loginStatus.loggedin){var o=c(e.currentTarget),t=o.closest(".TileView-Part").data("model_id");PARTcloud.likeModel(t).done(function(e){var t;!0===e.liked?(t=+o.find("span").first().text()+1,o.find("span").first().text(t),o.addClass(PARTcloudHelpers.getLikedClass())):o.hasClass(PARTcloudHelpers.getLikedClass())&&(t=+o.find("span").first().text()-1,o.find("span").first().text(t),o.removeClass(PARTcloudHelpers.getLikedClass()))})}else{var i=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_login_login"),message:"<div id='TileView-Login-Dialog-Container'>",buttons:[]});i.show().done(function(){PARTcloud.showLoginView(c("#TileView-Login-Dialog-Container"),{parent:i}).done(function(){i.resize()})})}}},checkUploadStatus:function(i){var a=this;PARTcloudApi.getModelSimple(i).done(function(e){if(!1===e.uploaded&&""===e.error_message)setTimeout(function(){a.checkUploadStatus(i)},5e3);else if(!1===e.uploaded&&""!==e.error_message)a.$el.find('.TileView-Part.Model-Link[data-model_id="'+e.model_id+'"]').remove();else if(e.uploaded){var t=a.$el.find('.TileView-Part.Model-Link[data-model_id="'+e.model_id+'"] .TileView-Part-Body');t.find("i:first").remove();var o=PARTcloudHelpers.prependPartcloudBaseUrl(e.preview.image_path_preview);t.prepend('<img src="'+o+'">')}})},abbreviateNumber:function(e){var t,o=[{value:1,symbol:""},{value:1e3,symbol:"k"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];for(t=o.length-1;0<t&&!(e>=o[t].value);t--);return(e/o[t].value).toFixed(1).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+o[t].symbol}})}(jQuery),function(n){"use strict";brite.registerView("TopUsersView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return this.data=e,PARTcloud.renderTemplate("tpl-TopUsersView",e)},init:function(o,e){var t=this.$el.find(".TopUsersView-ModelsContainer");n.each(t,function(e,t){PARTcloud.showTileView(t,{models:o.users[e].models.models,count:o.users[e].models.count})})},postDisplay:function(e,t){if(e.route){var o="?route="+e.route+"&",i="?route="+e.route+"&page=";this.$el.find(".TopUsersView-Paginator").pagination({items:e.count,itemsOnPage:PARTcloud.topUsersPerPage,prevText:"« "+PARTcloudHelpers.translate("pcl_tile_pagination_previous"),nextText:PARTcloudHelpers.translate("pcl_tile_pagination_next")+" »",cssStyle:"pcl-theme",hrefTextPrefix:i,currentPage:e.page||1,onPageClick:function(e,t){t.preventDefault(),PARTcloud.route(o+n.param({page:e}))}})}var a=PARTcloudHelpers.getParameter("jump",void 0);void 0!==a&&this.jumpToUser(a)},destroy:function(){this.$el.find(".TopUsersView-Paginator").pagination("destroy")},events:{"click; .TopUsersView-UserInfo-Name":function(e){var t=n(e.currentTarget).data("user_id");PARTcloud.route("?route=index&user_id="+t)},"click; .TopUsersView-Find-Myself":function(e){var r=this;if(void 0!==PARTcloud.loginStatus.loggedin&&!0===PARTcloud.loginStatus.loggedin)PARTcloudApi.getUserRank(PARTcloud.loginStatus.user_id,0).done(function(e){if(void 0===e.status||"error"!==e.status){var t=e.rank;if(0===t){var o=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_top_users_not_ranked_title"),message:PARTcloudHelpers.translate("pcl_top_users_not_ranked"),buttons:[{label:PARTcloudHelpers.translate("pcl_top_upload_now"),callback:function(){PARTcloud.route("?route=upload-parts"),o.hide()}}]});o.show()}else{var i=t%PARTcloud.topUsersPerPage,a=(t-i)/PARTcloud.topUsersPerPage+(i?1:0);r.data.page!==a?PARTcloud.route("?route="+r.data.route+"&page="+a+"&jump="+t):r.jumpToUser(t)}}});else{var t=new psol.components.MessageDialog({title:PARTcloudHelpers.translate("pcl_login_login"),message:"<div id='TopUsersView-Login-Dialog-Container'>",buttons:[]});t.show().done(function(){PARTcloud.showLoginView(n("#TopUsersView-Login-Dialog-Container"),{parent:t}).done(function(){t.resize()})})}}},jumpToUser:function(e){n("html, body").scrollTop(this.$el.find("#TopUsersView-Rank-"+e).offset().top)}})}(jQuery),function(s){"use strict";brite.registerView("UploadDropzoneView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return e.uploadMaintenanceMode=PARTcloudConfig.isFeatureEnabled("uploadMaintenanceMode"),e.uploadHint=PARTcloudConfig.isFeatureEnabled("uploadHint"),PARTcloud.renderTemplate("tpl-UploadDropzoneView",e)},init:function(e,t){this.validStatus={nameValid:!1,descriptionValid:!0,categoryValid:!1,licenseValid:!0,fileValid:!!window.PARTcloudCad},this.maxFiles=5,this.uploadFiles=[],tinymce.editors.forEach(function(e){e.remove()})},postDisplay:function(e,t){var i=this;if(!e.uploadMaintenanceMode&&window.Dropzone){var o=PARTcloudHelpers.translate("pcl_upload_dropzone_default_text"),a=PARTcloudHelpers.translate("pcl_upload_dropzone_default_button");s("div#upload-dropzone").dropzone({url:"#",autoProcessQueue:!1,dictDefaultMessage:"<div>"+o+"</div><br><button>"+a+"</button>",acceptedFiles:".3ds,.ase,.blend,.cip,.dae,.glb,.ifc,.lwo,.obj,.ply,.step,.stl,.stp,.zip,.zjv",paramName:"file",maxFilesize:100,maxFiles:5,addRemoveLinks:!0,accept:function(e,t){if(this.files.length>i.maxFiles)t("You can't upload anymore files.");else{var o=e.name.split(".");"zip"===o[o.length-1].toLowerCase()?i.handleZip(e).fail(function(e){t(e)}).done(function(){s("#UploadDropzoneView-Submit-Button").show(),t()}):(s("#UploadDropzoneView-Submit-Button").show(),t())}},init:function(){this.on("addedfile",function(e){s(".dz-remove").html("<div class='dz-trash fa fa-trash-o'></div>")}),this.on("error",function(e){window.setTimeout(function(){s(".dz-remove").html("<div class='dz-trash fa fa-trash-o'></div>")},100)}),this.on("reset",function(){s("#UploadDropzoneView-Submit-Button").hide()})}}),i.dropZone=window.Dropzone.forElement("div#upload-dropzone")}},destroy:function(){},handleZip:function(e){var a,r=s.Deferred(),t=new window.JSZip,n=["3ds","dae","obj"],l=["bmp","jpeg","jpg","mtl","png"],d=0;return t.loadAsync(e).then(function(e){for(var t in e.files)if(e.files.hasOwnProperty(t)){var o=t.split(".");if(1===o.length)continue;var i=o[o.length-1].toLowerCase();"zip"===i?r.reject("Zip inside zip not supported."):0<=s.inArray(i,n)?d++:s.inArray(i,l)<0&&(a="Unsupported file type: "+i)}0===d?a="No valid 3D file type inside zip.":1<d&&(a="Only one 3D file per zip allowed."),a?r.reject(a):r.resolve()}),r.promise()},events:{"click; #UploadDropzoneView-Submit-Button":function(e){var t=[];if(this.dropZone.files.forEach(function(e){"queued"===e.status&&t.push(e)}),0!==t.length){var o=new window.PARTcloudUploader(t);s.when(s.Deferred(function(){var t=this;PARTcloudApi.getLicenses().done(function(e){t.resolve(e)}).fail(function(){t.reject()})})).done(function(e){o.licenses=e;var t=s("#upload-parts");PARTcloud.showUploadFormularView(".UploadViewContainer",o).done(function(){PARTcloud.showTab(t)})})}}}})}(jQuery),function(r){"use strict";brite.registerView("UploadFormularView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return PARTcloud.renderTemplate("tpl-UploadFormularView",e)},init:function(e,t){var o=this;tinymce.editors.forEach(function(e){e.remove()}),o.uploader=e,o.uploadViewerViews=[],o.uploadCounter=0,o.totalFileSize=0,e.uploadData.forEach(function(e){o.totalFileSize+=e.file.size})},postDisplay:function(e,t){this.setUpViewerViews(this.uploader.uploadData[0],0)},destroy:function(){},setUpViewerViews:function(e,t){var o=this,i=o.uploader.uploadData,a=r.Deferred();e.index=t,e.uploader=o.uploader,e.singleFile=1===i.length,o.showUploadViewerView(o.$el.find(".UploadFormularView-Container[data-upload-index="+t+"]"),r.extend({viewerPromise:a},e)).done(function(e){o.uploadViewerViews[e.index]=e}),r.when(a).then(function(){++t!==i.length&&o.setUpViewerViews(i[t],t)})},showUploadViewerView:function(e,t){return t=t||{},brite.display("UploadViewerView",e,t)},showProgressbar:function(){var e=this.$el.find("#UploadFormularView-Progressbar");e.progressbar({value:0}),e.data("maxValue",this.totalFileSize),r(".UploadFormularView-Progressbar").show(),r(".UploadFormularView-Progressbar-Percentage").show()},resizeProgressbar:function(e){var t=r("#UploadFormularView-Progressbar"),o=e.loaded/e.total*100;t.progressbar("value",o),o=Math.round(o),r(".UploadFormularView-Progressbar-Percentage").html(o+"%")},hideProgressbar:function(){this.$el.find("#UploadFormularView-Progressbar").hide()},events:{"click; #UploadFormularView-Submit":function(e){var i=this;if(i.uploadViewerViews.forEach(function(e){e.isAllValid()}),i.uploader.checkValidation())i.$el.find("#UploadFormularView-Submit").attr("disabled","disabled"),i.$el.find("#UploadFormularView-Submit").hide(),i.uploader.uploadData.forEach(function(e,t){i.uploader.uploadData[t]=i.uploadViewerViews[t].getUpload()}),i.showProgressbar(),i.uploader.upload(i.resizeProgressbar).done(function(e){i.hideProgressbar(),PARTcloud.route("?route=my-parts&pending=true")}).fail(function(e,t,o){i.hideProgressbar(),i.$el.find("#UploadFormularView-Submit").removeAttr("disabled"),i.$el.find("#UploadFormularView-Submit").show()});else{var t=[];i.uploadViewerViews.forEach(function(e){e.checkValidation().forEach(function(e){t.push(e)})}),r.each(t,function(e,t){t.parent().find(".UploadViewerView-Step").css("background-color","#ff0000")})}}}})}(jQuery),function(g){"use strict";brite.registerView("UploadPartsView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){return e.uploadHint=PARTcloudConfig.isFeatureEnabled("uploadHint"),e.maxSize=PARTcloudConfig.getUploadMaxFileSize()/1024/1024,e.showFileUpload="undefined"==typeof PARTcloudCad,PARTcloud.renderTemplate("tpl-UploadPartsView",e)},init:function(e,t){this.validStatus={nameValid:!1,descriptionValid:!1,categoryValid:!1,licenseValid:!0,fileValid:!!window.PARTcloudCad},tinymce.editors.forEach(function(e){e.remove()})},postDisplay:function(e,t){var o,i=this;tinymce.init({selector:"#UploadPartsView-Description-Textarea",theme:"modern","max-width":600,statusbar:!1,menubar:!1,relative_urls:!1,remove_script_host:!0,toolbar:"undo redo | bold italic underline | bullist numlist | emoticons | alignleft aligncenter alignright alignjustify | outdent indent",plugins:["autolink","autoresize","emoticons"],autoresize_min_height:100,autoresize_bottom_margin:0,setup:function(t){t.on("keyup",function(e){0!==t.save().length?(i.markValid(g("#UploadPartsView-Description-Textarea").parent().prevAll(".UploadPartsView-Step").first()),i.validStatus.descriptionValid=!0):(i.markInvalid(g("#UploadPartsView-Description-Textarea").parent().prevAll(".UploadPartsView-Step").first()),i.validStatus.descriptionValid=!1)}),i.markInvalid(g("#UploadPartsView-Description-Textarea").parent().prevAll(".UploadPartsView-Step").first())}});var a=parseInt(PARTcloudHelpers.getParameter("preselect_category_id"),10),r=parseInt(PARTcloudHelpers.getLocalStorageItem("pcl_upload_category_id"),10);!1===isNaN(a)?o=a:!1===isNaN(r)?(o=r,i.$el.find("#UploadPartsView-Remember-Selection-Checkbox-Category").prop("checked",!0)):o=null;var n=i.$el.find("#UploadPartsView-Category");i.pclCategoryHandler=new PARTcloudCategory(n,o,!0),i.pclCategoryHandler.readyPromise.done(function(e){i.categoryChange(i.pclCategoryHandler.getSelectedCategoryId())}),i.pclCategoryHandler.setChangeHandler(i.categoryChange,i);var l=PARTcloudHelpers.getLocalStorageItem("pcl_upload_license_id");if(null!==l&&g.isNumeric(l)&&(i.$el.find("#UploadPartsView-Remember-Selection-Checkbox-License").prop("checked",!0),i.$el.find("#UploadPartsView-License").val(l),l===""+PARTcloud.licenses.externalDownload)){var d=i.$el.find("#UploadPartsView-License-ExternalUrl");d.show(),i.validStatus.licenseValid=!1,i.markInvalid(d.parent().prevAll(".UploadPartsView-Step").first())}"undefined"!=typeof PARTcloudCad&&PARTcloudCad.modelName&&(i.$el.find("#UploadPartsView-Name").val(PARTcloudCad.modelName),i.validateName()),i.validateName(),i.markInvalid(i.$el.find(".UploadPartsView-MaxFilesize").parent().find(".UploadPartsView-Step").first())},destroy:function(){tinymce.editors.forEach(function(e){e.remove()})},events:{"click; #UploadPartsView-Submit-Button":function(e){var i=this;if(i.isAllValid()){var t={};i.$el.find("#UploadPartsView-Submit-Button").attr("disabled","disabled"),i.$el.find("#UploadPartsView-Submit-Button").hide();var o=i.$el.find("#UploadPartsView-Name")[0].value,a=tinymce.get("UploadPartsView-Description-Textarea").save(),r=i.pclCategoryHandler.getSelectedCategoryId(),n=i.$el.find("#UploadPartsView-License").val(),l=i.$el.find("#UploadPartsView-License-ExternalUrl").val();l&&(t.external_download_url=l);var d=i.$el.find("#UploadPartsView-Unit-Select").val();d&&(t.unit=d),t.axis_up=i.$el.find("#UploadPartsView-AxisUp-Select").val()||"Z",t.axis_front=i.$el.find("#UploadPartsView-AxisFront-Select").val()||"-Y";var s=i.$el.find("#UploadPartsView-File")[0],c=i.$el.find("#UploadPartsView-AdditionalFile")[0];i.showProgressbar(),i.$el.find("#UploadPartsView-Remember-Selection-Checkbox-Category").prop("checked")?PARTcloudHelpers.setLocalStorageItem("pcl_upload_category_id",r):PARTcloudHelpers.removeLocalStorageItem("pcl_upload_category_id"),i.$el.find("#UploadPartsView-Remember-Selection-Checkbox-License").prop("checked")?PARTcloudHelpers.setLocalStorageItem("pcl_upload_license_id",n):PARTcloudHelpers.removeLocalStorageItem("pcl_upload_license_id"),(window.PARTcloudCad?PARTcloudApi.uploadModelStandalone(o,a,r,n,t,i.resizeProgressbar):PARTcloudApi.uploadModel(o,a,r,n,t,s,c,i.resizeProgressbar)).done(function(e){i.hideProgressbar(),PARTcloud.route("?route=part&name="+PARTcloudHelpers.encodeURIComponentName(e.name)+"&model_id="+e.model_id)}).fail(function(e,t,o){i.hideProgressbar(),i.$el.find("#UploadPartsView-Submit-Button").removeAttr("disabled"),i.$el.find("#UploadPartsView-Submit-Button").show()})}else{var u={color:"#FF0000"},p={duration:300,pulses:4},m=[];i.validStatus.nameValid||m.push(i.$el.find("#UploadPartsView-Name").parent().prevAll("span")),i.validStatus.descriptionValid||m.push(i.$el.find("#UploadPartsView-Description-Textarea").parent().prevAll("span")),i.validStatus.categoryValid||m.push(i.$el.find("#UploadPartsView-Category").prevAll("span")),i.validStatus.licenseValid||m.push(i.$el.find("#UploadPartsView-License").parent().prevAll("span")),i.validStatus.fileValid||m.push(i.$el.find("#UploadPartsView-File").parent().prevAll("span")),g.each(m,function(e,t){t.pulse(u,p)})}},"paste cut change keydown keyup blur; #UploadPartsView-Name":function(e){this.validateName()},"change; #UploadPartsView-File":function(e){this.fileCheck(e)},"change; .UploadPartsView-Axes-Select":function(e){this.fileCheck(e)},"change; #UploadPartsView-License":function(e){var t=this,o=g(e.currentTarget),i=o.find(":selected"),a=i.data("url"),r=i.data("icon_url"),n=i.val();if(""===a||""===r?(t.$el.find("#UploadPartsView-License-Url").hide(),t.$el.find("#UploadPartsView-License-Icon").hide()):(t.$el.find("#UploadPartsView-License-Url").show().attr("href",a),t.$el.find("#UploadPartsView-License-Icon").show().attr("src",PARTcloudHelpers.prependPartcloudBaseUrl(r))),n===""+PARTcloud.licenses.externalDownload){var l=t.$el.find("#UploadPartsView-License-ExternalUrl");l.show(),t.validateUrl(l.val())?(t.validStatus.licenseValid=!0,t.markValid(o.parent().prevAll(".UploadPartsView-Step").first())):(t.validStatus.licenseValid=!1,t.markInvalid(o.parent().prevAll(".UploadPartsView-Step").first()))}else t.$el.find("#UploadPartsView-License-ExternalUrl").hide(),t.validStatus.licenseValid=!0,t.markValid(o.parent().prevAll(".UploadPartsView-Step").first())},"paste cut change keydown keyup blur; #UploadPartsView-License-ExternalUrl":function(e){var t=this,o=g(e.currentTarget);t.validateUrl(o.val())?(t.validStatus.licenseValid=!0,t.markValid(o.parent().prevAll(".UploadPartsView-Step").first())):(t.validStatus.licenseValid=!1,t.markInvalid(o.parent().prevAll(".UploadPartsView-Step").first()))}},showProgressbar:function(){this.$el.find("#UploadPartsView-Progressbar").show()},resizeProgressbar:function(e){g("#UploadPartsView-Progressbar").progressbar({value:e.loaded/e.total*100})},hideProgressbar:function(){this.$el.find("#UploadPartsView-Progressbar").hide()},showAdditionalFile:function(e){this.$el.find("#UploadPartsView-AdditionalFile-Container").show(),this.$el.find("#UploadPartsView-AdditionalFile").attr("accept",e)},hideAdditionalFile:function(){this.$el.find("#UploadPartsView-AdditionalFile-Container").hide(),this.$el.find("#UploadPartsView-AdditionalFile").attr("accept","")},markValid:function(e){e.css("background-color","#00be00")},markInvalid:function(e){e.css("background-color","#ff0000")},isAllValid:function(){return this.validStatus.nameValid&&this.validStatus.descriptionValid&&this.validStatus.categoryValid&&this.validStatus.licenseValid&&this.validStatus.fileValid},validateName:function(){var e=this,t=e.$el.find("#UploadPartsView-Name");0!==t.val().length?(e.markValid(t.parent().prevAll(".UploadPartsView-Step").first()),e.validStatus.nameValid=!0):(e.markInvalid(t.parent().prevAll(".UploadPartsView-Step").first()),e.validStatus.nameValid=!1)},categoryChange:function(e){var t=this;t.validStatus.categoryValid="boolean"==typeof e&&!1===e?(t.markInvalid(t.$el.find("#UploadPartsView-Category").parent().find(".UploadPartsView-Step").first()),!1):(t.markValid(t.$el.find("#UploadPartsView-Category").parent().find(".UploadPartsView-Step").first()),!0)},fileCheck:function(e){var t=this,o=t.$el.find("#UploadPartsView-File"),i=o.val();if(0!==i.length&&2<=i.split(".").length){var a=i.split("."),r=a.pop().toLowerCase(),n=o[0].files[0];if(!1===t.validStatus.nameValid){var l=a.join(".").split(/[\\/]/).pop().replace(/[_]/g," ");t.$el.find("#UploadPartsView-Name").val(l),t.validateName()}var d=t.$el.find("#UploadPartsView-AxisUp-Select").val(),s=t.$el.find("#UploadPartsView-AxisFront-Select").val();-1===g.inArray(r,PARTcloud.allowedExtensionsForUpload)||PARTcloudConfig.getUploadMaxFileSize()<=n.size?(t.markInvalid(g(e.currentTarget).closest(".UploadPartsView-Steps").find(".UploadPartsView-Step").first()),t.validStatus.fileValid=!1,t.hideAdditionalFile()):d===s||1<d.length&&d[1]===s||1<s.length&&s[1]===d?(t.markInvalid(g(e.currentTarget).closest(".UploadPartsView-Steps").find(".UploadPartsView-Step").first()),t.validStatus.fileValid=!1):(t.markValid(g(e.currentTarget).closest(".UploadPartsView-Steps").find(".UploadPartsView-Step").first()),t.validStatus.fileValid=!0,"obj"===r?t.showAdditionalFile(".mtl,.MTL",""):t.hideAdditionalFile(),"stl"===r?t.$el.find(".UploadPartsView-Unit").show():t.$el.find(".UploadPartsView-Unit").hide())}else t.markInvalid(g(e.currentTarget).closest(".UploadPartsView-Steps").find(".UploadPartsView-Step").first()),t.validStatus.fileValid=!1,t.hideAdditionalFile()},validateUrl:function(e){return Boolean(e.match(/^(?:(?:https?):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i))}})}(jQuery),function(m){"use strict";brite.registerView("UploadViewerView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;return o.file=e.file,o.dataForViewer={file:o.file,viewerIsUploader:!0,canEditPart:!0,canCollect:!0,canUploadImage:!0,canSetImageAsPreview:!0,thereAreTags:!1,thereAreMultipleImages:!1,showDownloadButton:!1,showExternalDownloadButton:!1,showLicenseView:!1,canDeletePart:!0},o.fileIsZip=!1,o.originalFileName=o.file.name,o.viewerPromise=e.viewerPromise||m.Deferred(),o.favoriteActions=[],o.radialMenuActions=[],o.uploadData=e,o.index=e.index,o.singleFile=e.singleFile,o.backgroundColor={top:PARTcloud.viewerColorTop,bottom:PARTcloud.viewerColorBottom},o.currentRotation=o.uploadData.rotation,o.initialRotation=o.uploadData.rotation,o.validStatus={nameValid:!1,descriptionValid:!1,categoryValid:!1,licenseValid:!0},o.isUploadViewerInitialized=!1,o.uploader=e.uploader,PARTcloud.renderTemplate("tpl-UploadViewerView",e)},init:function(e,t){var a=this,o=a.file.name.split(".");if("zip"===o[o.length-1].toLowerCase()){a.fileIsZip=!0,a.additionalFiles=[];var r=["3ds","dae","obj"],n=["bmp","jpeg","jpg","mtl","png"];(new window.JSZip).loadAsync(a.file).then(function(e){Object.keys(e.files).map(function(i){e.files[i].async("blob").then(function(e){var t=i.split("."),o=t[t.length-1];0<=m.inArray(o.toLowerCase(),r)?a.file=new File([e],i):0<=m.inArray(o,n)&&a.additionalFiles.push(new File([e],i,{type:o}))})})})}},postDisplay:function(e,t){var o,i=this;i.checkFileName(),i.initTinymce();var a=parseInt(PARTcloudHelpers.getParameter("preselect_category_id"),10),r=parseInt(PARTcloudHelpers.getLocalStorageItem("pcl_upload_category_id"),10);!1===isNaN(a)?o=a:!1===isNaN(r)?(o=r,i.$el.find("#UploadViewerView-Remember-Selection-Checkbox-Category").prop("checked",!0)):o=null;var n=i.$el.find(".UploadViewerView-Category");i.pclCategoryHandler=new PARTcloudCategory(n,o,!0),i.pclCategoryHandler.readyPromise.done(function(e){i.categoryChange(i.pclCategoryHandler.getSelectedCategoryId())}),i.pclCategoryHandler.setChangeHandler(i.categoryChange,i);var l=PARTcloudHelpers.getLocalStorageItem("pcl_upload_license_id");if(null!==l&&m.isNumeric(l)&&(i.$el.find("#UploadViewerView-Remember-Selection-Checkbox-License").prop("checked",!0),i.$el.find(".UploadViewerView-License-Select").val(l),l===""+PARTcloud.licenses.externalDownload)){var d=i.$el.find(".UploadViewerView-License-ExternalUrl");d.show(),i.validStatus.licenseValid=!1,i.markInvalid(d.parent().prevAll(".UploadViewerView-Step").first())}var s=JSON.parse(PARTcloudHelpers.getLocalStorageItem("pcl_upload_background_colors"));if(null!==s){var c=/#[0-9A-Fa-f]{6}/g,u=c.test(s.top);c.lastIndex=0;var p=c.test(s.bottom);u&&p&&(i.$el.find("#UploadViewerView-Remember-Selection-Checkbox-Background-Color").prop("checked",!0),i.backgroundColor={top:s.top,bottom:s.bottom})}i.loadPartWebViewer(i.dataForViewer),m.when(i.viewerPromise).then(function(){i.initColorPickers()}),m(window).bind("resize.pclViewer",function(){return i.updateViewerScale()})},destroy:function(e,t){tinymce.editors.forEach(function(e){e.remove()})},getAxesAndRotation:function(){var e=this,t=window.THREE,o=new t.Matrix4,i=e.uploadViewer.getMeshRotation();o.makeRotationFromEuler(i);var a={x:new t.Vector3(o.elements[0],o.elements[1],o.elements[2]),y:new t.Vector3(o.elements[4],o.elements[5],o.elements[6]),z:new t.Vector3(o.elements[8],o.elements[9],o.elements[10])};for(var r in e.partAxes={},a)a.hasOwnProperty(r)&&(a[r].round(),1===Math.abs(a[r].y)?a[r].y<0?e.partAxes.up="-"+r.toUpperCase():e.partAxes.up=r.toUpperCase():1===Math.abs(a[r].z)&&(a[r].z<0?e.partAxes.front="-"+r.toUpperCase():e.partAxes.front=r.toUpperCase()));var n={x:i.x,y:i.y,z:i.z,order:i.order};return e.rotationMatrix=JSON.stringify(n),{axis_up:e.partAxes.up,axis_front:e.partAxes.front,mesh_rotation:e.rotationMatrix}},getUpload:function(){var e=this,t={file:e.file,name:e.$el.find(".UploadViewerView-Name")[0].value,description:tinymce.get("UploadViewerView-Description-Textarea-"+e.index).save(),license:e.$el.find(".UploadViewerView-License-Select").val(),category:e.pclCategoryHandler.getSelectedCategoryId()},i={};if(e.fileIsZip){t.additionalFileElement={files:e.additionalFiles},i.zipPath={},e.additionalFiles.forEach(function(e){var t=e.name.split("/"),o=t.pop();o.includes(".")&&(i.zipPath[t.join("/")]=i.zipPath[t.join("/")]||[]).push(o)});var o=e.file.name.split("/"),a=o.pop();(i.zipPath[o.join("/")]=i.zipPath[o.join("/")]||[]).push(a),i.zipPath=JSON.stringify(i.zipPath)}e.backgroundColor.top===PARTcloud.viewerColorTop&&e.backgroundColor.bottom===PARTcloud.viewerColorBottom||(i.background_color_top=e.backgroundColor.top,i.background_color_bottom=e.backgroundColor.bottom),m.extend(i,e.getAxesAndRotation());var r=e.$el.find(".UploadViewerView-License-ExternalUrl").val();return r&&(i.external_download_url=r),e.backgroundImage&&(i.background_image=e.backgroundImage),t.additionalData=i,e.singleFile&&(e.$el.find("#UploadViewerView-Remember-Selection-Checkbox-Category").prop("checked")?PARTcloudHelpers.setLocalStorageItem("pcl_upload_category_id",t.category):PARTcloudHelpers.removeLocalStorageItem("pcl_upload_category_id"),e.$el.find("#UploadViewerView-Remember-Selection-Checkbox-License").prop("checked")?PARTcloudHelpers.setLocalStorageItem("pcl_upload_license_id",t.license):PARTcloudHelpers.removeLocalStorageItem("pcl_upload_license_id"),e.$el.find("#UploadViewerView-Remember-Selection-Checkbox-Background-Color").prop("checked")?PARTcloudHelpers.setLocalStorageItem("pcl_upload_background_colors",JSON.stringify(e.backgroundColor)):PARTcloudHelpers.removeLocalStorageItem("pcl_upload_background_colors")),t},loadPartWebViewer:function(e){var t=this,o=t.viewerPromise;if(PARTcloud.isWebGLSupported()){var i={$container:m(".UploadViewerView-Viewer-Container[data-upload-index='"+t.index+"']"),viewerBackendType:psol.components.WebViewer3D.ViewerBackends.WebGL,devicePixelRatio:window.devicePixelRatio,radialMenuActions:t.radialMenuActions,favoriteActions:t.favoriteActions,webglViewerSettings:{ColorTL:t.backgroundColor.top,ColorTR:t.backgroundColor.top,ColorBL:t.backgroundColor.bottom,ColorBR:t.backgroundColor.bottom,enableSilhuette:!0,material:{preset:"pcloud"},shadeMode:psol.components.WebViewer3D.ShadeModes.Shade,helperOptions:{modelAxisOn:!0,modelGridOn:!0},sao:!1}};t.uploadViewer=new psol.components.WebViewer3D(m.extend(i,e)),t.uploadViewer.onProgressBegin=function(e){t.$el.find(".UploadViewerView-Loading").show()},t.uploadViewer.onProgressEnd=function(e){t.$el.find(".UploadViewerView-Loading").hide()},t.uploadViewer.show().done(function(){t.updateViewerScale(),t.loadPreview(e.file).done(function(){o.resolve()}),t.isUploadViewerInitialized=!0})}else o.reject();return o.promise()},loadPreview:function(e){var t=m.Deferred();return this.uploadViewer.loadByGeomFile(e,{clearBeforeLoad:!0,defaultView:!0}).done(function(){t.resolve()}),t.promise()},updateRotation:function(e,t){var o=this,i=m.Deferred(),a=t*Math.PI,r={};switch(e){case"x":r={x:a,y:0,z:0};break;case"y":r={x:0,y:a,z:0};break;case"z":r={x:0,y:0,z:a};break;default:r={x:0,y:0,z:0}}return o.uploadViewer.rotateMesh(r,!1,0,!0,function(){window.setTimeout(function(){o.currentRotation=o.uploadViewer.getMeshRotation(),i.resolve()},100)}),i.promise()},updateViewerScale:function(){var e=this.$el.find(".UploadViewerView-Viewer"),t=9*e.width()/16;e.css({height:t,maxHeight:t})},initColorPickers:function(){var i=this,e=i.$el.find(".UploadViewerView-Background-Color-Top");e.tinycolorpicker({});var a=e.data("plugin_tinycolorpicker");a.setColor(i.backgroundColor.top||PARTcloud.viewerColorTop);var t=i.$el.find(".UploadViewerView-Background-Color-Bottom");t.tinycolorpicker({});var r=t.data("plugin_tinycolorpicker");r.setColor(i.backgroundColor.bottom||PARTcloud.viewerColorBottom),e.on("change",function(e,t,o){i.setViewerColors(t,r.colorHex)}),t.on("change",function(e,t,o){i.setViewerColors(a.colorHex,t)})},initTinymce:function(){var o=this,i=".UploadViewerView-Description-Textarea-"+o.index;tinymce.init({selector:i,theme:"modern",statusbar:!1,menubar:!1,relative_urls:!1,remove_script_host:!0,toolbar:"undo redo | bold italic underline | bullist numlist | emoticons",plugins:["autolink","autoresize","emoticons"],autoresize_min_height:100,autoresize_bottom_margin:0,setup:function(t){t.on("keyup",function(e){0!==t.save().length?(o.markValid(m(i).parent().prevAll(".UploadViewerView-Step").first()),o.validStatus.descriptionValid=!0):(o.markInvalid(m(i).parent().prevAll(".UploadViewerView-Step").first()),o.validStatus.descriptionValid=!1)})}})},setViewerColors:function(e,t){this.isUploadViewerInitialized&&(this.uploadViewer.setViewerSettings({ColorTL:e,ColorTR:e,ColorBL:t,ColorBR:t}),this.backgroundColor={top:e,bottom:t})},setBackgroundImage:function(e){var t=this;if(FileReader){var o=new FileReader;o.onload=function(){t.uploadViewer.setViewerSettings({logoTexture:o.result,logoScaleFactor:1,logoMixFactor:1}),t.$el.find(".UploadViewerView-Background-Image-Add").hide(),t.$el.find(".UploadViewerView-Background-Image-Remove").show(),t.backgroundImage=o.result},o.readAsDataURL(e)}},categoryChange:function(e){var t=this;t.validStatus.categoryValid="boolean"==typeof e&&!1===e?(t.markInvalid(t.$el.find(".UploadViewerView-Category").parent().find(".UploadViewerView-Step").first()),!1):(t.markValid(t.$el.find(".UploadViewerView-Category").parent().find(".UploadViewerView-Step").first()),!0)},checkValidation:function(){var e=this,t=[];return e.validStatus.nameValid||t.push(e.$el.find(".UploadViewerView-Name").parent().prevAll("span")),e.validStatus.descriptionValid||t.push(e.$el.find(".UploadViewerView-Description-Textarea").parent().prevAll("span")),e.validStatus.categoryValid||t.push(e.$el.find(".UploadViewerView-Category").prevAll("span")),e.validStatus.licenseValid||t.push(e.$el.find(".UploadViewerView-License-Select").parent().prevAll("span")),t},checkFileName:function(){var e=this.originalFileName;if(0!==e.length&&2<=e.split(".").length){var t=e.split(".");if(t.pop(),!1===this.validStatus.nameValid){var o=t.join(".").split(/[\\/]/).pop().replace(/[_]/g," ");this.$el.find(".UploadViewerView-Name").val(o),this.validateName()}}},validateName:function(){var e=this,t=e.$el.find(".UploadViewerView-Name");0!==t.val().length?(e.markValid(t.parent().prevAll(".UploadViewerView-Step").first()),e.validStatus.nameValid=!0):(e.markInvalid(t.parent().prevAll(".UploadViewerView-Step").first()),e.validStatus.nameValid=!1)},validateUrl:function(e){return Boolean(e.match(/^(?:(?:https?):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i))},isAllValid:function(){this.validStatus.nameValid&&this.validStatus.descriptionValid&&this.validStatus.categoryValid&&this.validStatus.licenseValid&&(this.uploader.uploadData[this.index].valid=!0)},markValid:function(e){e.css("background-color","rgb(122, 199, 222)")},markInvalid:function(e){e.css("background-color","#c4c4c4")},events:{"click; .UploadViewerView-Background-Image-Add":function(e){this.$el.find(".UploadViewerView-Background-Image-Input").click()},"change; .UploadViewerView-Background-Image-Input":function(e){if(0!==e.target.files.length){var t=e.target.files[0];this.setBackgroundImage(t)}},"click; .UploadViewerView-Background-Image-Remove":function(e){var t=this;t.$el.find(".UploadViewerView-Background-Image-Remove").hide(),t.$el.find(".UploadViewerView-Background-Image-Add").show(),t.$el.find(".UploadViewerView-Background-Image-Input").val(""),t.uploadViewer.setViewerSettings({logoTexture:""}),t.backgroundImage=""},"click; .UploadViewerView-Rotation-Reset":function(e){var t=this,o={x:-t.currentRotation.x,y:-t.currentRotation.y,z:-t.currentRotation.z};t.currentRotation={x:0,y:0,z:0},t.uploadViewer.rotateMesh(o,!1,0,!0)},"click; .UploadViewerView-Rotation-Button":function(e){var t=this;t.$el.find(".UploadViewerView-Rotation-Button").each(function(){this.disabled=!0});var o=e.target.getAttribute("data-axis"),i=e.target.getAttribute("data-rotation");t.updateRotation(o,i).done(function(){t.$el.find(".UploadViewerView-Rotation-Button").each(function(){this.disabled=!1})})},"paste cut change keydown keyup blur; .UploadViewerView-Name":function(e){this.validateName()},"change; .UploadViewerView-License-Select":function(e){var t=this,o=m(e.currentTarget),i=o.find(":selected"),a=i.data("url"),r=i.data("icon_url"),n=i.val();if(""===a||""===r?(t.$el.find(".UploadViewerView-License-Url").hide(),t.$el.find(".UploadViewerView-License-Icon").hide()):(t.$el.find(".UploadViewerView-License-Url").show().attr("href",a),t.$el.find(".UploadViewerView-License-Icon").show().attr("src",PARTcloudHelpers.prependPartcloudBaseUrl(r))),n===""+PARTcloud.licenses.externalDownload){var l=t.$el.find(".UploadViewerView-License-ExternalUrl");l.show(),t.validateUrl(l.val())?(t.validStatus.licenseValid=!0,t.markValid(o.parent().prevAll(".UploadViewerView-Step").first())):(t.validStatus.licenseValid=!1,t.markInvalid(o.parent().prevAll(".UploadViewerView-Step").first()))}else t.$el.find(".UploadViewerView-License-ExternalUrl").hide(),t.validStatus.licenseValid=!0,t.markValid(o.parent().prevAll(".UploadViewerView-Step").first())},"paste cut change keydown keyup blur; .UploadViewerView-License-ExternalUrl":function(e){var t=this,o=m(e.currentTarget);t.validateUrl(o.val())?(t.validStatus.licenseValid=!0,t.markValid(o.parent().prevAll(".UploadViewerView-Step").first())):(t.validStatus.licenseValid=!1,t.markInvalid(o.parent().prevAll(".UploadViewerView-Step").first()))}}})}(jQuery),function(r){"use strict";brite.registerView("ViewerView",{emptyParent:!0,loadCss:PARTcloud.viewConfig.loadCss,loadTmpl:PARTcloud.viewConfig.loadTmpl},{create:function(e,t){var o=this;return o.model=e.model,o.canEditPart=e.canEditPart,o.canUploadImage=e.canUploadImage,o.embeddedConfig=e.embeddedConfig||void 0,o.viewerPromise=e.viewerPromise||r.Deferred(),o.favoriteActions=["actAnimate","actPseudoFullscreen","actSaveCameraParams","actScreenShot","actEnableHotSpots","actHotSpots","actEnv","actToggleRotationMode"],o.radialMenuActions=[{name:"menu_shading",subActions:["actLine","actShade","actShadeLine"]},{name:"menu_rotation",subActions:["actIsometric","actAnimate"]},{name:"menu_vr",subActions:["actVR","actAnaglyph","actDreamocHD3","actDreamocXL2","actDreamocMOBILE","actBluebox"]},{name:"menu_special",subActions:["actCut","actCustomDimensions","actExplosion","actLabels","actFullscreen","actLeapMotion","actTeleport"]}],o.vrMenuActions=["actAnimate","actZoomCloser","actZoomAway","actVR"],PARTcloud.renderTemplate("tpl-ViewerView",e)},init:function(e,t){},postDisplay:function(e,t){var o=this;o.model.uploaded&&""===o.model.error_message?void 0!==o.embeddedConfig&&o.embeddedConfig.noAutoload||o.loadWebViewer3D():PARTcloud.isViewerInitialized&&(r("#ViewerView-Viewer-Container").empty(),r("#MainView-WebGlContainer").children().detach().appendTo("#ViewerView-Viewer-Container"))},destroy:function(e,t){PARTcloud.currentVarsettransfer=""},events:{"click; .ViewerView-Compare-Exit":function(e){var t=this;r(e.currentTarget).hide(),t.loadPreview(t.model.model_path).done(function(){t.canEditPart&&(PARTcloud.viewer.setActionState("actSaveCameraParams","visible",!0),PARTcloud.viewer.setActionState("actEnableHotSpots","visible",!0)),PARTcloud.viewer.setActionState("actEnv","visible",!0),PARTcloud.viewer.setActionState("actTeleport","visible",!0),t.environment&&PARTcloud.viewer.setEnvironmentOptions(t.environment),r("#PartView-Hotspots-Container").show()})}},loadWebViewer3D:function(){var i=this,e=i.viewerPromise,t={ColorTL:PARTcloud.viewerColorTop,ColorTR:PARTcloud.viewerColorTop,ColorBL:PARTcloud.viewerColorBottom,ColorBR:PARTcloud.viewerColorBottom,logoTexture:""};if(PARTcloud.isWebGLSupported()){if(PARTcloud.isViewerInitialized)r("#ViewerView-Viewer-Container").empty(),r("#MainView-WebGlContainer").children().detach().appendTo("#ViewerView-Viewer-Container"),PARTcloud.viewer.setViewerSettings(r.extend({logoTexture:""},t));else{var o={$container:r("#ViewerView-Viewer-Container"),viewerBackendType:psol.components.WebViewer3D.ViewerBackends.WebGL,devicePixelRatio:window.devicePixelRatio,webglViewerSettings:r.extend({enableEditableDimensions:!0,enableSilhuette:!0,material:{preset:"pcloud"}},t),environmentSettings:PARTcloud.environments};void 0===window.PsolConnector&&void 0===window.PSolConnector||(o.onLinkClickedCallback=function(e,t){var o=!1,i=window.PsolConnector||window.PSolConnector;if(t&&"catalog"===t.type)switch(t.meta.subtype){case"dir":i.selectIndexNode(t.meta.info),o=!0;break;case"prj":i.openProject("cat/"+t.meta.info),o=!0}return o}),i.embeddedConfig&&i.embeddedConfig.hideMenu?(o.radialMenuActions=[],o.favoriteActions=[]):(o.radialMenuActions=i.radialMenuActions,o.favoriteActions=i.favoriteActions),PARTcloud.viewer=new psol.components.WebViewer3D(o),PARTcloud.viewer.getHotSpotsConfig=function(){return PARTcloudConfig.getHotSpotsConfig()}}PARTcloud.viewer.onProgressBegin=function(e){i.$el.find(".ViewerView-Loading").show()},PARTcloud.viewer.onProgressEnd=function(e){i.$el.find(".ViewerView-Loading").hide()},PARTcloud.viewer.onCameraParams=function(e){i.canEditPart&&i.saveCameraPosition(e)},PARTcloud.viewer.onAddHotSpot=function(e){var t=new r.Deferred;return PARTcloudApi.addHotspot(i.model.model_id,JSON.stringify(e)).done(function(e){void 0!==e.status&&"error"===e.status?t.reject(e.message):t.resolve(e)}),t.done(function(e){i.model.hotspots.push(e),i.showHotspotView()}),t.promise()},PARTcloud.viewer.onEditHotSpot=function(e){var t=new r.Deferred;return PARTcloudApi.editHotspot(i.model.model_id,JSON.stringify(e)).done(function(e){void 0!==e.status&&"error"===e.status?t.reject(e.message):t.resolve(e)}),t.done(function(o){r.each(i.model.hotspots,function(e,t){return t.id!==o.id||(i.model.hotspots[e]=o,!1)}),i.showHotspotView()}),t.promise()},PARTcloud.viewer.onDeleteHotSpot=function(e){var t=new r.Deferred;return PARTcloudApi.deleteHotspot(i.model.model_id,JSON.stringify(e)).done(function(e){void 0!==e.status&&"error"===e.status?t.reject(e.message):t.resolve(e)}),t.done(function(o){r.each(i.model.hotspots,function(e,t){return t.id!==o.id||(i.model.hotspots.splice(e,1),!1)}),i.showHotspotView()}),t.promise()},PARTcloud.viewer._onactScreenShot=function(){if(i.canUploadImage){var t=i.$el.find(".ViewerView-Viewer-Container");t.css({width:1600,height:900,visibility:"hidden"}),window.setTimeout(function(){PARTcloud.viewer.makeScreenshotAsync().done(function(e){t.css({width:"100%",height:"100%",visibility:"visible"}),i.saveScreenshot(e)})},500)}},PARTcloud.viewer.show().done(function(){i.canEditPart?(PARTcloud.viewer.setActionState("actSaveCameraParams","visible",!0),PARTcloud.viewer.setActionState("actEnableHotSpots","visible",!0)):(PARTcloud.viewer.setActionState("actSaveCameraParams","visible",!1),PARTcloud.viewer.setActionState("actEnableHotSpots","visible",!1)),i.canUploadImage?PARTcloud.viewer.setActionState("actScreenShot","visible",!0):PARTcloud.viewer.setActionState("actScreenShot","visible",!1),i.setBackground(),i.loadPreview().done(function(){e.resolve()}),PARTcloud.isViewerInitialized=!0})}else e.reject();return e.promise()},setBackground:function(){var e=this,t={},o={};e.model.background_color_top&&e.model.background_color_bottom&&(t={ColorTL:e.model.background_color_top,ColorTR:e.model.background_color_top,ColorBL:e.model.background_color_bottom,ColorBR:e.model.background_color_bottom}),e.model.background_image_path&&(o={logoTexture:PARTcloudHelpers.prependPartcloudBaseUrl(e.model.background_image_path),logoScaleFactor:1,logoMixFactor:1});var i=r.extend(o,t);PARTcloud.viewer.setViewerSettings(i)},loadPreview:function(){var e=this,t=r.Deferred(),o=e.getVarset(),i=e.getMident();PARTcloud.currentVarsettransfer=o;var a={clearBeforeLoad:!0,defaultView:!0,resetCamera:!0};return(e.model.native_path?PARTcloud.viewer.loadByGeomFile(PARTcloudHelpers.prependPartcloudBaseUrl(e.model.native_path),a):PARTcloud.viewer.loadByVarset(e.model.model_path+".prj",o,i,a)).done(function(){e.setCameraPosition(),PARTcloud.viewer.setHotSpots(e.model.hotspots||[]),t.resolve()}),t.promise()},setCameraPosition:function(e){var t=this,o=!1;t.embeddedConfig&&t.embeddedConfig.cameraParams&&!1!==t.embeddedConfig.cameraParams?o=t.embeddedConfig.cameraParams:!1===r.isEmptyObject(t.model.camera)&&(o=t.model.camera),o&&void 0!==o.camera&&PARTcloud.viewer.setCameraParams(o),o&&void 0!==o.mesh_rotation&&PARTcloud.viewer.rotateMesh({x:o.mesh_rotation.x,y:o.mesh_rotation.y,z:o.mesh_rotation.z,order:o.mesh_rotation.order}),o&&void 0!==o.environment&&PARTcloud.viewer.setEnvironmentOptions(o.environment),!1!==o&&void 0!==o.camera||window.setTimeout(function(){PARTcloud.viewer.zoomObject(null,!0,!1)},100)},saveCameraPosition:function(e){if(this.canEditPart){var t=e,o=PARTcloud.viewer.getMeshRotation();t.mesh_rotation={x:o.x,y:o.y,z:o.z,order:o.order},t.environment=PARTcloud.viewer.getEnvironmentOptions(),t=JSON.stringify(t),PARTcloud.viewer.setActionState("actSaveCameraParams","disabled",!0),PARTcloudApi.setCamera(this.model.model_id,t).done(function(e){void 0!==e.status&&"error"===e.status?(PARTcloud.viewer.setActionState("actSaveCameraParams","error",!0),setTimeout(function(){PARTcloud.viewer.setActionState("actSaveCameraParams","error",!1),PARTcloud.viewer.setActionState("actSaveCameraParams","disabled",!1)},2e3)):(PARTcloud.viewer.setActionState("actSaveCameraParams","success",!0),setTimeout(function(){PARTcloud.viewer.setActionState("actSaveCameraParams","success",!1),PARTcloud.viewer.setActionState("actSaveCameraParams","disabled",!1)},2e3))})}},saveScreenshot:function(e){var o=this;o.canUploadImage&&(PARTcloud.viewer.setActionState("actScreenShot","disabled",!0),PARTcloudApi.uploadImageBase64(o.model.model_id,"",e).done(function(e){var t=o.$el.bView("PreviewView");void 0!==e.status&&"error"===e.status?(PARTcloud.viewer.setActionState("actScreenShot","error",!0),setTimeout(function(){PARTcloud.viewer.setActionState("actScreenShot","error",!1),PARTcloud.viewer.setActionState("actScreenShot","disabled",!1)},2e3)):(t.addPreviewImage(e),PARTcloud.viewer.setActionState("actScreenShot","success",!0),setTimeout(function(){PARTcloud.viewer.setActionState("actScreenShot","success",!1),PARTcloud.viewer.setActionState("actScreenShot","disabled",!1)},2e3))}))},showHotspotView:function(){var e=this.$el.bView("PreviewView");PARTcloud.showHotspotsView(r("#PartView-Hotspots-Container"),{hotspots:this.model.hotspots,previewView:e})},compare:function(e,t){var o=this,i=o.getVarset(),a=o.getMident();o.environment=r.extend(!0,{},PARTcloud.viewer.getEnvironmentOptions()),r("#PartView-Hotspots-Container").hide(),PARTcloud.viewer.setActionState("actSaveCameraParams","visible",!1),PARTcloud.viewer.setActionState("actEnableHotSpots","visible",!1),PARTcloud.viewer.setActionState("actEnv","visible",!1),PARTcloud.viewer.setActionState("actTeleport","visible",!1),PARTcloud.viewer.loadCompareByVarset(e+".prj",i,a,t+".prj").done(function(){o.$el.find(".ViewerView-Compare-Exit").show()}),r("html, body").scrollTop(o.$el.find("#ViewerView-Viewer-Container").offset().top)},getVarset:function(){var e="",t=/[&?]varsettransfer=([^&]*)/i.exec(window.location.href);return t&&t[1]&&(e=decodeURIComponent(t[1])),e},getMident:function(){var e="",t=/[&?]varset=([^&]*)/i.exec(window.location.href);return t&&t[1]&&(e=decodeURIComponent(t[1])),e}})}(jQuery);
