/*! tinycolorpicker - v0.9.5 - 2015-11-20
 * http://www.baijs.com/tinycolorpicker
 *
 * Copyright (c) 2015 Maarten Baijs <wieringen@gmail.com>;
 * Licensed under the MIT license */

/*! CADENAS GmbH 22.03.2017: Fix for touchscreens implemented */
/*! CADENAS GmbH 20.12.2018: Fix for neighboring color buttons z-index, added events "colorpickeropen" and "colorpickerclose" */

(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){module.exports=e(require("jquery"))}else{e(jQuery)}})(function(b){var x="tinycolorpicker",k={colors:["#ffffff","#A7194B","#FE2712","#FB9902","#FABC02","#FEFE33","#D0EA2B","#66B032","#0391CE","#0247FE","#3D01A5","#8601AF"],backgroundUrl:null};function o(r,e){this.options=b.extend({},k,e);this._defaults=k;this._name=x;var i=this,n=r.find(".track"),o=r.find(".color"),t=null,c=r.find(".colorInput"),a=r.find(".dropdown"),s=a.find("li").remove(),u=null,l=false,d=!!document.createElement("canvas").getContext,f="ontouchstart"in document.documentElement;this.colorHex="";this.colorRGB="";function g(){if(d){t=b("<canvas></canvas>");n.append(t);u=t[0].getContext("2d");h()}else{b.each(i.options.colors,function(e,o){var n=s.clone();n.css("backgroundColor",o);n.attr("data-color",o);a.append(n)})}p();return i}function h(){var e=new Image,o=n.css("background-image").replace(/"/g,"").replace(/url\(|\)$/gi,"");e.crossOrigin="Anonymous";n.css("background-image","none");b(e).load(function(){t.attr("width",this.width);t.attr("height",this.height);u.drawImage(e,0,0,this.width,this.height)});e.src=i.options.backgroundUrl||o}function p(){var e=f?"touchstart mousedown":"mousedown";if(d){o.bind(e,function(e){e.preventDefault();e.stopPropagation();if(n.toggle().is(":hidden")){r.trigger("colorpickerclose",o);o.css("z-index",m(n)-1)}else{r.trigger("colorpickeropen",o);o.css("z-index",m(n)+1)}b(document).bind("mousedown.colorpicker",function(e){b(document).unbind(".colorpicker");i.close()})});t.mousedown(function(e){l=true;v(e);b(document).bind("mouseup.colorpicker",function(e){b(document).unbind(".colorpicker");i.close();return false});return false});t.mousemove(v);if(f){t.bind("touchstart",function(e){l=true;v(e.originalEvent.touches[0]);return false});t.bind("touchmove",function(e){v(e.originalEvent.touches[0]);return false});t.bind("touchend",function(e){i.close();return false})}}else{o.bind("mousedown",function(e){e.preventDefault();e.stopPropagation();a.toggle()});a.delegate("li","mousedown",function(e){e.preventDefault();e.stopImmediatePropagation();var o=b(this).attr("data-color");i.setColor(o);a.hide()})}}function m(e){var o=getComputedStyle(e.get(0)).zIndex;if(/^[0-9]+$/.test(o)){return parseInt(o,10)}else{return 1}}function v(e){if(l){var o=b(e.target),n=o.offset(),t=u.getImageData(e.pageX-n.left,e.pageY-n.top,1,1).data;i.setColor("rgb("+t[0]+","+t[1]+","+t[2]+")");r.trigger("change",[i.colorHex,i.colorRGB])}}this.setColor=function(e){if(e.indexOf("#")>=0){i.colorHex=e;i.colorRGB=i.hexToRgb(i.colorHex)}else{i.colorRGB=e;i.colorHex=i.rgbToHex(i.colorRGB)}o.find(".colorInner").css("backgroundColor",i.colorHex);c.val(i.colorHex)};this.close=function(){l=false;r.trigger("colorpickerclose",o);o.css("z-index",m(n)-1);n.hide()};this.hexToRgb=function(e){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgb("+parseInt(o[1],16)+","+parseInt(o[2],16)+","+parseInt(o[3],16)+")"};this.rgbToHex=function(e){var o=e.match(/\d+/g);function n(e){var o=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");return isNaN(e)?"00":o[(e-e%16)/16]+o[e%16]}return"#"+n(o[0])+n(o[1])+n(o[2])};return g()}b.fn[x]=function(e){return this.each(function(){if(!b.data(this,"plugin_"+x)){b.data(this,"plugin_"+x,new o(b(this),e))}})}});
